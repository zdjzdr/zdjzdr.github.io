<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="记录工作点滴,业余学习点滴">
<meta property="og:type" content="website">
<meta property="og:title" content="渝周砺行路">
<meta property="og:url" content="http://www.139139.cn/index.html">
<meta property="og:site_name" content="渝周砺行路">
<meta property="og:description" content="记录工作点滴,业余学习点滴">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="渝周砺行路">
<meta name="twitter:description" content="记录工作点滴,业余学习点滴">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.139139.cn/"/>





  <title>渝周砺行路</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b9d76e46c0e10930a98dac8ef4006720";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">渝周砺行路</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">经验点滴</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/03/20/pycharm常用快捷键及设置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/20/pycharm常用快捷键及设置/" itemprop="url">pycharm常用快捷键及设置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-20T21:33:37+08:00">
                2019-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  14
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="pycharm常用快捷键"><a href="#pycharm常用快捷键" class="headerlink" title="pycharm常用快捷键"></a>pycharm常用快捷键</h1><p> 转自：<a href="https://www.cnblogs.com/meng-wei-zhi/p/8067570.html" target="_blank" rel="noopener">https://www.cnblogs.com/meng-wei-zhi/p/8067570.html</a></p>
<p>1、编辑（Editing）</p>
<p>Ctrl + Space    基本的代码完成（类、方法、属性）</p>
<p>Ctrl + Alt + Space  快速导入任意类</p>
<p>Ctrl + Shift + Enter    语句完成</p>
<p>Ctrl + P    参数信息（在方法中调用参数）</p>
<p>Ctrl + Q    快速查看文档</p>
<p>F1   外部文档</p>
<p>Shift + F1    外部文档，进入web文档主页</p>
<p>Ctrl + Shift + Z –&gt; Redo 重做</p>
<p>Ctrl + 鼠标    简介/进入代码定义</p>
<p>Ctrl + F1    显示错误描述或警告信息</p>
<p>Alt + Insert    自动生成代码</p>
<p>Ctrl + O    重新方法</p>
<p>Ctrl + Alt + T    选中</p>
<p>Ctrl + /    行注释/取消行注释</p>
<p>Ctrl + Shift + /    块注释</p>
<p>Ctrl + W    选中增加的代码块</p>
<p>Ctrl + Shift + W    回到之前状态</p>
<p>Ctrl + Shift + ]/[     选定代码块结束、开始</p>
<p>Alt + Enter    快速修正</p>
<p>Ctrl + Alt + L     代码格式化</p>
<p>Ctrl + Alt + O    优化导入</p>
<p>Ctrl + Alt + I    自动缩进</p>
<p>Tab / Shift + Tab  缩进、不缩进当前行</p>
<p>Ctrl+X/Shift+Delete    剪切当前行或选定的代码块到剪贴板</p>
<p>Ctrl+C/Ctrl+Insert    复制当前行或选定的代码块到剪贴板</p>
<p>Ctrl+V/Shift+Insert    从剪贴板粘贴</p>
<p>Ctrl + Shift + V    从最近的缓冲区粘贴</p>
<p>Ctrl + D  复制选定的区域或行</p>
<p>Ctrl + Y    删除选定的行</p>
<p>Ctrl + Shift + J  添加智能线</p>
<p>Ctrl + Enter   智能线切割</p>
<p>Shift + Enter    另起一行</p>
<p>Ctrl + Shift + U  在选定的区域或代码块间切换</p>
<p>Ctrl + Delete   删除到字符结束</p>
<p>Ctrl + Backspace   删除到字符开始</p>
<p>Ctrl + Numpad+/-   展开/折叠代码块（当前位置的：函数，注释等）</p>
<p>Ctrl + shift + Numpad+/-   展开/折叠所有代码块</p>
<p>Ctrl + F4   关闭运行的选项卡</p>
<p> 2、查找/替换(Search/Replace)</p>
<p>F3   下一个</p>
<p>Shift + F3   前一个</p>
<p>Ctrl + R   替换</p>
<p>Ctrl + Shift + F  或者连续2次敲击shift   全局查找{可以在整个项目中查找某个字符串什么的，如查找某个函数名字符串看之前是怎么使用这个函数的}</p>
<p>Ctrl + Shift + R   全局替换</p>
<p> 3、运行(Running)</p>
<p>Alt + Shift + F10   运行模式配置</p>
<p>Alt + Shift + F9    调试模式配置</p>
<p>Shift + F10    运行</p>
<p>Shift + F9   调试</p>
<p>Ctrl + Shift + F10   运行编辑器配置</p>
<p>Ctrl + Alt + R   运行manage.py任务</p>
<p> 4、调试(Debugging)</p>
<p>F8   跳过</p>
<p>F7   进入</p>
<p>Shift + F8   退出</p>
<p>Alt + F9    运行游标</p>
<p>Alt + F8    验证表达式</p>
<p>Ctrl + Alt + F8   快速验证表达式</p>
<p>F9    恢复程序</p>
<p>Ctrl + F8   断点开关</p>
<p>Ctrl + Shift + F8   查看断点</p>
<p> 5、导航(Navigation)</p>
<p>Ctrl + N    跳转到类</p>
<p>Ctrl + Shift + N    跳转到符号</p>
<p>Alt + Right/Left    跳转到下一个、前一个编辑的选项卡</p>
<p>F12    回到先前的工具窗口</p>
<p>Esc    从工具窗口回到编辑窗口</p>
<p>Shift + Esc   隐藏运行的、最近运行的窗口</p>
<p>Ctrl + Shift + F4   关闭主动运行的选项卡</p>
<p>Ctrl + G    查看当前行号、字符号</p>
<p>Ctrl + E   当前文件弹出，打开最近使用的文件列表</p>
<p>Ctrl+Alt+Left/Right   后退、前进</p>
<p>Ctrl+Shift+Backspace    导航到最近编辑区域</p>
<p>Alt + F1   查找当前文件或标识</p>
<p>Ctrl+B / Ctrl+Click    跳转到声明</p>
<p>Ctrl + Alt + B    跳转到实现</p>
<p>Ctrl + Shift + I查看快速定义</p>
<p>Ctrl + Shift + B跳转到类型声明</p>
<p>Ctrl + U跳转到父方法、父类</p>
<p>Alt + Up/Down跳转到上一个、下一个方法</p>
<p>Ctrl + ]/[跳转到代码块结束、开始</p>
<p>Ctrl + F12弹出文件结构</p>
<p>Ctrl + H类型层次结构</p>
<p>Ctrl + Shift + H方法层次结构</p>
<p>Ctrl + Alt + H调用层次结构</p>
<p>F2 / Shift + F2下一条、前一条高亮的错误</p>
<p>F4 / Ctrl + Enter编辑资源、查看资源</p>
<p>Alt + Home显示导航条F11书签开关</p>
<p>Ctrl + Shift + F11书签助记开关</p>
<p>Ctrl + #[0-9]跳转到标识的书签</p>
<p>Shift + F11显示书签</p>
<p> 6、搜索相关(Usage Search)</p>
<p>Alt + F7/Ctrl + F7文件中查询用法</p>
<p>Ctrl + Shift + F7文件中用法高亮显示</p>
<p>Ctrl + Alt + F7显示用法</p>
<p> 7、重构(Refactoring)</p>
<p>F5复制F6剪切</p>
<p>Alt + Delete安全删除</p>
<p>Shift + F6重命名</p>
<p>Ctrl + F6更改签名</p>
<p>Ctrl + Alt + N内联</p>
<p>Ctrl + Alt + M提取方法</p>
<p>Ctrl + Alt + V提取属性</p>
<p>Ctrl + Alt + F提取字段</p>
<p>Ctrl + Alt + C提取常量</p>
<p>Ctrl + Alt + P提取参数</p>
<p> 8、控制VCS/Local History</p>
<p>Ctrl + K提交项目</p>
<p>Ctrl + T更新项目</p>
<p>Alt + Shift + C查看最近的变化</p>
<p>Alt + BackQuote(’)VCS快速弹出</p>
<p> 9、模版(Live Templates)</p>
<p>Ctrl + Alt + J当前行使用模版</p>
<p>Ctrl +Ｊ插入模版</p>
<p> 10、基本(General)</p>
<p>Alt + #[0-9]打开相应的工具窗口</p>
<p>Ctrl + Alt + Y同步</p>
<p>Ctrl + Shift + F12最大化编辑开关</p>
<p>Alt + Shift + F添加到最喜欢</p>
<p>Alt + Shift + I根据配置检查当前文件</p>
<p>Ctrl + BackQuote(’)快速切换当前计划</p>
<p>Ctrl + Alt + S　打开设置页</p>
<p>Ctrl + Shift + A查找编辑器里所有的动作</p>
<p>Ctrl + Tab在窗口间进行切换</p>
<h1 id="pycharm常用设置"><a href="#pycharm常用设置" class="headerlink" title="pycharm常用设置"></a>pycharm常用设置</h1><p>lz提示一下，pycharm中的设置是可以导入和导出的，file&gt;export settings可以保存当前pycharm中的设置为jar文件，重装时可以直接import settings&gt;jar文件，就不用重复配置了。</p>
<p>file -&gt; Setting -&gt;Editor</p>
<p>\1. 设置<a href="http://lib.csdn.net/base/python" target="_blank" rel="noopener">Python</a>自动引入包，要先在 &gt;general &gt; autoimport -&gt; python :show popup</p>
<p>​     快捷键：Alt + Enter: 自动添加包</p>
<p>\2. “代码自动完成”时间延时设置</p>
<p>  > Code Completion   -&gt; Auto code completion in (ms):0  -&gt; Autopopup in (ms):500</p>
<p>\3. Pycharm中默认是不能用Ctrl+滚轮改变字体大小的，可以在〉Mouse中设置</p>
<p>\4. 显示“行号”与“空白字符”</p>
<p>  > Appearance  -&gt; 勾选“Show line numbers”、“Show whitespaces”、“Show method separators”</p>
<p>\5. 设置编辑器“颜色与字体”主题</p>
<p>  > Colors &amp; Fonts -&gt; Scheme name -&gt; 选择”monokai”“Darcula”</p>
<p>  说明：先选择“monokai”，再“Save As”为”monokai-pipi”，因为默认的主题是“只读的”，一些字体大小颜色什么的都不能修改，拷贝一份后方可修改！</p>
<p>  修改字体大小</p>
<p>> Colors &amp; Fonts -&gt; Font -&gt; Size -&gt; 设置为“14”</p>
<p>\6. 设置缩进符为制表符“Tab”</p>
<p>  File -&gt; Default Settings -&gt; Code Style</p>
<p>  -&gt; General -&gt; 勾选“Use tab character”</p>
<p>  -&gt; Python -&gt; 勾选“Use tab character”</p>
<p>  -&gt; 其他的语言代码同理设置</p>
<p>\7. 去掉默认折叠</p>
<p>  > Code Folding -&gt; Collapse by default -&gt; 全部去掉勾选</p>
<p>\8. pycharm默认是自动保存的，习惯自己按ctrl + s  的可以进行如下设置：</p>
<p>​    > General -&gt; Synchronization -&gt; Save files on frame deactivation  和 Save files automatically if application is idle for .. sec 的勾去掉</p>
<p>​    > Editor Tabs -&gt; Mark modified tabs with asterisk 打上勾</p>
<p>9.&gt;file and code template&gt;python scripts</p>
<p>#!/usr/bin/env python<br># -<em>- coding: utf-8 -</em>-<br>“””<br><strong>title</strong> = ‘$Package_name’<br><strong>author</strong> = ‘$USER’<br><strong>mtime</strong> = ‘$DATE’<br># code is far away from bugs with the god animal protecting<br>    I love animals. They taste delicious.<br>              ┏┓      ┏┓<br>            ┏┛┻━━━┛┻┓<br>            ┃      ☃      ┃<br>            ┃  ┳┛  ┗┳  ┃<br>            ┃      ┻      ┃<br>            ┗━┓      ┏━┛<br>                ┃      ┗━━━┓<br>                ┃  神兽保佑    ┣┓<br>                ┃　永无BUG！   ┏┛<br>                ┗┓┓┏━┳┓┏┛<br>                  ┃┫┫  ┃┫┫<br>                  ┗┻┛  ┗┻┛<br>“””</p>
<p>10 python文件默认编码</p>
<p>File Encodings&gt; IDE Encoding: UTF-8;Project Encoding: UTF-8;</p>
<p>\11. 代码自动整理设置</p>
<p><img src="http://img.blog.csdn.net/20150902233930636?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p>
<p>这里line breaks去掉√，否则bar, 和baz会分开在不同行，不好看。</p>
<p>File -&gt; Settings -&gt; appearance</p>
<p>\1. 修改IDE快捷键方案</p>
<p>  > Keymap</p>
<p>1) execute selection in console : add keymap &gt; ctrl + enter</p>
<p>  系统自带了好几种快捷键方案，下拉框中有如“defaul”,“Visual Studio”,在查找Bug时非常有用,“NetBeans 6.5”,“Default for GNOME”等等可选项，</p>
<p>  因为“Eclipse”方案比较大众，个人用的也比较多，最终选择了“Eclipse”。 </p>
<p>  还是有几个常用的快捷键跟Eclipse不一样，为了能修改，还得先对Eclipse方案拷贝一份： </p>
<p>  (1).代码提示功能，默认是【Ctrl+空格】，现改为跟Eclipse一样，即【Alt+/】</p>
<p>  Main menu -&gt; code -&gt; Completion -&gt; Basic -&gt; 设置为“Alt+/”</p>
<p>  Main menu -&gt; code -&gt; Completion -&gt; SmartType -&gt; 设置为“Alt+Shift+/”</p>
<p>  不过“Alt+/”默认又被 </p>
<p>  Main menu -&gt; code -&gt; Completion -&gt; Basic -&gt; Cyclic Expand Word 占用，先把它删除再说吧（单击右键删除）！</p>
<p>  (2).关闭当前文档，默认是【Ctrl+F4】，现改为跟Eclipse一样，即【Ctrl+W】</p>
<p>  Main menu -&gt; Window -&gt; Active Tool Window -&gt; Close Active Tab -&gt; 设置为 “Ctrl+F4”;</p>
<p>  Main menu -&gt; Window -&gt; Editor -&gt; Close -&gt; 设置为 “Ctrl+W”;</p>
<p>2.设置IDE皮肤主题</p>
<p> > Theme -&gt; 选择“Alloy.IDEA Theme”</p>
<p>  或者在setting中搜索theme可以改变主题，所有配色统一改变</p>
<p>File &gt; settings &gt; build.excution</p>
<p>每次打开python控制台时自动执行代码</p>
<p>> console &gt; pyconsole</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line"># print(&apos;Python %s on %s&apos; % (sys.version, sys.platform))</span><br><span class="line">sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])</span><br><span class="line">import  os</span><br><span class="line">print(&apos;current workdirectory : &apos;, os.getcwd() )</span><br><span class="line">import  numpy as  np</span><br><span class="line">import  scipy as sp</span><br><span class="line">import  matplotlib as mpl</span><br></pre></td></tr></table></figure>
<p>如果安装了ipython，则在pyconsole中使用更强大的ipython</p>
<p>> console</p>
<p>选中use ipython if available</p>
<p>这样每次打开pyconsole就会打开ipython</p>
<p>Note: 在virtualenv中安装ipython: (ubuntu_env) pika:/media/pika/files/mine/python_workspace/ubuntu_env$pip install ipython</p>
<p>File &gt; settings &gt; Languages &amp; Frameworks</p>
<p>如果在项目设置中开启了django支持，打开python console时会自动变成打开django console，当然如果不想这样就关闭项目对django的支持：</p>
<p><img src="http://img.blog.csdn.net/20160320224211393?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p>
<p>如果打开支持就会在 settings &gt; build.excution &gt; console下多显示一个django console:</p>
<p><img src="http://img.blog.csdn.net/20160320225212834?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p>
<p>Django console设置如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">print(&apos;Python %s on %s&apos; % (sys.version, sys.platform))</span><br><span class="line">import django</span><br><span class="line">print(&apos;Django %s&apos; % django.get_version())</span><br><span class="line">sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])</span><br><span class="line">if &apos;setup&apos; in dir(django): django.setup()</span><br><span class="line">import django_manage_shell; django_manage_shell.run(PROJECT_ROOT)</span><br></pre></td></tr></table></figure>
<p>File &gt; settings &gt; Project : initial project</p>
<p>project dependencies &gt; LDA &gt; project depends on these projects &gt; 选择sim_cluster就可以在LDA中调用sim_cluster中的包</p>
<h1 id="pycharm环境和路径配置"><a href="#pycharm环境和路径配置" class="headerlink" title="pycharm环境和路径配置"></a>pycharm环境和路径配置</h1><h2 id="python解释器路径"><a href="#python解释器路径" class="headerlink" title="python解释器路径"></a>python解释器路径</h2><h3 id="python项目解释器路径"><a href="#python项目解释器路径" class="headerlink" title="python项目解释器路径"></a>python项目解释器路径</h3><p>用于配置python项目执行的python路径</p>
<p>比如，有的项目是运行的是系统python2.7下的环境；有的是3.4；有的项目使用的是virtualenv的python环境[<a href="http://blog.csdn.net/pipisorry/article/details/47008981" target="_blank" rel="noopener">python虚拟环境配置</a> - pycharm中的项目配置]</p>
<p>在pycharm &gt; file &gt; settings &gt; project:pythonworkspace &gt; project interpreter &gt; 选择对应项目 &gt; project interpreter中指定python解释器</p>
<p>pycharm中运行configuration有一个选项add content roots to pythonpath</p>
<p>选中后sys.path中会多一整个项目project的路径/media/pika/files/mine/python_workspace，里面的目录就被当成包使用，这样就可以通过from SocialNetworks.SocialNetworks引入不是python包的目录中的文件了。</p>
<p>不过最好使用sys.path.append(os.path.join(os.path.split(os.path.realpath(<strong>file</strong>))[0],”../..”))来添加，这样在pycharm外也可以运行不出错 。</p>
<h3 id="pycharm中进行python包管理"><a href="#pycharm中进行python包管理" class="headerlink" title="pycharm中进行python包管理"></a>pycharm中进行python包管理</h3><p>pycharm中的项目中可以包含package、目录（目录名可以有空格）、等等</p>
<p>目录的某个包中的某个py文件要调用另一个py文件中的函数，首先要将目录设置为source root，这样才能从包中至上至上正确引入函数，否则怎么引入都出错：</p>
<p>SystemError: Parent module ‘’ not loaded, cannot perform relative import</p>
<p>Note:目录 &gt; 右键 &gt; make directory as &gt; source root</p>
<h3 id="python脚本解释路径"><a href="#python脚本解释路径" class="headerlink" title="python脚本解释路径"></a>python脚本解释路径</h3><p>ctrl + shift + f10 / f10 执行python脚本时</p>
<p>当前工作目录cwd为run/debug configurations 中的working directory</p>
<p>可在edit configurations &gt; project or defaults中配置</p>
<h3 id="console执行路径和当前工作目录"><a href="#console执行路径和当前工作目录" class="headerlink" title="console执行路径和当前工作目录"></a>console执行路径和当前工作目录</h3><p>python console中执行时</p>
<p>cwd为File &gt; settings &gt; build.excution &gt; console &gt; pyconsole中的working directory</p>
<p>并可在其中配置</p>
<h2 id="pycharm配置os-environ环境"><a href="#pycharm配置os-environ环境" class="headerlink" title="pycharm配置os.environ环境"></a>pycharm配置os.environ环境</h2><p>pycharm中os.environ不能读取到terminal中的系统环境变量</p>
<p>pycharm中os.environ不能读取.bashrc参数</p>
<p>使用pycharm，无论在python console还是在module中使用os.environ返回的dict中都没有~/.bashrc中的设置的变量，但是有/etc/profile中的变量配置。然而在terminal中使用python，os.environ却可以获取~/.bashrc的内容。</p>
<p>解决方法1：</p>
<p>在~/.bashrc中设置的系统环境只能在terminal shell下运行<a href="http://lib.csdn.net/base/spark" target="_blank" rel="noopener">Spark</a>程序才有效，因为.bashrc is only read for interactive shells.</p>
<p>如果要在当前用户整个系统中都有效（包括pycharm等等IDE），就应该将系统环境变量设置在~/.profile文件中。如果是设置所有用户整个系统，修改/etc/profile或者/etc/environment吧。</p>
<p>如SPARK_HOME的设置[<a href="http://blog.csdn.net/pipisorry/article/details/52916307" target="_blank" rel="noopener">Spark：相关错误总结 </a>]</p>
<p>解决方法2：在代码中设置，这样不管环境有没有问题了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># spark environment settings</span><br><span class="line">import sys, os</span><br><span class="line">os.environ[&apos;SPARK_HOME&apos;] = conf.get(SECTION, &apos;SPARK_HOME&apos;)</span><br><span class="line">sys.path.append(os.path.join(conf.get(SECTION, &apos;SPARK_HOME&apos;), &apos;python&apos;))</span><br><span class="line">os.environ[&quot;PYSPARK_PYTHON&quot;] = conf.get(SECTION, &apos;PYSPARK_PYTHON&apos;)</span><br><span class="line">os.environ[&apos;SPARK_LOCAL_IP&apos;] = conf.get(SECTION, &apos;SPARK_LOCAL_IP&apos;)</span><br><span class="line">os.environ[&apos;JAVA_HOME&apos;] = conf.get(SECTION, &apos;JAVA_HOME&apos;)</span><br><span class="line">os.environ[&apos;PYTHONPATH&apos;] = &apos;$SPARK_HOME/python/lib/py4j-0.10.3-src.zip:$PYTHONPATH&apos;</span><br></pre></td></tr></table></figure>
<h3 id="pycharm配置第三方库代码自动提示"><a href="#pycharm配置第三方库代码自动提示" class="headerlink" title="pycharm配置第三方库代码自动提示"></a>pycharm配置第三方库代码自动提示</h3><h1 id="Pycharm实用拓展功能"><a href="#Pycharm实用拓展功能" class="headerlink" title="Pycharm实用拓展功能"></a>Pycharm实用拓展功能</h1><h2 id="pycharm中清除已编译-pyc中间文件"><a href="#pycharm中清除已编译-pyc中间文件" class="headerlink" title="pycharm中清除已编译.pyc中间文件"></a>pycharm中清除已编译.pyc中间文件</h2><p>选中你的workspace &gt; 右键 &gt; clean python compiled files</p>
<p>还可以自己写一个清除代码</p>
<h2 id="pycharm设置外部工具"><a href="#pycharm设置外部工具" class="headerlink" title="pycharm设置外部工具"></a>pycharm设置外部工具</h2><p>[<a href="http://blog.csdn.net/pipisorry/article/details/46754515" target="_blank" rel="noopener">python小工具 </a>]针对当前pycharm中打开的py文件对应的目录删除其中所有的pyc文件。如果是直接运行（而不是在下面的tools中运行），则删除E:\mine\python_workspace\WebSite目录下的pyc文件。</p>
<h3 id="将上面的删除代码改成外部工具"><a href="#将上面的删除代码改成外部工具" class="headerlink" title="将上面的删除代码改成外部工具"></a>将上面的删除代码改成外部工具</h3><p>PyCharm &gt; settings &gt; tools &gt; external tools &gt; +添加</p>
<p>Name: DelPyc</p>
<p>program: $PyInterpreterDirectory$/python Python安装路径</p>
<p>Parameters: $ProjectFileDir$/Oth/Utility/DelPyc.py $FileDir$</p>
<p>Work directory: $FileDir$</p>
<p>Note:Parameters后面的 $FileDir$参数是说，DelPyc是针对当前pycharm中打开的py文件对应的目录删除其中所有的pyc文件。</p>
<h3 id="之后可以通过下面的方式直接执行"><a href="#之后可以通过下面的方式直接执行" class="headerlink" title="之后可以通过下面的方式直接执行"></a>之后可以通过下面的方式直接执行</h3><p><img src="http://img.blog.csdn.net/20150821111753372?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p>
<p>Note:再添加一个Tools名为DelPycIn</p>
<p>program: Python安装路径，e.g.     D:\python3.4.2\python.exe</p>
<p>Parameters: E:\mine\python_workspace\Utility\DelPyc.py</p>
<p>Work directory 使用变量 $FileDir$</p>
<p>参数中没有$FileDir$，这样就可以直接删除常用目录r’E:\mine\python_workspace\WebSite’了，两个一起用更方便</p>
<h3 id="代码质量"><a href="#代码质量" class="headerlink" title="代码质量"></a>代码质量</h3><p>当你在打字的时候，PyCharm会检查你的代码是否符合PEP8。它会让你知道，你是否有太多的空格或空行等等。如果你愿意，你可以配置PyCharm运行pylint作为外部工具。</p>
<h3 id="python2转python3最快方式"><a href="#python2转python3最快方式" class="headerlink" title="python2转python3最快方式"></a>python2转python3最快方式</h3><p>/usr/bin/2to3 -wn $FileDir$</p>
<p><img src="http://img.blog.csdn.net/20160906161055746?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p>
<p>这样在pycharm中打开某个文件，右键external tools &gt; py2topy3就可以瞬间将当前文件所在目录下的所有py2转换成py3，是不是很机智！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/03/18/HTML语法-Day47/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/18/HTML语法-Day47/" itemprop="url">HTML-Day47</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-18T20:26:37+08:00">
                2019-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.7k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  11
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="HTML的用法-Day47"><a href="#HTML的用法-Day47" class="headerlink" title="HTML的用法-Day47"></a>HTML的用法-Day47</h1><h2 id="1-Web服务本质"><a href="#1-Web服务本质" class="headerlink" title="1. Web服务本质"></a>1. Web服务本质</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line"></span><br><span class="line">sk.bind((<span class="string">"127.0.0.1"</span>, <span class="number">8080</span>))</span><br><span class="line">sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    conn, addr = sk.accept()</span><br><span class="line">    data = conn.recv(<span class="number">8096</span>)</span><br><span class="line">    conn.send(<span class="string">b"HTTP/1.1 200 OK\r\n\r\n"</span>)</span><br><span class="line">    conn.send(<span class="string">b"&lt;h1&gt;Hello world!&lt;/h1&gt;"</span>)</span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>
<p>浏览器发请求 –&gt; HTTP协议 –&gt; 服务端接收请求 –&gt; 服务端返回响应 –&gt; 服务端把HTML文件内容发给浏览器 –&gt; 浏览器渲染页面</p>
<h2 id="2-HTML是什么？"><a href="#2-HTML是什么？" class="headerlink" title="2. HTML是什么？"></a>2. HTML是什么？</h2><ul>
<li>超文本标记语言（Hypertext Markup Language, HTML）是一种用于创建网页的标记语言。</li>
<li>本质上是浏览器可识别的规则，我们按照规则写网页，浏览器根据规则渲染我们的网页。对于不同的浏览器，对同一个标签可能会有不同的解释。（兼容性问题）</li>
<li>网页文件的扩展名：.html或.htm<h2 id="3-HTML不是什么？"><a href="#3-HTML不是什么？" class="headerlink" title="3. HTML不是什么？"></a>3. HTML不是什么？</h2>HTML是一种标记语言（markup language），它不是一种编程语言。<br>HTML使用标签来描述网页。<h2 id="4-HTML文档结构"><a href="#4-HTML文档结构" class="headerlink" title="4. HTML文档结构"></a>4. HTML文档结构</h2>最基本的HTML文档：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>css样式优先级<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<ol>
<li>&lt;!DOCTYPE html&gt;声明为HTML5文档。</li>
<li><html>、</html>是文档的开始标记和结束的标记。是HTML页面的根元素，在它们之间是文档的头部（head）和主体（body）。</li>
<li><head>、</head>定义了HTML文档的开头部分。它们之间的内容不会在浏览器的文档窗口显示。包含了文档的元（meta）数据。</li>
<li><title>、</title>定义了网页标题，在浏览器标题栏显示。</li>
<li><body>、</body>之间的文本是可见的网页主体内容。</li>
</ol>
</blockquote>
<p><strong>注意</strong>：对于中文网页需要使用 <code>&lt;meta charset=&quot;utf-8&quot;&gt;</code>声明编码，否则会出现乱码。有些浏览器会设置 GBK 为默认编码，则你需要设置为 <code>&lt;meta charset=&quot;gbk&quot;&gt;</code>。</p>
<h2 id="5-HTML标签格式"><a href="#5-HTML标签格式" class="headerlink" title="5. HTML标签格式"></a>5. HTML标签格式</h2><ul>
<li>HTML标签是由尖括号包围的关键字，如<code>&lt;html&gt;</code>, <code>&lt;div&gt;</code>等</li>
<li>HTML标签通常是成对出现的，比如：<code>&lt;div&gt;</code>和<code>&lt;/div&gt;</code>，第一个标签是开始，第二个标签是结束。结束标签会有斜线。</li>
<li>也有一部分标签是单独呈现的，比如：<code>&lt;br/&gt;</code>、<code>&lt;hr/&gt;</code>、<code>&lt;img src=&quot;1.jpg&quot; /&gt;</code>等。</li>
<li>标签里面可以有若干属性，也可以不带属性。</li>
</ul>
<p><strong>标签的语法：</strong></p>
<ul>
<li>&lt;标签名 属性1=“属性值1” 属性2=“属性值2”……&gt;内容部分&lt;/标签名&gt;</li>
<li>&lt;标签名 属性1=“属性值1” 属性2=“属性值2”…… /&gt;</li>
</ul>
<p><strong>几个很重要的属性：</strong></p>
<ul>
<li>id：定义标签的唯一ID，HTML文档树中唯一</li>
<li>class：为html元素定义一个或多个类名（classname）(CSS样式类名)</li>
<li>style：规定元素的行内样式（CSS样式）</li>
</ul>
<h2 id="6-HTML注释"><a href="#6-HTML注释" class="headerlink" title="6. HTML注释"></a>6. HTML注释</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注释内容--&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="7-lt-DOCTYPE-gt-标签"><a href="#7-lt-DOCTYPE-gt-标签" class="headerlink" title="7. &lt;!DOCTYPE&gt; 标签"></a>7. &lt;!DOCTYPE&gt; 标签</h2><p>&lt;!DOCTYPE&gt; 声明必须是 HTML 文档的第一行，位于 <html> 标签之前。</html></p>
<p>&lt;!DOCTYPE&gt; 声明不是 HTML 标签；它是指示 web 浏览器关于页面使用哪个 HTML 版本进行编写的指令。</p>
<h2 id="8-HTML常用标签"><a href="#8-HTML常用标签" class="headerlink" title="8. HTML常用标签"></a>8. HTML常用标签</h2><h3 id="8-1-head内常用标签"><a href="#8-1-head内常用标签" class="headerlink" title="8.1 head内常用标签"></a>8.1 head内常用标签</h3><table>
<thead>
<tr>
<th style="text-align:center">标签</th>
<th style="text-align:center">意义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>&lt;title&gt;&lt;/title&gt;</code></td>
<td style="text-align:center">定义网页标题</td>
</tr>
<tr>
<td style="text-align:center"><code>&lt;style&gt;&lt;/style&gt;</code></td>
<td style="text-align:center">定义内部样式表</td>
</tr>
<tr>
<td style="text-align:center"><code>&lt;script&gt;&lt;/script&gt;</code></td>
<td style="text-align:center">定义JS代码或引入外部JS文件</td>
</tr>
<tr>
<td style="text-align:center"><code>&lt;link/&gt;</code></td>
<td style="text-align:center">引入外部样式表文件</td>
</tr>
<tr>
<td style="text-align:center"><code>&lt;meta/&gt;</code></td>
<td style="text-align:center">定义网页原信息</td>
</tr>
</tbody>
</table>
<h4 id="8-1-1-Meta标签"><a href="#8-1-1-Meta标签" class="headerlink" title="8.1.1 Meta标签"></a>8.1.1 Meta标签</h4><p>Meta标签介绍：</p>
<ul>
<li><meta>元素可提供有关页面的元信息（mata-information）,针对搜索引擎和更新频度的描述和关键词。</li>
<li><meta>标签位于文档的头部，不包含任何内容。</li>
<li><meta>提供的信息是用户不可见的。<br>meta标签的组成：meta标签共有两个属性，它们分别是http-equiv属性和name 属性，不同的属性又有不同的参数值，这些不同的参数值就实现了不同的网页功能。 </li>
</ul>
<p>1.http-equiv属性：相当于http的文件头作用，它可以向浏览器传回一些有用的信息，以帮助正确地显示网页内容，与之对应的属性值为content，content中的内容其实就是各个参数的变量值。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--2秒后跳转到对应的网址，注意引号--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"2;URL=https://www.oldboyedu.com"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--指定文档的编码类型--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-Type"</span> <span class="attr">charset</span>=<span class="string">UTF8</span>"&gt;</span></span><br><span class="line"><span class="comment">&lt;!--告诉IE以最高级模式渲染文档--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"x-ua-compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2.name属性: 主要用于描述网页，与之对应的属性值为content，content中的内容主要是便于搜索引擎机器人查找信息和分类信息用的。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"keywords"</span> <span class="attr">content</span>=<span class="string">"meta总结,html meta,meta属性,meta跳转"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">"老男孩教育Python学院"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="8-2-body内常用标签"><a href="#8-2-body内常用标签" class="headerlink" title="8.2 body内常用标签"></a>8.2 body内常用标签</h3><h4 id="8-2-1-基本标签（块级标签和内联标签）"><a href="#8-2-1-基本标签（块级标签和内联标签）" class="headerlink" title="8.2.1 基本标签（块级标签和内联标签）"></a>8.2.1 基本标签（块级标签和内联标签）</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>加粗<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span>&gt;</span>斜体<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">u</span>&gt;</span>下划线<span class="tag">&lt;/<span class="name">u</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">s</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>段落标签<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>标题1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>标题2<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>标题3<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>标题4<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h5</span>&gt;</span>标题5<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h6</span>&gt;</span>标题6<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--换行--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--水平线--&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="8-2-2-特殊字符"><a href="#8-2-2-特殊字符" class="headerlink" title="8.2.2 特殊字符"></a>8.2.2 特殊字符</h4><table>
<thead>
<tr>
<th style="text-align:center">内容</th>
<th style="text-align:center">对应代码</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">空格</td>
<td style="text-align:center">&nbsp;</td>
</tr>
<tr>
<td style="text-align:center">&gt;</td>
<td style="text-align:center">&gt;</td>
</tr>
<tr>
<td style="text-align:center">&lt;</td>
<td style="text-align:center">&lt;</td>
</tr>
<tr>
<td style="text-align:center">&amp;</td>
<td style="text-align:center">&amp;</td>
</tr>
<tr>
<td style="text-align:center">¥</td>
<td style="text-align:center">&yen;</td>
</tr>
<tr>
<td style="text-align:center">版权</td>
<td style="text-align:center">&copy;</td>
</tr>
<tr>
<td style="text-align:center">注册</td>
<td style="text-align:center">&reg;</td>
</tr>
</tbody>
</table>
<h4 id="8-2-3-div标签和span标签"><a href="#8-2-3-div标签和span标签" class="headerlink" title="8.2.3 div标签和span标签"></a>8.2.3 div标签和span标签</h4><p>div标签用来定义一个块级元素，并无实际的意义。主要通过CSS样式为其赋予不同的表现。<br>span标签用来定义内联(行内)元素，并无实际的意义。主要通过CSS样式为其赋予不同的表现。</p>
<p>块级元素与行内元素的区别：<br>所谓块元素，是以另起一行开始渲染的元素，行内元素则不需另起一行。如果单独在网页中插入这两个元素，不会对页面产生任何的影响。<br>这两个元素是专门为定义CSS样式而生的。</p>
<p><strong>注意：</strong></p>
<p>关于标签嵌套：通常块级元素可以包含内联元素或某些块级元素，但内联元素不能包含块级元素，它只能包含其它内联元素。</p>
<p>p标签不能包含块级标签，p标签也不能包含p标签。</p>
<h4 id="8-2-4-img标签"><a href="#8-2-4-img标签" class="headerlink" title="8.2.4 img标签"></a>8.2.4 img标签</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"图片的路径"</span> <span class="attr">alt</span>=<span class="string">"图片未加载成功时的提示"</span> <span class="attr">title</span>=<span class="string">"鼠标悬浮时提示信息"</span> <span class="attr">width</span>=<span class="string">"宽"</span> <span class="attr">height</span>=<span class="string">"高(宽高两个属性只用一个会自动等比缩放)"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="8-2-5-a标签"><a href="#8-2-5-a标签" class="headerlink" title="8.2.5 a标签"></a>8.2.5 a标签</h4><p>超链接标签</p>
<p>所谓的超链接是指从一个网页指向一个目标的连接关系，这个目标可以是另一个网页，也可以是相同网页上的不同位置，还可以是一个图片，一个电子邮件地址，一个文件，甚至是一个应用程序。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.oldboyedu.com"</span> <span class="attr">target</span>=<span class="string">"_blank"</span> &gt;</span>点我<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>href属性指定目标网页地址。该地址可以有几种类型：</p>
<ul>
<li>绝对URL - 指向另一个站点（比如 <code>href=&quot;http://www.jd.com</code>）</li>
<li>相对URL - 指当前站点中确切的路径（<code>href=&quot;index.htm&quot;</code>）</li>
<li>锚URL - 指向页面中的锚（<code>href=&quot;#top&quot;</code>）</li>
</ul>
<p>target：</p>
<ul>
<li>_blank表示在新标签页中打开目标网页</li>
<li>_self表示在当前标签页中打开目标网页</li>
</ul>
<h4 id="8-2-6-列表"><a href="#8-2-6-列表" class="headerlink" title="8.2.6 列表"></a>8.2.6 列表</h4><ol>
<li>无序列表</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">type</span>=<span class="string">"disc"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>第一项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>第二项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>type属性：</p>
<ul>
<li><p>disc（实心圆点，默认值）</p>
</li>
<li><p>circle（空心圆圈）</p>
</li>
<li><p>square（实心方块）</p>
</li>
<li><p>none（无样式）</p>
</li>
</ul>
<ol start="2">
<li>有序列表</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ol</span> <span class="attr">type</span>=<span class="string">"1"</span> <span class="attr">start</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>第一项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>第二项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>type属性：</p>
<ul>
<li>1 数字列表，默认值</li>
<li>A 大写字母</li>
<li>a 小写字母</li>
<li>Ⅰ大写罗马</li>
<li>ⅰ小写罗马</li>
</ul>
<p>3.标题列表</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>标题1<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>内容1<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>标题2<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>内容1<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>内容2<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="8-2-7-表格"><a href="#8-2-7-表格" class="headerlink" title="8.2.7 表格"></a>8.2.7 表格</h4><p>表格是一个二维数据空间，一个表格由若干行组成，一个行又有若干单元格组成，单元格里可以包含文字、列表、图案、表单、数字符号、预置文本和其它的表格等内容。<br>表格最重要的目的是显示表格类数据。表格类数据是指最适合组织为表格格式（即按行和列组织）的数据。<br>表格的基本结构：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span> <span class="attr">cellpadding</span>=<span class="string">"5"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>王思<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>25<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>女<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>李强<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>24<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>男<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>刘伟<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>18<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>男<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>属性:</p>
<ul>
<li>border: 表格边框.</li>
<li>cellpadding: 内边距</li>
<li>cellspacing: 外边距.</li>
<li>width: 像素 百分比.（最好通过css来设置长宽）</li>
<li>rowspan: 单元格竖跨多少行</li>
<li>colspan: 单元格横跨多少列（即合并单元格）</li>
</ul>
<h4 id="8-2-7-1-pycharm代码批量输入技巧"><a href="#8-2-7-1-pycharm代码批量输入技巧" class="headerlink" title="8.2.7.1 pycharm代码批量输入技巧"></a>8.2.7.1 pycharm代码批量输入技巧</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. td*4 再按TAB键	相当于输入4对<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span>标签</span><br><span class="line">2.  tr&gt;td*4 再按TAB键 :表示tr的子标签*4</span><br><span class="line">结果如下：</span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">3. tr&gt;td&#123;内容$&#125;*4 再按TAB键：$表示自增数字；&#123;&#125;表示标签内的内容</span><br><span class="line">结果如下：</span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>内容1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>内容2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>内容3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>内容4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">4. tr&gt;td.c1&#123;内容$&#125;*4 在按TAB键：.c1表示CSS类名为c1</span><br><span class="line">结果如下：</span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"c1"</span>&gt;</span>内容1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"c1"</span>&gt;</span>内容2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"c1"</span>&gt;</span>内容3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"c1"</span>&gt;</span>内容4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">5. tr&gt;td.c1[id=a$]&#123;内容$&#125;*4 在按TAB键：[id=a$]表示id自增</span><br><span class="line">结果如下：</span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"c1"</span> <span class="attr">id</span>=<span class="string">"a1"</span>&gt;</span>内容1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"c1"</span> <span class="attr">id</span>=<span class="string">"a2"</span>&gt;</span>内容2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"c1"</span> <span class="attr">id</span>=<span class="string">"a3"</span>&gt;</span>内容3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"c1"</span> <span class="attr">id</span>=<span class="string">"a4"</span>&gt;</span>内容4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">6. 按住ALT键可对多行进行操作，可以多行快速输入属性名称</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/03/12/SQLALCheMy用法-Day63/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/12/SQLALCheMy用法-Day63/" itemprop="url">SQLALCheMy用法-Day63</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-12T22:03:36+08:00">
                2019-03-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SQLALCheMy用法-Day63"><a href="#SQLALCheMy用法-Day63" class="headerlink" title="SQLALCheMy用法-Day63"></a>SQLALCheMy用法-Day63</h2><p>SQLAlchemy本身无法操作数据库，其必须以来pymsql等第三方插件，Dialect用于和数据API进行交流，根据配置文件的不同调用不同的数据库API，从而实现对数据库的操作，如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MySQL-Python</span><br><span class="line">    mysql+mysqldb://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;[:&lt;port&gt;]/&lt;dbname&gt;</span><br><span class="line">   </span><br><span class="line">pymysql</span><br><span class="line">    mysql+pymysql://&lt;username&gt;:&lt;password&gt;@&lt;host&gt;/&lt;dbname&gt;[?&lt;options&gt;]</span><br><span class="line">   </span><br><span class="line">MySQL-Connector</span><br><span class="line">    mysql+mysqlconnector://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;[:&lt;port&gt;]/&lt;dbname&gt;</span><br><span class="line">   </span><br><span class="line">cx_Oracle</span><br><span class="line">    oracle+cx_oracle://user:pass@host:port/dbname[?key=value&amp;key=value...]</span><br><span class="line">   </span><br><span class="line">更多详见：http://docs.sqlalchemy.org/en/latest/dialects/index.html</span><br></pre></td></tr></table></figure></p>
<h3 id="1-内部处理"><a href="#1-内部处理" class="headerlink" title="1. 内部处理"></a>1. 内部处理</h3><p>使用 Engine/ConnectionPooling/Dialect 进行数据库操作，Engine使用ConnectionPooling连接数据库，然后再通过Dialect执行SQL语句。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"></span><br><span class="line">engine = create_engine(<span class="string">"mysql+pymysql://root:123abc@localhost:3306/db1?charset=utf8"</span>,max_overflow=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行SQL</span></span><br><span class="line">cur = engine.execute(</span><br><span class="line">	<span class="string">"INSERT INTO users(USERNAME, PASSWORD, EMAIL, USERTYPE) VALUES ('高就', '456ab', 'dad@qq.com', 1)"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># 获取新插入的自增ID</span></span><br><span class="line">print(cur.lastrowid)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行SQL</span></span><br><span class="line">Cur = engine.execute(<span class="string">'select * from users'</span>)</span><br><span class="line"><span class="comment"># 获取第一行数据</span></span><br><span class="line">print(cur.fetchone())</span><br><span class="line"><span class="comment"># 获取第N行数据</span></span><br><span class="line">print(cur.fetchmany(<span class="number">2</span>))</span><br><span class="line"><span class="comment"># 获取所有数据</span></span><br><span class="line">print(cur.fetchall())</span><br></pre></td></tr></table></figure></p>
<h3 id="2-ORM功能使用"><a href="#2-ORM功能使用" class="headerlink" title="2.ORM功能使用"></a>2.ORM功能使用</h3><p>使用 ORM/Schema Type/SQL Expression Language/Engine/ConnectionPooling/Dialect 所有组件对数据进行操作。根据类创建对象，对象转换成SQL，执行SQL。</p>
<h4 id="2-1-创建表"><a href="#2-1-创建表" class="headerlink" title="2.1 创建表"></a>2.1 创建表</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author : 渝周郎</span></span><br><span class="line"><span class="comment"># Time   : 2019/3/14 21:38</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, Integer, String, ForeignKey</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"></span><br><span class="line">engine = create_engine(<span class="string">"mysql+pymysql://root:123456@localhost:3306/db1?charset=utf8"</span>,max_overflow=<span class="number">5</span>)</span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建单表1</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">State</span><span class="params">(Base)</span>:</span></span><br><span class="line">	__tablename__ = <span class="string">'国家'</span></span><br><span class="line">	id = Column(Integer, primary_key=<span class="keyword">True</span>, autoincrement=<span class="keyword">True</span>)</span><br><span class="line">	name = Column(String(<span class="number">50</span>), nullable=<span class="keyword">False</span>, unique=<span class="keyword">True</span>, index=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movies</span><span class="params">(Base)</span>:</span></span><br><span class="line">	__tablename__ = <span class="string">'电影信息'</span></span><br><span class="line">	id = Column(Integer, primary_key=<span class="keyword">True</span>, autoincrement=<span class="keyword">True</span>)</span><br><span class="line">	name = Column(String(<span class="number">100</span>), nullable=<span class="keyword">False</span>)</span><br><span class="line">	tag = Column(String(<span class="number">100</span>), nullable=<span class="keyword">False</span>)</span><br><span class="line">	niandai = Column(String(<span class="number">50</span>))</span><br><span class="line">	yanyuan = Column(String(<span class="number">100</span>))</span><br><span class="line">	jianjie = Column(String(<span class="number">255</span>))</span><br><span class="line">	category = Column(String(<span class="number">100</span>))</span><br><span class="line">	state_id = Column(Integer, ForeignKey(<span class="string">'国家.id'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建单表2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Users</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'users'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">32</span>))</span><br><span class="line">    extra = Column(String(<span class="number">16</span>))</span><br><span class="line"> </span><br><span class="line">    __table_args__ = (</span><br><span class="line">    UniqueConstraint(<span class="string">'id'</span>, <span class="string">'name'</span>, name=<span class="string">'uix_id_name'</span>),</span><br><span class="line">        Index(<span class="string">'ix_id_name'</span>, <span class="string">'name'</span>, <span class="string">'extra'</span>),</span><br><span class="line">    )</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 一对多</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Favor</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'favor'</span></span><br><span class="line">    nid = Column(Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    caption = Column(String(<span class="number">50</span>), default=<span class="string">'red'</span>, unique=<span class="keyword">True</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'person'</span></span><br><span class="line">    nid = Column(Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">32</span>), index=<span class="keyword">True</span>, nullable=<span class="keyword">True</span>)</span><br><span class="line">    favor_id = Column(Integer, ForeignKey(<span class="string">"favor.nid"</span>))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 多对多</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Group</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'group'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">64</span>), unique=<span class="keyword">True</span>, nullable=<span class="keyword">False</span>)</span><br><span class="line">    port = Column(Integer, default=<span class="number">22</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'server'</span></span><br><span class="line"> </span><br><span class="line">    id = Column(Integer, primary_key=<span class="keyword">True</span>, autoincrement=<span class="keyword">True</span>)</span><br><span class="line">    hostname = Column(String(<span class="number">64</span>), unique=<span class="keyword">True</span>, nullable=<span class="keyword">False</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerToGroup</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'servertogroup'</span></span><br><span class="line">    nid = Column(Integer, primary_key=<span class="keyword">True</span>, autoincrement=<span class="keyword">True</span>)</span><br><span class="line">    server_id = Column(Integer, ForeignKey(<span class="string">'server.id'</span>))</span><br><span class="line">    group_id = Column(Integer, ForeignKey(<span class="string">'group.id'</span>))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_db</span><span class="params">()</span>:</span></span><br><span class="line">    Base.metadata.create_all(engine)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">drop_db</span><span class="params">()</span>:</span></span><br><span class="line">    Base.metadata.drop_all(engine)</span><br></pre></td></tr></table></figure>
<p>注：设置外检的另一种方式 ForeignKeyConstraint([‘other_id’], [‘othertable.other_id’])</p>
<h4 id="2-2-操作表"><a href="#2-2-操作表" class="headerlink" title="2.2 操作表"></a>2.2 操作表</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, Integer, String, ForeignKey, UniqueConstraint, Index</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker, relationship</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"></span><br><span class="line">engine = create_engine(<span class="string">"mysql+pymysql://root:123@127.0.0.1:3306/t1"</span>, max_overflow=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建单表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Users</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'users'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">32</span>))</span><br><span class="line">    extra = Column(String(<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">    __table_args__ = (</span><br><span class="line">    UniqueConstraint(<span class="string">'id'</span>, <span class="string">'name'</span>, name=<span class="string">'uix_id_name'</span>),</span><br><span class="line">        Index(<span class="string">'ix_id_name'</span>, <span class="string">'name'</span>, <span class="string">'extra'</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"%s-%s"</span> %(self.id, self.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一对多</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Favor</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'favor'</span></span><br><span class="line">    nid = Column(Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    caption = Column(String(<span class="number">50</span>), default=<span class="string">'red'</span>, unique=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"%s-%s"</span> %(self.nid, self.caption)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'person'</span></span><br><span class="line">    nid = Column(Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">32</span>), index=<span class="keyword">True</span>, nullable=<span class="keyword">True</span>)</span><br><span class="line">    favor_id = Column(Integer, ForeignKey(<span class="string">"favor.nid"</span>))</span><br><span class="line">    <span class="comment"># 与生成表结构无关，仅用于查询方便</span></span><br><span class="line">    favor = relationship(<span class="string">"Favor"</span>, backref=<span class="string">'pers'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多对多</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerToGroup</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'servertogroup'</span></span><br><span class="line">    nid = Column(Integer, primary_key=<span class="keyword">True</span>, autoincrement=<span class="keyword">True</span>)</span><br><span class="line">    server_id = Column(Integer, ForeignKey(<span class="string">'server.id'</span>))</span><br><span class="line">    group_id = Column(Integer, ForeignKey(<span class="string">'group.id'</span>))</span><br><span class="line">    group = relationship(<span class="string">"Group"</span>, backref=<span class="string">'s2g'</span>)</span><br><span class="line">    server = relationship(<span class="string">"Server"</span>, backref=<span class="string">'s2g'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Group</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'group'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">64</span>), unique=<span class="keyword">True</span>, nullable=<span class="keyword">False</span>)</span><br><span class="line">    port = Column(Integer, default=<span class="number">22</span>)</span><br><span class="line">    <span class="comment"># group = relationship('Group',secondary=ServerToGroup,backref='host_list')</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'server'</span></span><br><span class="line"></span><br><span class="line">    id = Column(Integer, primary_key=<span class="keyword">True</span>, autoincrement=<span class="keyword">True</span>)</span><br><span class="line">    hostname = Column(String(<span class="number">64</span>), unique=<span class="keyword">True</span>, nullable=<span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_db</span><span class="params">()</span>:</span></span><br><span class="line">    Base.metadata.create_all(engine)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">drop_db</span><span class="params">()</span>:</span></span><br><span class="line">    Base.metadata.drop_all(engine)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Session = sessionmaker(bind=engine)</span><br><span class="line">session = Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 增</span></span><br><span class="line">obj1 = State(name=<span class="string">'日本'</span>)</span><br><span class="line">session.add(obj1)</span><br><span class="line">session.add_all([</span><br><span class="line">	State(name=<span class="string">'德国'</span>),</span><br><span class="line">	State(name=<span class="string">'美国'</span>),</span><br><span class="line">	State(name=<span class="string">'俄罗斯'</span>),</span><br><span class="line">	State(name=<span class="string">'英国'</span>),</span><br><span class="line">	State(name=<span class="string">'法国'</span>),</span><br><span class="line">	State(name=<span class="string">'印度'</span>)</span><br><span class="line">])</span><br><span class="line">session.commit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.删</span></span><br><span class="line"></span><br><span class="line">session.query(State).filter(State.id == <span class="number">8</span>).delete()</span><br><span class="line">session.commit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.改</span></span><br><span class="line">session.query(state).filter(state.id == <span class="number">7</span>).update(&#123;<span class="string">'name'</span>: <span class="string">'韩国'</span>&#125;)</span><br><span class="line"></span><br><span class="line">session.query(Users).filter(Users.id &gt; <span class="number">2</span>).update(&#123;Users.name: Users.name + <span class="string">"099"</span>&#125;, synchronize_session=<span class="keyword">False</span>)</span><br><span class="line">session.query(Users).filter(Users.id &gt; <span class="number">2</span>).update(&#123;<span class="string">"num"</span>: Users.num + <span class="number">1</span>&#125;, synchronize_session=<span class="string">"evaluate"</span>)</span><br><span class="line">session.commit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.查</span></span><br><span class="line">ret = session.query(Users).all()</span><br><span class="line">ret = session.query(Users.name, Users.extra).all()</span><br><span class="line">ret = session.query(Users).filter_by(name=<span class="string">'alex'</span>).all()</span><br><span class="line">ret = session.query(Users).filter_by(name=<span class="string">'alex'</span>).first()</span><br><span class="line"></span><br><span class="line">ret = session.query(Users).filter(text(<span class="string">"id&lt;:value and name=:name"</span>)).params(value=<span class="number">224</span>, name=<span class="string">'fred'</span>).order_by(User.id).all()</span><br><span class="line"></span><br><span class="line">ret = session.query(Users).from_statement(text(<span class="string">"SELECT * FROM users where name=:name"</span>)).params(name=<span class="string">'ed'</span>).all()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.其他</span></span><br><span class="line"><span class="comment">#　条件</span></span><br><span class="line">ret = session.query(Users).filter_by(name=<span class="string">'alex'</span>).all()</span><br><span class="line">ret = session.query(Users).filter(Users.id &gt; <span class="number">1</span>, Users.name == <span class="string">'eric'</span>).all()</span><br><span class="line">ret = session.query(Users).filter(Users.id.between(<span class="number">1</span>, <span class="number">3</span>), Users.name == <span class="string">'eric'</span>).all()</span><br><span class="line">ret = session.query(Users).filter(Users.id.in_([<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>])).all()</span><br><span class="line">ret = session.query(Users).filter(~Users.id.in_([<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>])).all()</span><br><span class="line">ret = session.query(Users).filter(Users.id.in_(session.query(Users.id).filter_by(name=<span class="string">'eric'</span>))).all()</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> and_, or_</span><br><span class="line">ret = session.query(Users).filter(and_(Users.id &gt; <span class="number">3</span>, Users.name == <span class="string">'eric'</span>)).all()</span><br><span class="line">ret = session.query(Users).filter(or_(Users.id &lt; <span class="number">2</span>, Users.name == <span class="string">'eric'</span>)).all()</span><br><span class="line">ret = session.query(Users).filter(</span><br><span class="line">    or_(</span><br><span class="line">        Users.id &lt; <span class="number">2</span>,</span><br><span class="line">        and_(Users.name == <span class="string">'eric'</span>, Users.id &gt; <span class="number">3</span>),</span><br><span class="line">        Users.extra != <span class="string">""</span></span><br><span class="line">    )).all()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通配符</span></span><br><span class="line">ret = session.query(Users).filter(Users.name.like(<span class="string">'e%'</span>)).all()</span><br><span class="line">ret = session.query(Users).filter(~Users.name.like(<span class="string">'e%'</span>)).all()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 限制</span></span><br><span class="line">ret = session.query(Users)[<span class="number">1</span>:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序</span></span><br><span class="line">ret = session.query(Users).order_by(Users.name.desc()).all()</span><br><span class="line">ret = session.query(Users).order_by(Users.name.desc(), Users.id.asc()).all()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分组</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy.sql <span class="keyword">import</span> func</span><br><span class="line"></span><br><span class="line">ret = session.query(Users).group_by(Users.extra).all()</span><br><span class="line">ret = session.query(</span><br><span class="line">    func.max(Users.id),</span><br><span class="line">    func.sum(Users.id),</span><br><span class="line">    func.min(Users.id)).group_by(Users.name).all()</span><br><span class="line"></span><br><span class="line">ret = session.query(</span><br><span class="line">    func.max(Users.id),</span><br><span class="line">    func.sum(Users.id),</span><br><span class="line">    func.min(Users.id)).group_by(Users.name).having(func.min(Users.id) &gt;<span class="number">2</span>).all()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连表</span></span><br><span class="line"></span><br><span class="line">ret = session.query(Users, Favor).filter(Users.id == Favor.nid).all()</span><br><span class="line"></span><br><span class="line">ret = session.query(Person).join(Favor).all()</span><br><span class="line"></span><br><span class="line">ret = session.query(Person).join(Favor, isouter=<span class="keyword">True</span>).all()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 组合</span></span><br><span class="line">q1 = session.query(Users.name).filter(Users.id &gt; <span class="number">2</span>)</span><br><span class="line">q2 = session.query(Favor.caption).filter(Favor.nid &lt; <span class="number">2</span>)</span><br><span class="line">ret = q1.union(q2).all()</span><br><span class="line"></span><br><span class="line">q1 = session.query(Users.name).filter(Users.id &gt; <span class="number">2</span>)</span><br><span class="line">q2 = session.query(Favor.caption).filter(Favor.nid &lt; <span class="number">2</span>)</span><br><span class="line">ret = q1.union_all(q2).all()</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/03/12/MSSQL中的多行数据合并到一行/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/12/MSSQL中的多行数据合并到一行/" itemprop="url">MSSQL中的多行数据合并到一行</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-12T20:28:36+08:00">
                2019-03-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MSSQL中的多行数据合并到一行"><a href="#MSSQL中的多行数据合并到一行" class="headerlink" title="MSSQL中的多行数据合并到一行"></a>MSSQL中的多行数据合并到一行</h2><blockquote>
<p>SC表数据如下：</p>
</blockquote>
<table>
<thead>
<tr>
<th>student</th>
<th>course</th>
</tr>
</thead>
<tbody>
<tr>
<td>张三</td>
<td>大学语文</td>
</tr>
<tr>
<td>李四</td>
<td>大学语文</td>
</tr>
<tr>
<td>张三</td>
<td>书法鉴赏</td>
</tr>
<tr>
<td>张三</td>
<td>音乐欣赏</td>
</tr>
<tr>
<td>李四</td>
<td>电影赏析</td>
</tr>
</tbody>
</table>
<blockquote>
<p>期望得到的结果如下：</p>
</blockquote>
<table>
<thead>
<tr>
<th>student</th>
<th>course</th>
</tr>
</thead>
<tbody>
<tr>
<td>张三</td>
<td>大学语文，书法鉴赏，音乐欣赏</td>
</tr>
<tr>
<td>李四</td>
<td>大学语文，电影赏析</td>
</tr>
</tbody>
</table>
<blockquote>
<p>有两种方式可以实现，一种是函数，一种是FOR XML PATH（SQL2005及以后支持)</p>
</blockquote>
<h3 id="创建SC表的代码如下："><a href="#创建SC表的代码如下：" class="headerlink" title="创建SC表的代码如下："></a>创建SC表的代码如下：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">IF OBJECT_ID(N&apos;SC&apos;) IS NOT NULL</span><br><span class="line"></span><br><span class="line">      BEGIN</span><br><span class="line"></span><br><span class="line">            DROP TABLE SC</span><br><span class="line"></span><br><span class="line">      END</span><br><span class="line"></span><br><span class="line">ELSE</span><br><span class="line"></span><br><span class="line">      BEGIN</span><br><span class="line"></span><br><span class="line">            CREATE TABLE SC</span><br><span class="line"></span><br><span class="line">            (</span><br><span class="line"></span><br><span class="line">                  Student NVARCHAR(50),</span><br><span class="line"></span><br><span class="line">                  Course NVARCHAR(50)</span><br><span class="line"></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            INSERT INTO SC</span><br><span class="line"></span><br><span class="line">            SELECT N&apos;张三&apos;,N&apos;大学语文&apos; UNION ALL</span><br><span class="line"></span><br><span class="line">            SELECT N&apos;李四&apos;,N&apos;大学语文&apos; UNION ALL</span><br><span class="line"></span><br><span class="line">            SELECT N&apos;张三&apos;,N&apos;书法鉴赏&apos; UNION ALL</span><br><span class="line"></span><br><span class="line">            SELECT N&apos;张三&apos;,N&apos;音乐赏析&apos; UNION ALL</span><br><span class="line"></span><br><span class="line">            SELECT N&apos;李四&apos;,N&apos;电影赏析&apos;           </span><br><span class="line"></span><br><span class="line">      END</span><br></pre></td></tr></table></figure>
<h3 id="方法一：用户自定义函数"><a href="#方法一：用户自定义函数" class="headerlink" title="方法一：用户自定义函数"></a>方法一：用户自定义函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION [dbo].[f_hebin](@sname varchar(50))</span><br><span class="line">RETURNS varchar(8000)</span><br><span class="line">AS</span><br><span class="line">	BEGIN</span><br><span class="line">		DECLARE @course varchar(50)</span><br><span class="line">		SELECT @course = ISNULL(@course+&apos;,&apos;,&apos;&apos;)+course</span><br><span class="line">		FROM SC</span><br><span class="line">		WHERE student=@sname</span><br><span class="line">		RETURN @course</span><br><span class="line">	END</span><br><span class="line">	</span><br><span class="line">SELECT DISTINCT [Student]</span><br><span class="line"></span><br><span class="line">      ,dbo.f_hebin([Student]) AS Course</span><br><span class="line"></span><br><span class="line">FROM [dbo].[SC]</span><br></pre></td></tr></table></figure>
<h3 id="方法二：FOR-XML-PATH"><a href="#方法二：FOR-XML-PATH" class="headerlink" title="方法二：FOR XML PATH"></a>方法二：FOR XML PATH</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT distinct student,</span><br><span class="line">STUFF(</span><br><span class="line">	(</span><br><span class="line">	SELECT &apos;,&apos;+course</span><br><span class="line">	FROM SC</span><br><span class="line">	WHERE student=A.student</span><br><span class="line">	FOR XML PATH(&apos;&apos;)</span><br><span class="line">	),1,1,&apos;&apos;</span><br><span class="line">)as course</span><br><span class="line"></span><br><span class="line">FROM SC AS A</span><br></pre></td></tr></table></figure>
<p>用法说明：<br>①stuff：<br>1、作用<br>stuff(param1, startIndex, length, param2)<br>将param1中自startIndex(SQL中都是从1开始，而非0)起，删除length个字符，然后用param2替换删掉的字符。</p>
<p>2、参数<br>param1<br>一个字符数据表达式。param1可以是常量、变量，也可以是字符列或二进制数据列。<br>startIndex<br>一个整数值，指定删除和插入的开始位置。如果 startIndex或 length 为负，则返回空字符串。如果startIndex比param1长，则返回空字符串。startIndex可以是 bigint 类型。<br>length<br>一个整数，指定要删除的字符数。如果 length 比param1长，则最多删除到param1 中的最后一个字符。length 可以是 bigint 类型。</p>
<p>3、返回类型<br>如果param1是受支持的字符数据类型，则返回字符数据。如果param1是一个受支持的 binary 数据类型，则返回二进制数据。<br>4、备注<br>如果结果值大于返回类型支持的最大值，则产生错误。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select STUFF(&apos;abcdefg&apos;,1,0,&apos;|zwxy|&apos;)       --结果为&apos;|zwxy|abcdefg&apos;</span><br><span class="line">select STUFF(&apos;abcdefg&apos;,1,1,&apos;|zwxy|&apos;)       --结果为&apos;|zwxy|bcdefg&apos;</span><br><span class="line">select STUFF(&apos;abcdefg&apos;,2,1,&apos;|zwxy|&apos;)       --结果为&apos;a|zwxy|cdefg&apos;</span><br><span class="line">select STUFF(&apos;abcdefg&apos;,2,2,&apos;|zwxy|&apos;)       --结果为&apos;a|zwxy|defg&apos;</span><br></pre></td></tr></table></figure></p>
<p>以上是stuff的用法<br>②for xml path:<br>for xml path有的人可能知道有的人可能不知道，其实它就是将查询结果集以XML形式展现，有了它我们可以简化我们的查询语句实现一些以前可能需要借助函数活存储过程来完成的工作。那么以一个实例为主.<br>我们还是通过列子引入：<br>还是以SC表为例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT student,course from sc for xml path</span><br></pre></td></tr></table></figure></p>
<p>结果如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">row</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">student</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">course</span>&gt;</span>大学语文<span class="tag">&lt;/<span class="name">course</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">row</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">student</span>&gt;</span>李四<span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">course</span>&gt;</span>大学语文<span class="tag">&lt;/<span class="name">course</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">row</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">student</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">course</span>&gt;</span>书法鉴赏<span class="tag">&lt;/<span class="name">course</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">row</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">student</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">course</span>&gt;</span>音乐赏析<span class="tag">&lt;/<span class="name">course</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">row</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">student</span>&gt;</span>李四<span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">course</span>&gt;</span>电影赏析<span class="tag">&lt;/<span class="name">course</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">row</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>由此可以看出 FOR XML PATH 可以将查询结果根据行输出成XML各式！而且我们还可以改变XML行节点的名称，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT student,course from sc for xml path(&apos;课程名称&apos;)</span><br></pre></td></tr></table></figure>
<p>看显示结果，原来的行节点<code>&lt;row&gt;</code>变成了我们在PATH后面括号()中自定义的名称<code>&lt;课程名称&gt;</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">课程名称</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">student</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">course</span>&gt;</span>大学语文<span class="tag">&lt;/<span class="name">course</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">课程名称</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">课程名称</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">student</span>&gt;</span>李四<span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">course</span>&gt;</span>大学语文<span class="tag">&lt;/<span class="name">course</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">课程名称</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">课程名称</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">student</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">course</span>&gt;</span>书法鉴赏<span class="tag">&lt;/<span class="name">course</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">课程名称</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">课程名称</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">student</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">course</span>&gt;</span>音乐赏析<span class="tag">&lt;/<span class="name">course</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">课程名称</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">课程名称</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">student</span>&gt;</span>李四<span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">course</span>&gt;</span>电影赏析<span class="tag">&lt;/<span class="name">course</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">课程名称</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其实我们还可以改变列节点，还记的给列起别名的关键字AS吗？就是用它!代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT student as 学生,course as 课程 from sc for xml path(&apos;课程名称&apos;)</span><br></pre></td></tr></table></figure></p>
<p>显示结果：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">课程名称</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">学生</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">学生</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">课程</span>&gt;</span>大学语文<span class="tag">&lt;/<span class="name">课程</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">课程名称</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">课程名称</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">学生</span>&gt;</span>李四<span class="tag">&lt;/<span class="name">学生</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">课程</span>&gt;</span>大学语文<span class="tag">&lt;/<span class="name">课程</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">课程名称</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">课程名称</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">学生</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">学生</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">课程</span>&gt;</span>书法鉴赏<span class="tag">&lt;/<span class="name">课程</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">课程名称</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">课程名称</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">学生</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">学生</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">课程</span>&gt;</span>音乐赏析<span class="tag">&lt;/<span class="name">课程</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">课程名称</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">课程名称</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">学生</span>&gt;</span>李四<span class="tag">&lt;/<span class="name">学生</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">课程</span>&gt;</span>电影赏析<span class="tag">&lt;/<span class="name">课程</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">课程名称</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>我们还可以构建我们喜欢的输出方式，看代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT &apos;[&apos;+student +&apos;:&apos;+course+&apos;],&apos;  from sc for xml path(&apos;&apos;)</span><br></pre></td></tr></table></figure></p>
<p>显示结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[张三:大学语文],[李四:大学语文],[张三:书法鉴赏],[张三:音乐赏析],[李四:电影赏析],</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/03/10/MySQL语法2（Limit分页、执行计划、慢日志查询）-Day62/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/10/MySQL语法2（Limit分页、执行计划、慢日志查询）-Day62/" itemprop="url">MySQL语法2（Limit分页、执行计划、慢日志查询）-Day62</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-10T21:42:45+08:00">
                2019-03-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MySQL语法2（Limit分页、执行计划、慢日志查询）-Day62"><a href="#MySQL语法2（Limit分页、执行计划、慢日志查询）-Day62" class="headerlink" title="MySQL语法2（Limit分页、执行计划、慢日志查询）-Day62"></a>MySQL语法2（Limit分页、执行计划、慢日志查询）-Day62</h2><h3 id="1-limit分页"><a href="#1-limit分页" class="headerlink" title="1. limit分页"></a>1. limit分页</h3><blockquote>
<p>无论是否有索引，Limitf分页是一个值得关注的问题</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">每页显示10条：</span><br><span class="line">当前 118 120， 125</span><br><span class="line"></span><br><span class="line">倒序：</span><br><span class="line">            大      小</span><br><span class="line">   970  7 6  6 5  54  43  32</span><br><span class="line">19 98     </span><br><span class="line">下一页：</span><br><span class="line"></span><br><span class="line">    select </span><br><span class="line">        * </span><br><span class="line">    from </span><br><span class="line">        tb1 </span><br><span class="line">    where </span><br><span class="line">        nid &lt; (select nid from (select nid from tb1 where nid &lt; 当前页最小值 order by nid desc limit 每页数据 *【页码-当前页】) A order by A.nid asc limit 1)  </span><br><span class="line">    order by </span><br><span class="line">        nid desc </span><br><span class="line">    limit 10;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    select </span><br><span class="line">        * </span><br><span class="line">    from </span><br><span class="line">        tb1 </span><br><span class="line">    where </span><br><span class="line">        nid &lt; (select nid from (select nid from tb1 where nid &gt; 970  order by nid desc limit 40) A order by A.nid asc limit 1)  </span><br><span class="line">    order by </span><br><span class="line">        nid desc </span><br><span class="line">    limit 10;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">上一页：</span><br><span class="line"></span><br><span class="line">    select </span><br><span class="line">        * </span><br><span class="line">    from </span><br><span class="line">        tb1 </span><br><span class="line">    where </span><br><span class="line">        nid &lt; (select nid from (select nid from tb1 where nid &lt; 当前页最大值 order by nid asc limit 每页数据 *【当前页-页码】) A order by A.nid asc limit 1)  </span><br><span class="line">    order by </span><br><span class="line">        nid desc </span><br><span class="line">    limit 10;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    select </span><br><span class="line">        * </span><br><span class="line">    from </span><br><span class="line">        tb1 </span><br><span class="line">    where </span><br><span class="line">        nid &lt; (select nid from (select nid from tb1 where nid &lt; 980 order by nid asc limit 20) A order by A.nid desc limit 1)  </span><br><span class="line">    order by </span><br><span class="line">        nid desc </span><br><span class="line">    limit 10;</span><br></pre></td></tr></table></figure>
<h3 id="2-执行计划"><a href="#2-执行计划" class="headerlink" title="2.执行计划"></a>2.执行计划</h3><blockquote>
<p>explain + 查询SQL - 用于显示SQL执行信息参数，根据参考信息可以进行SQL优化<br>type:<br>查询时的访问方式，性能：all &lt; index &lt; range &lt; index_merge &lt; ref_or_null &lt; ref &lt; eq_ref &lt; system/const<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from tb2;</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------+</span><br><span class="line">|  1 | SIMPLE      | tb2   | ALL  | NULL          | NULL | NULL    | NULL |    2 | NULL  |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">id</span><br><span class="line">        查询顺序标识</span><br><span class="line">            如：mysql&gt; explain select * from (select nid,name from tb1 where nid &lt; 10) as B;</span><br><span class="line">            +----+-------------+------------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">            | id | select_type | table      | type  | possible_keys | key     | key_len | ref  | rows | Extra       |</span><br><span class="line">            +----+-------------+------------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">            |  1 | PRIMARY     | &lt;derived2&gt; | ALL   | NULL          | NULL    | NULL    | NULL |    9 | NULL        |</span><br><span class="line">            |  2 | DERIVED     | tb1        | range | PRIMARY       | PRIMARY | 8       | NULL |    9 | Using where |</span><br><span class="line">            +----+-------------+------------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">        特别的：如果使用union连接气值可能为null</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    select_type</span><br><span class="line">        查询类型</span><br><span class="line">            SIMPLE          简单查询</span><br><span class="line">            PRIMARY         最外层查询</span><br><span class="line">            SUBQUERY        映射为子查询</span><br><span class="line">            DERIVED         子查询</span><br><span class="line">            UNION           联合</span><br><span class="line">            UNION RESULT    使用联合的结果</span><br><span class="line">            ...</span><br><span class="line">    table</span><br><span class="line">        正在访问的表名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    type</span><br><span class="line">        查询时的访问方式，性能：all &lt; index &lt; range &lt; index_merge &lt; ref_or_null &lt; ref &lt; eq_ref &lt; system/const</span><br><span class="line">            ALL             全表扫描，对于数据表从头到尾找一遍</span><br><span class="line">                            select * from tb1;</span><br><span class="line">                            特别的：如果有limit限制，则找到之后就不在继续向下扫描</span><br><span class="line">                                   select * from tb1 where email = &apos;seven@live.com&apos;</span><br><span class="line">                                   select * from tb1 where email = &apos;seven@live.com&apos; limit 1;</span><br><span class="line">                                   虽然上述两个语句都会进行全表扫描，第二句使用了limit，则找到一个后就不再继续扫描。</span><br><span class="line"></span><br><span class="line">            INDEX           全索引扫描，对索引从头到尾找一遍</span><br><span class="line">                            select nid from tb1;</span><br><span class="line"></span><br><span class="line">            RANGE          对索引列进行范围查找</span><br><span class="line">                            select *  from tb1 where name &lt; &apos;alex&apos;;</span><br><span class="line">                            PS:</span><br><span class="line">                                between and</span><br><span class="line">                                in</span><br><span class="line">                                &gt;   &gt;=  &lt;   &lt;=  操作</span><br><span class="line">                                注意：!= 和 &gt; 符号</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            INDEX_MERGE     合并索引，使用多个单列索引搜索</span><br><span class="line">                            select *  from tb1 where name = &apos;alex&apos; or nid in (11,22,33);</span><br><span class="line"></span><br><span class="line">            REF             根据索引查找一个或多个值</span><br><span class="line">                            select *  from tb1 where name = &apos;seven&apos;;</span><br><span class="line"></span><br><span class="line">            EQ_REF          连接时使用primary key 或 unique类型</span><br><span class="line">                            select tb2.nid,tb1.name from tb2 left join tb1 on tb2.nid = tb1.nid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            CONST           常量</span><br><span class="line">                            表最多有一个匹配行,因为仅有一行,在这行的列值可被优化器剩余部分认为是常数,const表很快,因为它们只读取一次。</span><br><span class="line">                            select nid from tb1 where nid = 2 ;</span><br><span class="line"></span><br><span class="line">            SYSTEM          系统</span><br><span class="line">                            表仅有一行(=系统表)。这是const联接类型的一个特例。</span><br><span class="line">                            select * from (select nid from tb1 where nid = 1) as A;</span><br><span class="line">    possible_keys</span><br><span class="line">        可能使用的索引</span><br><span class="line"></span><br><span class="line">    key</span><br><span class="line">        真实使用的</span><br><span class="line"></span><br><span class="line">    key_len</span><br><span class="line">        MySQL中使用索引字节长度</span><br><span class="line"></span><br><span class="line">    rows</span><br><span class="line">        mysql估计为了找到所需的行而要读取的行数 ------ 只是预估值</span><br><span class="line"></span><br><span class="line">    extra</span><br><span class="line">        该列包含MySQL解决查询的详细信息</span><br><span class="line">        “Using index”</span><br><span class="line">            此值表示mysql将使用覆盖索引，以避免访问表。不要把覆盖索引和index访问类型弄混了。</span><br><span class="line">        “Using where”</span><br><span class="line">            这意味着mysql服务器将在存储引擎检索行后再进行过滤，许多where条件里涉及索引中的列，当（并且如果）它读取索引时，就能被存储引擎检验，因此不是所有带where子句的查询都会显示“Using where”。有时“Using where”的出现就是一个暗示：查询可受益于不同的索引。</span><br><span class="line">        “Using temporary”</span><br><span class="line">            这意味着mysql在对查询结果排序时会使用一个临时表。</span><br><span class="line">        “Using filesort”</span><br><span class="line">            这意味着mysql会对结果使用一个外部索引排序，而不是按索引次序从表里读取行。mysql有两种文件排序算法，这两种排序方式都可以在内存或者磁盘上完成，explain不会告诉你mysql将使用哪一种文件排序，也不会告诉你排序会在内存里还是磁盘上完成。</span><br><span class="line">        “Range checked for each record(index map: N)”</span><br><span class="line">            这个意味着没有好用的索引，新的索引将在联接的每一行上重新估算，N是显示在possible_keys列中索引的位图，并且是冗余的。</span><br><span class="line"></span><br><span class="line">详细</span><br></pre></td></tr></table></figure>
<p><a href="http://www.cnblogs.com/xiaoboluo768/p/5400990.html" target="_blank" rel="noopener">更多详见1</a><br><a href="http://dev.mysql.com/doc/refman/5.7/en/explain-output.html#jointype_system" target="_blank" rel="noopener">更多详见2</a></p>
<h3 id="3-慢日志查询"><a href="#3-慢日志查询" class="headerlink" title="3. 慢日志查询"></a>3. 慢日志查询</h3><h4 id="3-1-配置MySQL自动记录慢日志"><a href="#3-1-配置MySQL自动记录慢日志" class="headerlink" title="3.1 配置MySQL自动记录慢日志"></a>3.1 配置MySQL自动记录慢日志</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">slow_query_log</span> = <span class="literal">OFF</span>                            是否开启慢日志记录</span><br><span class="line"><span class="attr">long_query_time</span> = <span class="number">2</span>                              时间限制，超过此时间，则记录</span><br><span class="line"><span class="attr">slow_query_log_file</span> = /usr/slow.log        日志文件</span><br><span class="line"><span class="attr">log_queries_not_using_indexes</span> = <span class="literal">OFF</span>     为使用索引的搜索是否记录</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注： 查看当前配置信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">	show variables like &apos;%query%&apos;</span><br><span class="line">-- 修改当前配置：</span><br><span class="line">	set global 变量名= 值</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="3-2-查看MySQL慢日志"><a href="#3-2-查看MySQL慢日志" class="headerlink" title="3.2 查看MySQL慢日志"></a>3.2 查看MySQL慢日志</h4><blockquote>
<p>mysqldumpslow -s at -a  /usr/local/var/mysql/MacBook-Pro-3-slow.log<br>以下是打开的日志文件的一些命令参数<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">"""</span><br><span class="line">--verbose    版本</span><br><span class="line">--debug      调试</span><br><span class="line">--help       帮助</span><br><span class="line"> </span><br><span class="line">-v           版本</span><br><span class="line">-d           调试模式</span><br><span class="line">-s ORDER     排序方式</span><br><span class="line">             what to sort by (al, at, ar, c, l, r, t), 'at' is default</span><br><span class="line">              al: average lock time</span><br><span class="line">              ar: average rows sent</span><br><span class="line">              at: average query time</span><br><span class="line">               c: count</span><br><span class="line">               l: lock time</span><br><span class="line">               r: rows sent</span><br><span class="line">               t: query time</span><br><span class="line">-r           反转顺序，默认文件倒序拍。reverse the sort order (largest last instead of first)</span><br><span class="line">-t NUM       显示前N条just show the top n queries</span><br><span class="line">-a           不要将SQL中数字转换成N，字符串转换成S。don't abstract all numbers to N and strings to 'S'</span><br><span class="line">-n NUM       abstract numbers with at least n digits within names</span><br><span class="line">-g PATTERN   正则匹配；grep: only consider stmts that include this string</span><br><span class="line">-h HOSTNAME  mysql机器名或者IP；hostname of db server for *-slow.log filename (can be wildcard),</span><br><span class="line">             default is '*', i.e. match all</span><br><span class="line">-i NAME      name of server instance (if using mysql.server startup script)</span><br><span class="line">-l           总时间中不减去锁定时间；don't subtract lock time from total time</span><br><span class="line">"""</span><br></pre></td></tr></table></figure></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/03/03/MySQL语法（视图、函数、触发器、存储过程、事务）-Day61/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/03/MySQL语法（视图、函数、触发器、存储过程、事务）-Day61/" itemprop="url">MySQL语法（视图、函数、触发器、存储过程、事务、条件语句、循环语句、动态SQL）-Day61</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-03T21:48:02+08:00">
                2019-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3.8k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  17
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MySQL语法（视图、函数、触发器、存储过程、事务、条件语句、循环语句、动态SQL）-Day61"><a href="#MySQL语法（视图、函数、触发器、存储过程、事务、条件语句、循环语句、动态SQL）-Day61" class="headerlink" title="MySQL语法（视图、函数、触发器、存储过程、事务、条件语句、循环语句、动态SQL）-Day61"></a>MySQL语法（视图、函数、触发器、存储过程、事务、条件语句、循环语句、动态SQL）-Day61</h2><h3 id="1-视图"><a href="#1-视图" class="headerlink" title="1. 视图"></a>1. 视图</h3><h4 id="1-1-创建视图"><a href="#1-1-创建视图" class="headerlink" title="1.1 创建视图"></a>1.1 创建视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--格式：CREATE VIEW 视图名称 AS  SQL语句</span><br><span class="line">CREATE VIEW V1 AS</span><br><span class="line">SELECT cid,cname,teacher_id,tname FROM course</span><br><span class="line">LEFT JOIN teacher ON course.teacher_id=teacher.tid</span><br></pre></td></tr></table></figure>
<h4 id="1-2-删除视图"><a href="#1-2-删除视图" class="headerlink" title="1.2  删除视图"></a>1.2  删除视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--格式：DROP VIEW 视图名称</span><br><span class="line">DROP VIEW V1</span><br></pre></td></tr></table></figure>
<h4 id="1-3-修改视图"><a href="#1-3-修改视图" class="headerlink" title="1.3 修改视图"></a>1.3 修改视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 格式：ALTER VIEW 视图名称 AS SQL语句</span><br><span class="line">ALTER VIEW V1 AS</span><br><span class="line">SELECT cid,cname,tname FROM course</span><br><span class="line">LEFT JOIN teacher ON course.teacher_id=teacher.tid</span><br></pre></td></tr></table></figure>
<h4 id="1-4-使用视图"><a href="#1-4-使用视图" class="headerlink" title="1.4  使用视图"></a>1.4  使用视图</h4><blockquote>
<p>使用视图时，将其当作表进行操作即可，由于视图是虚拟表，所以无法使用其对真实表进行创建、更新和删除操作，仅能做查询用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM V1</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-触发器"><a href="#2-触发器" class="headerlink" title="2. 触发器"></a>2. 触发器</h3><blockquote>
<p>对某个表进行【增/删/改】操作的前后如果希望触发某个特定的行为时，可以使用触发器，触发器用于定制用户对表的行进行【增/删/改】前后的行为。</p>
</blockquote>
<h4 id="2-1-创建语法"><a href="#2-1-创建语法" class="headerlink" title="2.1 创建语法"></a>2.1 创建语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">-- delimiter // 更改mysql语句默认结束符号（默认为;）</span><br><span class="line">-- NEW 表示update、insert前的临时表</span><br><span class="line">-- OLD 表示delete前的临时表</span><br><span class="line">-- NEW表示即将插入的数据行，OLD表示即将删除的数据行。</span><br><span class="line">-- 插入前</span><br><span class="line">delimiter //  </span><br><span class="line">CREATE TRIGGER TRI_BEFORE_INSERT_a1 BEFORE INSERT ON a FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">insert into b(num) VALUES (NEW.num);</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 插入后</span><br><span class="line">delimiter //</span><br><span class="line">CREATE TRIGGER TRI_AFTER_INSERT_a2 AFTER INSERT ON a FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">INSERT INTO b(num) VALUES(NEW.num+5);</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 删除前</span><br><span class="line">delimiter //</span><br><span class="line">CREATE TRIGGER TRI_BEFORE_DELETE_a3 BEFORE DELETE ON a FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">delete from b where num = OLD.num;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 删除后</span><br><span class="line">delimiter //</span><br><span class="line">CREATE TRIGGER TRI_AFTER_DELETE_a4 AFTER DELETE ON a FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">delete from b where num = OLD.num+5;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 更新前</span><br><span class="line">delimiter //</span><br><span class="line">CREATE TRIGGER TRI_BEFORE_UPDATE_a5 BEFORE UPDATE ON a FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">UPDATE b set num = NEW.num WHERE b.num = OLD.num; -- a表变动b表相同的数字跟着变动</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 更新后</span><br><span class="line">delimiter //</span><br><span class="line">CREATE TRIGGER TRI_AFTER_UPDATE_a6 AFTER UPDATE ON a FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">UPDATE b set num = NEW.num WHERE b.num = OLD.num; -- a表变动b表相同的数字跟着变动</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-删除触发器"><a href="#2-2-删除触发器" class="headerlink" title="2.2 删除触发器"></a>2.2 删除触发器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TRIGGER 触发器名称;</span><br></pre></td></tr></table></figure>
<h3 id="3-存储过程"><a href="#3-存储过程" class="headerlink" title="3.存储过程"></a>3.存储过程</h3><blockquote>
<p>存储过程是一个SQL语句集合，当主动去调用存储过程时，其中内部的SQL语句会按照逻辑执行。</p>
</blockquote>
<h4 id="3-1-创建存储过程"><a href="#3-1-创建存储过程" class="headerlink" title="3.1 创建存储过程"></a>3.1 创建存储过程</h4><h5 id="3-1-1-无参数过程"><a href="#3-1-1-无参数过程" class="headerlink" title="3.1.1  无参数过程"></a>3.1.1  无参数过程</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P1()</span><br><span class="line">BEGIN</span><br><span class="line">SELECT * FROM SCORE;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 执行存储过程</span><br><span class="line">call P1()</span><br></pre></td></tr></table></figure>
<h5 id="3-1-2-有参数过程"><a href="#3-1-2-有参数过程" class="headerlink" title="3.1.2 有参数过程"></a>3.1.2 有参数过程</h5><blockquote>
<p>对于存储过程，可以接收参数，其参数有三类：</p>
<ul>
<li>in        仅用于传入参数作用</li>
<li>out        仅用于返回值用</li>
<li>inout    既可以传入又可以当作返回值</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- 创建存储过程</span><br><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P2(</span><br><span class="line">in i1 int,</span><br><span class="line">in i2 int,</span><br><span class="line">inout i3 int,</span><br><span class="line">out r1 int</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE tmp1 int;</span><br><span class="line">DECLARE tmp2 int default 0;</span><br><span class="line">set tmp1 = 1;</span><br><span class="line">set r1 = i1+i2+tmp1+tmp2;</span><br><span class="line">set i3 = i3+100;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 执行存储过程</span><br><span class="line">set @t1 = 100;</span><br><span class="line">set @t2 = 0;</span><br><span class="line">call p2(3,4,@t1,@t2);</span><br><span class="line">select @t1,@t2;</span><br></pre></td></tr></table></figure>
<h6 id="3-1-2-1-带结果集的存储过程"><a href="#3-1-2-1-带结果集的存储过程" class="headerlink" title="3.1.2.1 带结果集的存储过程"></a>3.1.2.1 带结果集的存储过程</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P3()</span><br><span class="line">BEGIN</span><br><span class="line">SELECT * FROM SCORE;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h6 id="3-1-2-2-结果集-OUT值"><a href="#3-1-2-2-结果集-OUT值" class="headerlink" title="3.1.2.2 结果集+OUT值"></a>3.1.2.2 结果集+OUT值</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P4(</span><br><span class="line">in n1 int,</span><br><span class="line">inout n3 int,</span><br><span class="line">out n2 int</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE tmp1 int;</span><br><span class="line">DECLARE tmp2 int default 0;</span><br><span class="line">SELECT * FROM SCORE;</span><br><span class="line">SET n2 = n1 + 100;</span><br><span class="line">SET n3 = n3 + n1 +100;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h6 id="3-1-2-3-带事务的存储过程"><a href="#3-1-2-3-带事务的存储过程" class="headerlink" title="3.1.2.3 带事务的存储过程"></a>3.1.2.3 带事务的存储过程</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P5(</span><br><span class="line">OUT return_code tinyint</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE exit handler for sqlexception</span><br><span class="line">	BEGIN</span><br><span class="line">		-- ERROR</span><br><span class="line">		SET return_code = 1;</span><br><span class="line">		rollback;</span><br><span class="line">	END;</span><br><span class="line">DECLARE exit handler for sqlwarning</span><br><span class="line">	BEGIN</span><br><span class="line">	-- WARNING</span><br><span class="line">	SET return_code = 2;</span><br><span class="line">	rollback;</span><br><span class="line">	END;</span><br><span class="line">START TRANSACTION;</span><br><span class="line">DELETE FROM b;</span><br><span class="line">insert into a(num) values(99);</span><br><span class="line">COMMIT;</span><br><span class="line">--SUCCESS</span><br><span class="line">SET return_code = 0;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h6 id="3-1-2-4-带游标的存储过程"><a href="#3-1-2-4-带游标的存储过程" class="headerlink" title="3.1.2.4 带游标的存储过程"></a>3.1.2.4 带游标的存储过程</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P6()</span><br><span class="line">BEGIN</span><br><span class="line">declare ssid int;</span><br><span class="line">declare ssname varchar(50);</span><br><span class="line">declare done int default FALSE;</span><br><span class="line">declare my_cursor CURSOR FOR SELECT sid,sname from student;</span><br><span class="line">declare continue handler for NOT FOUND SET done = TRUE;</span><br><span class="line">open my_cursor;</span><br><span class="line">	eg:LOOP</span><br><span class="line">		fetch my_cursor into ssid,ssname;</span><br><span class="line">		if done then</span><br><span class="line">			leave eg;</span><br><span class="line">		end if;</span><br><span class="line">		insert into teacher(tname) values(ssname);</span><br><span class="line">	END loop eg;</span><br><span class="line">CLOSE my_cursor;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h6 id="3-1-2-5-动态执行SQL"><a href="#3-1-2-5-动态执行SQL" class="headerlink" title="3.1.2.5 动态执行SQL"></a>3.1.2.5 动态执行SQL</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P7(</span><br><span class="line">in nid int</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">set @nnid = nid;</span><br><span class="line">-- PREPARE 把...准备好</span><br><span class="line">PREPARE prod FROM &apos;SELECT * FROM student where sid &gt; ?&apos;;</span><br><span class="line">EXECUTE prod USING @nnid;</span><br><span class="line">DEALLOCATE PREPARE prod;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-删除存储过程"><a href="#3-2-删除存储过程" class="headerlink" title="3.2 删除存储过程"></a>3.2 删除存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop procedure proc_name;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-执行存储过程"><a href="#3-3-执行存储过程" class="headerlink" title="3.3 执行存储过程"></a>3.3 执行存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- 无参数</span><br><span class="line">CALL Proc_name()</span><br><span class="line">-- 有参数，全in</span><br><span class="line">CALL proc_name(参数1，参数2,...)</span><br><span class="line">-- 有参数，有in,out,inout</span><br><span class="line">set @t1 = 0;</span><br><span class="line">set @t2 = 5;</span><br><span class="line">CALL proc_name(1,2,@t1,@t2)</span><br><span class="line">SELECT @t1,@t2</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pymysql执行存储过程</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">conn = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'******'</span>, database=<span class="string">'db1'</span> )</span><br><span class="line">cur = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class="line">cur.callproc(<span class="string">'p7'</span>, args=(<span class="number">1</span>,))</span><br><span class="line">ret = cur.fecthall()</span><br><span class="line">print(ret)</span><br><span class="line">cur.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<h3 id="3-函数"><a href="#3-函数" class="headerlink" title="3.函数"></a>3.函数</h3><h4 id="3-1-内置函数"><a href="#3-1-内置函数" class="headerlink" title="3.1 内置函数"></a>3.1 内置函数</h4><blockquote>
<p>MySQL中提供了许多内置函数，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">CHAR_LENGTH(str)</span><br><span class="line">       返回值为字符串str 的长度，长度的单位为字符。一个多字节字符算作一个单字符。</span><br><span class="line">       对于一个包含五个二字节字符集, LENGTH()返回值为 10, 而CHAR_LENGTH()的返回值为5。</span><br><span class="line"></span><br><span class="line">   CONCAT(str1,str2,...)</span><br><span class="line">       字符串拼接</span><br><span class="line">       如有任何一个参数为NULL ，则返回值为 NULL。</span><br><span class="line">   CONCAT_WS(separator,str1,str2,...)</span><br><span class="line">       字符串拼接（自定义连接符）</span><br><span class="line">       CONCAT_WS()不会忽略任何空字符串。 (然而会忽略所有的 NULL）。</span><br><span class="line"></span><br><span class="line">   CONV(N,from_base,to_base)</span><br><span class="line">       进制转换</span><br><span class="line">       例如：</span><br><span class="line">           SELECT CONV(&apos;a&apos;,16,2); 表示将 a 由16进制转换为2进制字符串表示</span><br><span class="line"></span><br><span class="line">   FORMAT(X,D)</span><br><span class="line">       将数字X 的格式写为&apos;#,###,###.##&apos;,以四舍五入的方式保留小数点后 D 位， 并将结果以字符串的形式返回。若  D 为 0, 则返回结果不带有小数点，或不含小数部分。</span><br><span class="line">       例如：</span><br><span class="line">           SELECT FORMAT(12332.1,4); 结果为： &apos;12,332.1000&apos;</span><br><span class="line">   INSERT(str,pos,len,newstr)</span><br><span class="line">       在str的指定位置插入字符串</span><br><span class="line">           pos：要替换位置其实位置</span><br><span class="line">           len：替换的长度</span><br><span class="line">           newstr：新字符串</span><br><span class="line">       特别的：</span><br><span class="line">           如果pos超过原字符串长度，则返回原字符串</span><br><span class="line">           如果len超过原字符串长度，则由新字符串完全替换</span><br><span class="line">   INSTR(str,substr)</span><br><span class="line">       返回字符串 str 中子字符串的第一个出现位置。</span><br><span class="line"></span><br><span class="line">   LEFT(str,len)</span><br><span class="line">       返回字符串str 从开始的len位置的子序列字符。</span><br><span class="line"></span><br><span class="line">   LOWER(str)</span><br><span class="line">       变小写</span><br><span class="line"></span><br><span class="line">   UPPER(str)</span><br><span class="line">       变大写</span><br><span class="line"></span><br><span class="line">   LTRIM(str)</span><br><span class="line">       返回字符串 str ，其引导空格字符被删除。</span><br><span class="line">   RTRIM(str)</span><br><span class="line">       返回字符串 str ，结尾空格字符被删去。</span><br><span class="line">   SUBSTRING(str,pos,len)</span><br><span class="line">       获取字符串子序列</span><br><span class="line"></span><br><span class="line">   LOCATE(substr,str,pos)</span><br><span class="line">       获取子序列索引位置</span><br><span class="line"></span><br><span class="line">   REPEAT(str,count)</span><br><span class="line">       返回一个由重复的字符串str 组成的字符串，字符串str的数目等于count 。</span><br><span class="line">       若 count &lt;= 0,则返回一个空字符串。</span><br><span class="line">       若str 或 count 为 NULL，则返回 NULL 。</span><br><span class="line">   REPLACE(str,from_str,to_str)</span><br><span class="line">       返回字符串str 以及所有被字符串to_str替代的字符串from_str 。</span><br><span class="line">   REVERSE(str)</span><br><span class="line">       返回字符串 str ，顺序和字符顺序相反。</span><br><span class="line">   RIGHT(str,len)</span><br><span class="line">       从字符串str 开始，返回从后边开始len个字符组成的子序列</span><br><span class="line"></span><br><span class="line">   SPACE(N)</span><br><span class="line">       返回一个由N空格组成的字符串。</span><br><span class="line"></span><br><span class="line">   SUBSTRING(str,pos) , SUBSTRING(str FROM pos) SUBSTRING(str,pos,len) , SUBSTRING(str FROM pos FOR len)</span><br><span class="line">       不带有len 参数的格式从字符串str返回一个子字符串，起始于位置 pos。带有len参数的格式从字符串str返回一个长度同len字符相同的子字符串，起始于位置 pos。 使用 FROM的格式为标准 SQL 语法。也可能对pos使用一个负值。假若这样，则子字符串的位置起始于字符串结尾的pos 字符，而不是字符串的开头位置。在以下格式的函数中可以对pos 使用一个负值。</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT SUBSTRING(&apos;Quadratically&apos;,5);</span><br><span class="line">           -&gt; &apos;ratically&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT SUBSTRING(&apos;foobarbar&apos; FROM 4);</span><br><span class="line">           -&gt; &apos;barbar&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT SUBSTRING(&apos;Quadratically&apos;,5,6);</span><br><span class="line">           -&gt; &apos;ratica&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT SUBSTRING(&apos;Sakila&apos;, -3);</span><br><span class="line">           -&gt; &apos;ila&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT SUBSTRING(&apos;Sakila&apos;, -5, 3);</span><br><span class="line">           -&gt; &apos;aki&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT SUBSTRING(&apos;Sakila&apos; FROM -4 FOR 2);</span><br><span class="line">           -&gt; &apos;ki&apos;</span><br><span class="line"></span><br><span class="line">   TRIM([&#123;BOTH | LEADING | TRAILING&#125; [remstr] FROM] str) TRIM(remstr FROM] str)</span><br><span class="line">       返回字符串 str ， 其中所有remstr 前缀和/或后缀都已被删除。若分类符BOTH、LEADIN或TRAILING中没有一个是给定的,则假设为BOTH 。 remstr 为可选项，在未指定情况下，可删除空格。</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT TRIM(&apos;  bar   &apos;);</span><br><span class="line">               -&gt; &apos;bar&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT TRIM(LEADING &apos;x&apos; FROM &apos;xxxbarxxx&apos;);</span><br><span class="line">               -&gt; &apos;barxxx&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT TRIM(BOTH &apos;x&apos; FROM &apos;xxxbarxxx&apos;);</span><br><span class="line">               -&gt; &apos;bar&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT TRIM(TRAILING &apos;xyz&apos; FROM &apos;barxxyz&apos;);</span><br><span class="line">               -&gt; &apos;barx&apos;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>更多函数 —-&gt;<br><a href="http://www.runoob.com/mysql/mysql-functions.html" target="_blank" rel="noopener">中文点击这里</a><br><a href="https://dev.mysql.com/doc/refman/5.7/en/functions.html" target="_blank" rel="noopener">官方点击这里</a></p>
<h4 id="3-2-自定义函数"><a href="#3-2-自定义函数" class="headerlink" title="3.2 自定义函数"></a>3.2 自定义函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE FUNCTION F1(</span><br><span class="line">i1 int,</span><br><span class="line">i2 int</span><br><span class="line">)</span><br><span class="line">returns int</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE num int;</span><br><span class="line">	set num = i1 + i2;</span><br><span class="line">	return(num);</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-删除函数"><a href="#3-3-删除函数" class="headerlink" title="3.3 删除函数"></a>3.3 删除函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop function func_name;</span><br></pre></td></tr></table></figure>
<h4 id="3-4-执行函数"><a href="#3-4-执行函数" class="headerlink" title="3.4 执行函数"></a>3.4 执行函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 获取返回值</span><br><span class="line">DECLARE @i varchar(32);</span><br><span class="line">SELECT UPPER(&apos;alex&apos;) into @i;</span><br><span class="line">SELECT @i;</span><br><span class="line">-- 在查询中使用</span><br><span class="line">SELECT F1(100，200),name FROM tb2;</span><br></pre></td></tr></table></figure>
<h3 id="4-事务"><a href="#4-事务" class="headerlink" title="4 .事务"></a>4 .事务</h3><h4 id="4-1-支持事务的存储过程"><a href="#4-1-支持事务的存储过程" class="headerlink" title="4.1 支持事务的存储过程"></a>4.1 支持事务的存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P5(</span><br><span class="line">OUT return_code tinyint</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE exit handler for sqlexception</span><br><span class="line">	BEGIN</span><br><span class="line">		-- ERROR</span><br><span class="line">		SET return_code = 1;</span><br><span class="line">		rollback;</span><br><span class="line">	END;</span><br><span class="line">DECLARE exit handler for sqlwarning</span><br><span class="line">	BEGIN</span><br><span class="line">	-- WARNING</span><br><span class="line">	SET return_code = 2;</span><br><span class="line">	rollback;</span><br><span class="line">	END;</span><br><span class="line">START TRANSACTION;</span><br><span class="line">DELETE FROM b;</span><br><span class="line">insert into a(num) values(99);</span><br><span class="line">COMMIT;</span><br><span class="line">--SUCCESS</span><br><span class="line">SET return_code = 0;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line">-- 执行存储过程</span><br><span class="line">DECLARE @n int;</span><br><span class="line">set @n = 5;</span><br><span class="line">call p5(@n);</span><br><span class="line">select @n;</span><br></pre></td></tr></table></figure>
<h3 id="5-索引"><a href="#5-索引" class="headerlink" title="5 .索引"></a>5 .索引</h3><blockquote>
<p>索引，是数据库中专门用于帮助用户快速查询数据的一种数据结构。类似于字典中的目录，查找字典内容时可以根据目录查找到数据的存放位置，然后直接获取即可。<br>MySQL中常见索引有：</p>
<ul>
<li>普通索引    仅加速查询</li>
<li>唯一索引    加速查询+列值唯一（可以有Null)</li>
<li>主键索引    加速查询+列值唯一+表中只有一个（不可以有null）</li>
<li>组合索引    多列值组成一个索引，专门用于组合搜索，其效率大于索引合并</li>
<li>全文索引    对文本的内容进行分词，进行搜索<br>PS:索引合并：使用多个单列索引组合搜索<br>PS:覆盖索引：select的数据列只用从索引中就能够取得，不必读取数据行，换句话说查询列要被所建的索引覆盖</li>
</ul>
</blockquote>
<h4 id="5-1-普通索引"><a href="#5-1-普通索引" class="headerlink" title="5.1 普通索引"></a>5.1 普通索引</h4><blockquote>
<p>普通索引仅有一个功能：加速查询</p>
</blockquote>
<h5 id="5-1-1-创建表时建立普通索引"><a href="#5-1-1-创建表时建立普通索引" class="headerlink" title="5.1.1 创建表时建立普通索引"></a>5.1.1 创建表时建立普通索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table in1(</span><br><span class="line">    nid int not null auto_increment primary key,</span><br><span class="line">    name varchar(32) not null,</span><br><span class="line">    email varchar(64) not null,</span><br><span class="line">    extra text,</span><br><span class="line">    index ix_name (name)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="5-1-2-创建普通索引"><a href="#5-1-2-创建普通索引" class="headerlink" title="5.1.2 创建普通索引"></a>5.1.2 创建普通索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create index 索引名称 on 表名（列名）</span><br><span class="line">-- 注意：对于创建索引时如果是BLOB 和 TEXT 类型，必须指定length。</span><br><span class="line">create index ix_extra on in1(extra(32));</span><br></pre></td></tr></table></figure>
<h5 id="5-1-3-删除普通索引"><a href="#5-1-3-删除普通索引" class="headerlink" title="5.1.3 删除普通索引"></a>5.1.3 删除普通索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop index 索引名称 on 表名</span><br></pre></td></tr></table></figure>
<h5 id="5-1-4-查看索引"><a href="#5-1-4-查看索引" class="headerlink" title="5.1.4 查看索引"></a>5.1.4 查看索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show index from 表名</span><br></pre></td></tr></table></figure>
<h4 id="5-2-唯一索引"><a href="#5-2-唯一索引" class="headerlink" title="5.2 唯一索引"></a>5.2 唯一索引</h4><blockquote>
<p>唯一索引有两个功能：加速查询 和 唯一约束（可含null）</p>
</blockquote>
<h5 id="5-2-1-创建表时建立唯一索引"><a href="#5-2-1-创建表时建立唯一索引" class="headerlink" title="5.2.1 创建表时建立唯一索引"></a>5.2.1 创建表时建立唯一索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table in1(</span><br><span class="line">    nid int not null auto_increment primary key,</span><br><span class="line">    name varchar(32) not null,</span><br><span class="line">    email varchar(64) not null,</span><br><span class="line">    extra text,</span><br><span class="line">    unique ix_name (name)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="5-2-2-创建唯一索引"><a href="#5-2-2-创建唯一索引" class="headerlink" title="5.2.2 创建唯一索引"></a>5.2.2 创建唯一索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create unique index 索引名称 on 表名（列名）</span><br></pre></td></tr></table></figure>
<h5 id="5-2-3-删除唯一索引"><a href="#5-2-3-删除唯一索引" class="headerlink" title="5.2.3 删除唯一索引"></a>5.2.3 删除唯一索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop unique index 索引名称 on 表名</span><br></pre></td></tr></table></figure>
<h4 id="5-3-主键索引"><a href="#5-3-主键索引" class="headerlink" title="5.3 主键索引"></a>5.3 主键索引</h4><blockquote>
<p>主键有两个功能：加速查询 和 唯一约束（不可含null）</p>
</blockquote>
<h5 id="5-3-1-创建表时建立主键索引"><a href="#5-3-1-创建表时建立主键索引" class="headerlink" title="5.3.1 创建表时建立主键索引"></a>5.3.1 创建表时建立主键索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">create table in1(</span><br><span class="line">    nid int not null auto_increment primary key,</span><br><span class="line">    name varchar(32) not null,</span><br><span class="line">    email varchar(64) not null,</span><br><span class="line">    extra text,</span><br><span class="line">    index ix_name (name)</span><br><span class="line">)</span><br><span class="line">-- 或者</span><br><span class="line">create table in1(</span><br><span class="line">    nid int not null auto_increment,</span><br><span class="line">    name varchar(32) not null,</span><br><span class="line">    email varchar(64) not null,</span><br><span class="line">    extra text,</span><br><span class="line">    primary key(ni1),</span><br><span class="line">    index ix_name (name)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="5-3-2-创建主键"><a href="#5-3-2-创建主键" class="headerlink" title="5.3.2 创建主键"></a>5.3.2 创建主键</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add primary key(列名)</span><br></pre></td></tr></table></figure>
<h5 id="5-3-3-删除唯一索引"><a href="#5-3-3-删除唯一索引" class="headerlink" title="5.3.3 删除唯一索引"></a>5.3.3 删除唯一索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop primary key;</span><br><span class="line">alter table 表名 modify 列名 int,drop primary key;</span><br></pre></td></tr></table></figure>
<h4 id="5-4-组合索引"><a href="#5-4-组合索引" class="headerlink" title="5.4 组合索引"></a>5.4 组合索引</h4><blockquote>
<p>组合索引是将n个列组合成一个索引<br>其应用场景为：频繁的同时使用n列来进行查询，如：where n1 = ‘alex’ and n2 = 666。</p>
</blockquote>
<h5 id="5-4-1-创建表"><a href="#5-4-1-创建表" class="headerlink" title="5.4.1 创建表"></a>5.4.1 创建表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table in3(</span><br><span class="line">    nid int not null auto_increment primary key,</span><br><span class="line">    name varchar(32) not null,</span><br><span class="line">    email varchar(64) not null,</span><br><span class="line">    extra text</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="5-4-2-创建组合索引"><a href="#5-4-2-创建组合索引" class="headerlink" title="5.4.2 创建组合索引"></a>5.4.2 创建组合索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create index 索引名称 on 表名（name,email，...）</span><br><span class="line">-- 如上创建组合索引之后，查询：</span><br><span class="line">-- name and email  -- 使用索引</span><br><span class="line">-- name                 -- 使用索引</span><br><span class="line">-- email                 -- 不使用索引</span><br><span class="line">-- 注意：对于同时搜索n个条件时，组合索引的性能好于多个单一索引合并。</span><br></pre></td></tr></table></figure>
<h4 id="5-5-索引补充"><a href="#5-5-索引补充" class="headerlink" title="5.5 索引补充"></a>5.5 索引补充</h4><h5 id="5-5-1-相关命令-查看表结构、生成表的SQL、查看索引、执行时间"><a href="#5-5-1-相关命令-查看表结构、生成表的SQL、查看索引、执行时间" class="headerlink" title="5.5.1 相关命令(查看表结构、生成表的SQL、查看索引、执行时间)"></a>5.5.1 相关命令(查看表结构、生成表的SQL、查看索引、执行时间)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- 查看表结构</span><br><span class="line">	desc 表名</span><br><span class="line">-- 查看生成表的SQL</span><br><span class="line">	show create table 表名</span><br><span class="line">-- 查看索引</span><br><span class="line">	show index from 表名</span><br><span class="line">-- 查看执行时间</span><br><span class="line">	SET profiling =1;</span><br><span class="line">	SQL...</span><br><span class="line">	SHOW profiles;</span><br></pre></td></tr></table></figure>
<h5 id="5-5-2-使用索引和不使用索引"><a href="#5-5-2-使用索引和不使用索引" class="headerlink" title="5.5.2 使用索引和不使用索引"></a>5.5.2 使用索引和不使用索引</h5><blockquote>
<p>由于索引是专门用于加速搜索而生，所以加上索引之后，查询效率会快到飞起来。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- 有索引</span><br><span class="line">mysql&gt; select * from tb1 where name = &apos;wupeiqi-888&apos;;</span><br><span class="line">+-----+-------------+---------------------+----------------------------------+---------------------+</span><br><span class="line">| nid | name        | email               | radom                            | ctime               |</span><br><span class="line">+-----+-------------+---------------------+----------------------------------+---------------------+</span><br><span class="line">| 889 | wupeiqi-888 | wupeiqi888@live.com | 5312269e76a16a90b8a8301d5314204b | 2016-08-03 09:33:35 |</span><br><span class="line">+-----+-------------+---------------------+----------------------------------+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">-- 无索引</span><br><span class="line">mysql&gt; select * from tb1 where email = &apos;wupeiqi888@live.com&apos;;</span><br><span class="line">+-----+-------------+---------------------+----------------------------------+---------------------+</span><br><span class="line">| nid | name        | email               | radom                            | ctime               |</span><br><span class="line">+-----+-------------+---------------------+----------------------------------+---------------------+</span><br><span class="line">| 889 | wupeiqi-888 | wupeiqi888@live.com | 5312269e76a16a90b8a8301d5314204b | 2016-08-03 09:33:35 |</span><br><span class="line">+-----+-------------+---------------------+----------------------------------+---------------------+</span><br><span class="line">1 row in set (1.23 sec)</span><br></pre></td></tr></table></figure>
<h5 id="5-5-3-正确使用索引"><a href="#5-5-3-正确使用索引" class="headerlink" title="5.5.3 正确使用索引"></a>5.5.3 正确使用索引</h5><blockquote>
<p>数据库表中添加索引后确实会让查询速度起飞，但前提必须是正确的使用索引来查询，如果以错误的方式使用，则即使建立索引也会不奏效。<br>即使建立索引，索引也不会生效：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">- like &apos;%xx&apos;</span><br><span class="line">    select * from tb1 where name like &apos;%cn&apos;;</span><br><span class="line">- 使用函数</span><br><span class="line">    select * from tb1 where reverse(name) = &apos;wupeiqi&apos;;</span><br><span class="line">- or</span><br><span class="line">    select * from tb1 where nid = 1 or email = &apos;seven@live.com&apos;;</span><br><span class="line">    特别的：当or条件中有未建立索引的列才失效，以下会走索引</span><br><span class="line">            select * from tb1 where nid = 1 or name = &apos;seven&apos;;</span><br><span class="line">            select * from tb1 where nid = 1 or email = &apos;seven@live.com&apos; and name = &apos;alex&apos;</span><br><span class="line">- 类型不一致</span><br><span class="line">    如果列是字符串类型，传入条件是必须用引号引起来，不然...</span><br><span class="line">    select * from tb1 where name = 999;</span><br><span class="line">- !=</span><br><span class="line">    select * from tb1 where name != &apos;alex&apos;</span><br><span class="line">    特别的：如果是主键，则还是会走索引</span><br><span class="line">        select * from tb1 where nid != 123</span><br><span class="line">- &gt;</span><br><span class="line">    select * from tb1 where name &gt; &apos;alex&apos;</span><br><span class="line">    特别的：如果是主键或索引是整数类型，则还是会走索引</span><br><span class="line">        select * from tb1 where nid &gt; 123</span><br><span class="line">        select * from tb1 where num &gt; 123</span><br><span class="line">- order by</span><br><span class="line">    select email from tb1 order by name desc;</span><br><span class="line">    当根据索引排序时候，选择的映射如果不是索引，则不走索引</span><br><span class="line">    特别的：如果对主键排序，则还是走索引：</span><br><span class="line">        select * from tb1 order by nid desc;</span><br><span class="line"> </span><br><span class="line">- 组合索引最左前缀</span><br><span class="line">    如果组合索引为：(name,email)</span><br><span class="line">    name and email       -- 使用索引</span><br><span class="line">    name                 -- 使用索引</span><br><span class="line">    email                -- 不使用索引</span><br></pre></td></tr></table></figure>
<h5 id="5-5-4-其他注意事项"><a href="#5-5-4-其他注意事项" class="headerlink" title="5.5.4 其他注意事项"></a>5.5.4 其他注意事项</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- 避免使用select *</span><br><span class="line">- count(1)或count(列) 代替 count(*)</span><br><span class="line">- 创建表时尽量时 char 代替 varchar</span><br><span class="line">- 表的字段顺序固定长度的字段优先</span><br><span class="line">- 组合索引代替多个单列索引（经常使用多个条件查询时）</span><br><span class="line">- 尽量使用短索引</span><br><span class="line">- 使用连接（JOIN）来代替子查询(Sub-Queries)</span><br><span class="line">- 连表时注意条件类型需一致</span><br><span class="line">- 索引散列值（重复少）不适合建索引，例：性别不适合</span><br></pre></td></tr></table></figure>
<h3 id="6-条件语句、循环语句、动态SQL"><a href="#6-条件语句、循环语句、动态SQL" class="headerlink" title="6 .条件语句、循环语句、动态SQL"></a>6 .条件语句、循环语句、动态SQL</h3><h4 id="6-1-条件语句"><a href="#6-1-条件语句" class="headerlink" title="6.1 条件语句"></a>6.1 条件语句</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure proc_if()</span><br><span class="line">BEGIN</span><br><span class="line">	declare i int default 0;</span><br><span class="line">	if i=1 then</span><br><span class="line">		select 1;</span><br><span class="line">	elseif i=2 then</span><br><span class="line">		select 2;</span><br><span class="line">	else</span><br><span class="line">		select 7;</span><br><span class="line">	end if;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h4 id="6-2-循环语句"><a href="#6-2-循环语句" class="headerlink" title="6.2 循环语句"></a>6.2 循环语句</h4><h5 id="6-2-1-WHILE循环"><a href="#6-2-1-WHILE循环" class="headerlink" title="6.2.1 WHILE循环"></a>6.2.1 WHILE循环</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure proc_while()</span><br><span class="line">begin</span><br><span class="line">	declare num int;</span><br><span class="line">	set num=0;</span><br><span class="line">	while num &lt; 10 DO</span><br><span class="line">		select num;</span><br><span class="line">		set num=num+1;</span><br><span class="line">	end while;</span><br><span class="line">end //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h5 id="6-2-2-repeat循环"><a href="#6-2-2-repeat循环" class="headerlink" title="6.2.2 repeat循环"></a>6.2.2 repeat循环</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure proc_repeat()</span><br><span class="line">begin</span><br><span class="line">	declare i int;</span><br><span class="line">	set i=0;</span><br><span class="line">	repeat</span><br><span class="line">		select i;</span><br><span class="line">		set i=i+1;</span><br><span class="line">		until i&gt;=5</span><br><span class="line">	end repeat;</span><br><span class="line">end //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h5 id="6-2-3-loop循环"><a href="#6-2-3-loop循环" class="headerlink" title="6.2.3 loop循环"></a>6.2.3 loop循环</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">begin</span><br><span class="line">	declare i int default 0;</span><br><span class="line">	loop_label:loop</span><br><span class="line">		set i=i+1;</span><br><span class="line">		if i&lt;8 then</span><br><span class="line">			iterate loop_label;</span><br><span class="line">		end if;</span><br><span class="line">		select i;</span><br><span class="line">	end loop loop_label;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h5 id="6-3-动态执行SQL语句"><a href="#6-3-动态执行SQL语句" class="headerlink" title="6.3 动态执行SQL语句"></a>6.3 动态执行SQL语句</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">drop procedure if exists proc_sql //</span><br><span class="line">create procedure proc_sql()</span><br><span class="line">begin</span><br><span class="line">	declare p1 int;</span><br><span class="line">	set p1 = 11;</span><br><span class="line">	set @p1 = p1;</span><br><span class="line">	prepare prod from &apos;select * from c where id &gt; ?&apos;;</span><br><span class="line">	execute prod using @p1;</span><br><span class="line">	deallocate prepare prod;</span><br><span class="line">end //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/01/19/MySQL语法-Day57/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/19/MySQL语法-Day57/" itemprop="url">MySQL语法-Day57</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-19T16:45:02+08:00">
                2019-01-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  10
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MySQL语法-Day57"><a href="#MySQL语法-Day57" class="headerlink" title="MySQL语法-Day57"></a>MySQL语法-Day57</h2><h4 id="1-用户、权限操作"><a href="#1-用户、权限操作" class="headerlink" title="1. 用户、权限操作"></a>1. 用户、权限操作</h4><h5 id="1-1-用户操作"><a href="#1-1-用户操作" class="headerlink" title="1.1 用户操作"></a>1.1 用户操作</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- 创建用户(root账号登陆服务器)</span><br><span class="line">-- create user &apos;用户名&apos;@&apos;ip地址&apos; identified by &apos;密码&apos;      ip地址为 % 表示 所有地址--- 都可以登陆</span><br><span class="line">	use mysql</span><br><span class="line">	create user &apos;dbuser1&apos;@&apos;%&apos; identified by &apos;123456&apos;;</span><br><span class="line">-- 删除用户</span><br><span class="line">drop user &apos;用户名&apos;@&apos;IP地址&apos;;</span><br><span class="line">-- 修改用户</span><br><span class="line">rename user &apos;用户名&apos;@&apos;IP地址&apos; to &apos;新用户名&apos;@&apos;IP地址&apos;;</span><br><span class="line">-- 修改密码</span><br><span class="line">set password for &apos;用户名&apos;@&apos;IP地址&apos; = Password(&apos;新密码&apos;)</span><br><span class="line">-- ps:用户权限相关数据保存在mysql数据库的user表中，也可以直接对其进行操作（不建议）</span><br></pre></td></tr></table></figure>
<h5 id="1-2-权限操作"><a href="#1-2-权限操作" class="headerlink" title="1.2 权限操作"></a>1.2 权限操作</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- 查看权限</span><br><span class="line">show grants for &apos;用户&apos;@&apos;IP地址&apos;;</span><br><span class="line">-- 设置权限</span><br><span class="line">grant 权限 on 数据库.表 to &apos;用户&apos;@&apos;IP地址&apos;;</span><br><span class="line">-- grant select,insert,update,delete on 数据库.表 to 用户名@ip地址    </span><br><span class="line">	grant select,insert,update on db1.* to &apos;dbuser1&apos;@&apos;%&apos;;</span><br><span class="line">	-- 上句表示在dbl数据库的所有表中分配select,insert,update的权限给用户dbuser1</span><br><span class="line">	grant all privileges on *.* to &apos;zdj&apos;@&apos;%&apos;;  </span><br><span class="line">	-- 上句表示在所有数据库中分配所有权限给用户zdj</span><br><span class="line">-- 取消权限</span><br><span class="line">remove 权限 on 数据库.表 from &apos;用户&apos;@&apos;IP地址&apos;;</span><br></pre></td></tr></table></figure>
<h6 id="1-2-1-权限说明"><a href="#1-2-1-权限说明" class="headerlink" title="1.2.1 权限说明"></a>1.2.1 权限说明</h6><blockquote>
<pre><code>all privileges             除grant外的所有权限
select          仅查权限
select,insert   查和插入权限
usage                   无访问权限
alter                   使用alter table
alter routine           使用alter procedure和drop procedure
create                  使用create table
create routine          使用create procedure
create temporary tables 使用create temporary tables
create user             使用create user、drop user、rename user和revoke  all privileges
create view             使用create view
delete                  使用delete
drop                    使用drop table
execute                 使用call和存储过程
file                    使用select into outfile 和 load data infile
grant option            使用grant 和 revoke
index                   使用index
insert                  使用insert
lock tables             使用lock table
process                 使用show full processlist
select                  使用select
show databases          使用show databases
show view               使用show view
update                  使用update
reload                  使用flush
shutdown                使用mysqladmin shutdown(关闭MySQL)
super                   使用change master、kill、logs、purge、master和set global。还允许`mysqladmin`调试登陆
replication client      服务器位置的访问
replication slave       由复制从属使用
</code></pre></blockquote>
<h6 id="1-2-2-目标数据库说明"><a href="#1-2-2-目标数据库说明" class="headerlink" title="1.2.2 目标数据库说明"></a>1.2.2 目标数据库说明</h6><blockquote>
<pre><code>数据库名.*           数据库中的所有
  数据库名.表          指定数据库中的某张表
  数据库名.存储过程     指定数据库中的存储过程
  `*.* `               所有数据库
  用户名@IP地址         用户只能在改IP下才能访问
  用户名@192.168.1.%   用户只能在改IP段下才能访问(通配符%表示任意)
  用户名@%             用户可以再任意IP下访问(默认IP地址为%)
</code></pre></blockquote>
<h4 id="2-数据库操作"><a href="#2-数据库操作" class="headerlink" title="2. 数据库操作"></a>2. 数据库操作</h4><h5 id="2-1-显示数据库"><a href="#2-1-显示数据库" class="headerlink" title="2.1 显示数据库"></a>2.1 显示数据库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></figure>
<h5 id="2-2-创建数据库"><a href="#2-2-创建数据库" class="headerlink" title="2.2 创建数据库"></a>2.2 创建数据库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- create database 数据库名 default charset utf8;</span><br><span class="line">create database db3 default charset utf8;</span><br><span class="line">	-- 以上语句表示创建一个叫db3的数据库，编码方式为 utf8,支持中文</span><br></pre></td></tr></table></figure>
<h5 id="2-3-使用数据库"><a href="#2-3-使用数据库" class="headerlink" title="2.3 使用数据库"></a>2.3 使用数据库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use db3;</span><br><span class="line">	-- 以上语句表示 选择数据库db3</span><br></pre></td></tr></table></figure>
<h5 id="2-4-删除数据库"><a href="#2-4-删除数据库" class="headerlink" title="2.4 删除数据库"></a>2.4 删除数据库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drop database db3;</span><br><span class="line">	-- 以上语句表示 删除数据库db3</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="3-数据表操作"><a href="#3-数据表操作" class="headerlink" title="3.数据表操作"></a>3.数据表操作</h4><h5 id="3-1-创建表"><a href="#3-1-创建表" class="headerlink" title="3.1  创建表"></a>3.1  创建表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">-- 查看表</span><br><span class="line">show tables;</span><br><span class="line">-- 创建表</span><br><span class="line">-- create table 表名（数据列 类型|null|not null|auto_increment primary key) engine=innodb default charset=utf8;</span><br><span class="line">create table t1(id int not null auto_increment primary key,</span><br><span class="line">name varchar(25),</span><br><span class="line">age int</span><br><span class="line">)engine=innodb default charset=utf8;</span><br><span class="line"></span><br><span class="line">-- 设置是否为空</span><br><span class="line">-- 是否可空，null表示空，非字符串</span><br><span class="line">          --  not null    - 不可空</span><br><span class="line">          --  null        - 可空</span><br><span class="line">-- 设置默认值</span><br><span class="line">-- 默认值，创建列时可以指定默认值，当插入数据时如果未主动设置，则自动添加默认值</span><br><span class="line">            create table tb1(</span><br><span class="line">                nid int not null defalut 2,</span><br><span class="line">                num int not null</span><br><span class="line">            )</span><br><span class="line">-- 设置自增</span><br><span class="line">-- 自增，如果为某列设置自增列，插入数据时无需设置此列，默认将自增（表中只能有一个自增列）</span><br><span class="line">            create table tb1(</span><br><span class="line">                nid int not null auto_increment primary key,</span><br><span class="line">                num int null</span><br><span class="line">            )</span><br><span class="line">           -- 或</span><br><span class="line">            create table tb1(</span><br><span class="line">                nid int not null auto_increment,</span><br><span class="line">                num int null,</span><br><span class="line">                index(nid)</span><br><span class="line">            )</span><br><span class="line">           -- 注意：1、对于自增列，必须是索引（含主键）。</span><br><span class="line">              --   2、对于自增可以设置步长和起始值</span><br><span class="line">                     show session variables like &apos;auto_inc%&apos;;</span><br><span class="line">                     set session auto_increment_increment=2;</span><br><span class="line">                     set session auto_increment_offset=10;</span><br><span class="line"></span><br><span class="line">                     shwo global  variables like &apos;auto_inc%&apos;;</span><br><span class="line">                     set global auto_increment_increment=2;</span><br><span class="line">                     set global auto_increment_offset=10;</span><br><span class="line">-- 设置主键</span><br><span class="line">-- 主键，一种特殊的唯一索引，不允许有空值，如果主键使用单个列，则它的值必须唯一，如果是多列，则其组合必须唯一。</span><br><span class="line">            create table tb1(</span><br><span class="line">                nid int not null auto_increment primary key,</span><br><span class="line">                num int null</span><br><span class="line">            )</span><br><span class="line">         --   或</span><br><span class="line">            create table tb1(</span><br><span class="line">                nid int not null,</span><br><span class="line">                num int not null,</span><br><span class="line">                primary key(nid,num)</span><br><span class="line">            )</span><br><span class="line">-- 设置外键</span><br><span class="line">-- 外键，一个特殊的索引，只能是指定内容</span><br><span class="line">            creat table color(</span><br><span class="line">                nid int not null primary key,</span><br><span class="line">                name char(16) not null</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            create table fruit(</span><br><span class="line">                nid int not null primary key,</span><br><span class="line">                smt char(32) null ,</span><br><span class="line">                color_id int not null,</span><br><span class="line">                constraint fk_cc foreign key (color_id) references color(nid)</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>
<h5 id="3-2-查看表的结构"><a href="#3-2-查看表的结构" class="headerlink" title="3.2 查看表的结构"></a>3.2 查看表的结构</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- describe可以简写成desc</span><br><span class="line">describe t1;</span><br></pre></td></tr></table></figure>
<h5 id="3-3-修改表"><a href="#3-3-修改表" class="headerlink" title="3.3 修改表"></a>3.3 修改表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- 添加列：</span><br><span class="line">alter table 表名 add 列名 类型</span><br><span class="line">-- 删除列：</span><br><span class="line">alter table 表名 drop column 列名</span><br><span class="line">-- 修改列：</span><br><span class="line">alter table 表名 modify column 列名 类型;  -- 类型</span><br><span class="line">alter table 表名 change 原列名 新列名 类型; -- 列名，类型</span><br><span class="line">  </span><br><span class="line">-- 添加主键：</span><br><span class="line">alter table 表名 add primary key(列名);</span><br><span class="line">-- 删除主键：</span><br><span class="line">alter table 表名 drop primary key;</span><br><span class="line">alter table 表名  modify  列名 int, drop primary key;</span><br><span class="line">-- 添加外键：</span><br><span class="line">alter table 从表 add constraint 外键名称（形如：FK_从表_主表） foreign key 从表(外键字段) references 主表(主键字段);</span><br><span class="line">-- 删除外键：</span><br><span class="line">alter table 表名 drop foreign key 外键名称</span><br><span class="line">-- 修改默认值：</span><br><span class="line">ALTER TABLE testalter_tbl ALTER i SET DEFAULT 1000;</span><br><span class="line">-- 删除默认值：</span><br><span class="line">ALTER TABLE testalter_tbl ALTER i DROP DEFAULT;</span><br></pre></td></tr></table></figure>
<h5 id="3-4-清空表"><a href="#3-4-清空表" class="headerlink" title="3.4 清空表"></a>3.4 清空表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 第一种方法,下次插入数据后自增列会从上次继续编号</span><br><span class="line">delete from t1;</span><br><span class="line">-- 第二种方法，下次插入数据后自增列从1开始编号</span><br><span class="line">truncate table t1;</span><br></pre></td></tr></table></figure>
<h5 id="3-5-删除表"><a href="#3-5-删除表" class="headerlink" title="3.5 删除表"></a>3.5 删除表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 删除表</span><br><span class="line">drop table t1;</span><br></pre></td></tr></table></figure>
<h5 id="3-6-表的数据操作"><a href="#3-6-表的数据操作" class="headerlink" title="3.6 表的数据操作"></a>3.6 表的数据操作</h5><h5 id="3-6-1-数据类型"><a href="#3-6-1-数据类型" class="headerlink" title="3.6.1 数据类型"></a>3.6.1 数据类型</h5><p>MySQL的数据类型大致分为：数值、时间和字符串<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">bit[(M)]</span><br><span class="line">          二进制位（101001），m表示二进制位的长度（1-64），默认m＝1</span><br><span class="line">      tinyint[(m)] [unsigned] [zerofill]</span><br><span class="line">          小整数，数据类型用于保存一些范围的整数数值范围：</span><br><span class="line">          有符号：</span><br><span class="line">              -128 ～ 127.</span><br><span class="line">          无符号：～ 255</span><br><span class="line">          特别的： MySQL中无布尔值，使用tinyint(1)构造。</span><br><span class="line">      int[(m)][unsigned][zerofill]</span><br><span class="line">          整数，数据类型用于保存一些范围的整数数值范围：</span><br><span class="line">              有符号：</span><br><span class="line">                  -2147483648 ～ 2147483647</span><br><span class="line">              无符号：～ 4294967295</span><br><span class="line">          特别的：整数类型中的m仅用于显示，对存储范围无限制。例如： int(5),当插入数据2时，select 时数据显示为： 00002</span><br><span class="line">      bigint[(m)][unsigned][zerofill]</span><br><span class="line">          大整数，数据类型用于保存一些范围的整数数值范围：</span><br><span class="line">              有符号：</span><br><span class="line">                  -9223372036854775808 ～ 9223372036854775807</span><br><span class="line">              无符号：～  18446744073709551615</span><br><span class="line">      decimal[(m[,d])] [unsigned] [zerofill]</span><br><span class="line">          准确的小数值，m是数字总个数（负号不算），d是小数点后个数。 m最大值为65，d最大值为30。</span><br><span class="line">          特别的：对于精确数值计算时需要用此类型</span><br><span class="line">                 decaimal能够存储精确值的原因在于其内部按照字符串存储。</span><br><span class="line">      FLOAT[(M,D)] [UNSIGNED] [ZEROFILL]</span><br><span class="line">          单精度浮点数（非准确小数值），m是数字总个数，d是小数点后个数。</span><br><span class="line">              无符号：</span><br><span class="line">                  -3.402823466E+38 to -1.175494351E-38,</span><br><span class="line">                  1.175494351E-38 to 3.402823466E+38</span><br><span class="line">              有符号：</span><br><span class="line">                  1.175494351E-38 to 3.402823466E+38</span><br><span class="line">          **** 数值越大，越不准确 ****</span><br><span class="line">      DOUBLE[(M,D)] [UNSIGNED] [ZEROFILL]</span><br><span class="line">          双精度浮点数（非准确小数值），m是数字总个数，d是小数点后个数。</span><br><span class="line">              无符号：</span><br><span class="line">                  -1.7976931348623157E+308 to -2.2250738585072014E-308</span><br><span class="line">                  2.2250738585072014E-308 to 1.7976931348623157E+308</span><br><span class="line">              有符号：</span><br><span class="line">                  2.2250738585072014E-308 to 1.7976931348623157E+308</span><br><span class="line">          **** 数值越大，越不准确 ****</span><br><span class="line">      char (m)</span><br><span class="line">          char数据类型用于表示固定长度的字符串，可以包含最多达255个字符。其中m代表字符串的长度。</span><br><span class="line">          PS: 即使数据小于m长度，也会占用m长度</span><br><span class="line">      varchar(m)</span><br><span class="line">          varchars数据类型用于变长的字符串，可以包含最多达255个字符。其中m代表该数据类型所允许保存的字符串的最大长度，只要长度小于该最大值的字符串都可以被保存在该数据类型中。</span><br><span class="line">          注：虽然varchar使用起来较为灵活，但是从整个系统的性能角度来说，char数据类型的处理速度更快，有时甚至可以超出varchar处理速度的50%。因此，用户在设计数据库时应当综合考虑各方面的因素，以求达到最佳的平衡</span><br><span class="line">      text</span><br><span class="line">          text数据类型用于保存变长的大字符串，可以组多到65535 (2**16 − 1)个字符。</span><br><span class="line">      mediumtext</span><br><span class="line">          A TEXT column with a maximum length of 16,777,215 (2**24 − 1) characters.</span><br><span class="line">      longtext</span><br><span class="line">          A TEXT column with a maximum length of 4,294,967,295 or 4GB (2**32 − 1) characters.</span><br><span class="line">      enum</span><br><span class="line">          枚举类型，</span><br><span class="line">          An ENUM column can have a maximum of 65,535 distinct elements. (The practical limit is less than 3000.)</span><br><span class="line">          示例：</span><br><span class="line">              CREATE TABLE shirts (</span><br><span class="line">                  name VARCHAR(40),</span><br><span class="line">                  size ENUM(&apos;x-small&apos;, &apos;small&apos;, &apos;medium&apos;, &apos;large&apos;, &apos;x-large&apos;)</span><br><span class="line">              );</span><br><span class="line">              INSERT INTO shirts (name, size) VALUES (&apos;dress shirt&apos;,&apos;large&apos;), (&apos;t-shirt&apos;,&apos;medium&apos;),(&apos;polo shirt&apos;,&apos;small&apos;);</span><br><span class="line">      set</span><br><span class="line">          集合类型</span><br><span class="line">          A SET column can have a maximum of 64 distinct members.</span><br><span class="line">          示例：</span><br><span class="line">              CREATE TABLE myset (col SET(&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;));</span><br><span class="line">              INSERT INTO myset (col) VALUES (&apos;a,d&apos;), (&apos;d,a&apos;), (&apos;a,d,a&apos;), (&apos;a,d,d&apos;), (&apos;d,a,d&apos;);</span><br><span class="line">      DATE</span><br><span class="line">          YYYY-MM-DD（1000-01-01/9999-12-31）</span><br><span class="line">      TIME</span><br><span class="line">          HH:MM:SS（&apos;-838:59:59&apos;/&apos;838:59:59&apos;）</span><br><span class="line">      YEAR</span><br><span class="line">          YYYY（1901/2155）</span><br><span class="line">      DATETIME</span><br><span class="line">          YYYY-MM-DD HH:MM:SS（1000-01-01 00:00:00/9999-12-31 23:59:59    Y）</span><br><span class="line">      TIMESTAMP</span><br><span class="line">          YYYYMMDD HHMMSS（1970-01-01 00:00:00/2037 年某时）</span><br></pre></td></tr></table></figure></p>
<h5 id="3-6-2-插入数据"><a href="#3-6-2-插入数据" class="headerlink" title="3.6.2 插入数据"></a>3.6.2 插入数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insert into t1(name,age) values(&apos;wx&apos;,28);</span><br><span class="line">insert into t1(name,age) values(&apos;df&apos;,48);</span><br><span class="line">insert into t1(name,age) values(&apos;er&apos;,22);</span><br><span class="line">insert into t1(name,age) values(&apos;刘德华&apos;,58);</span><br></pre></td></tr></table></figure>
<h5 id="3-6-3-查询数据"><a href="#3-6-3-查询数据" class="headerlink" title="3.6.3 查询数据"></a>3.6.3 查询数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t1;</span><br></pre></td></tr></table></figure>
<h5 id="3-6-4-修改数据"><a href="#3-6-4-修改数据" class="headerlink" title="3.6.4 修改数据"></a>3.6.4 修改数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update t1 set name=&apos;庞龙&apos; where id =1;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/01/14/IO多路复用-Day42/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/14/IO多路复用-Day42/" itemprop="url">IO多路复用-Day42</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-14T21:38:02+08:00">
                2019-01-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  145
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="IO多路复用-Day42"><a href="#IO多路复用-Day42" class="headerlink" title="IO多路复用-Day42"></a>IO多路复用-Day42</h2><h4 id="1-socket端代码"><a href="#1-socket端代码" class="headerlink" title="1. socket端代码"></a>1. socket端代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author : 渝周郎</span></span><br><span class="line"><span class="comment"># Time   : 2019/1/14 20:21</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>, <span class="number">4567</span>))</span><br><span class="line">sk.listen()</span><br><span class="line"></span><br><span class="line">sk_list = [sk]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">	r_list, w_list, x_list = select.select(sk_list, [], [])</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> r_list:</span><br><span class="line">		<span class="keyword">if</span> i <span class="keyword">is</span> sk:     <span class="comment"># 判断i是否为socket对象</span></span><br><span class="line">			conn, addr = i.accept()</span><br><span class="line">			sk_list.append(conn)</span><br><span class="line">		<span class="keyword">else</span>:   <span class="comment"># 当i为conn时</span></span><br><span class="line">			ret = i.recv(<span class="number">1024</span>)</span><br><span class="line">			<span class="keyword">if</span> ret == <span class="string">b''</span>:</span><br><span class="line">				i.close()</span><br><span class="line">				sk_list.remove(i)</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			print(ret)</span><br><span class="line">			i.send(<span class="string">b'hello'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2-client端代码"><a href="#2-client端代码" class="headerlink" title="2. client端代码"></a>2. client端代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author : 渝周郎</span></span><br><span class="line"><span class="comment"># Time   : 2019/1/14 20:21</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.connect((<span class="string">'127.0.0.1'</span>, <span class="number">4567</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">	sk.send(<span class="string">b'goodbye'</span>)</span><br><span class="line">	ret = sk.recv(<span class="number">1024</span>)</span><br><span class="line">	print(ret)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">	Thread(target=func).start()</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="运行结果如下"><a href="#运行结果如下" class="headerlink" title="运行结果如下:"></a>运行结果如下:</h4></blockquote>
<p><img src="/2019/01/14/IO多路复用-Day42/201901142144.gif" alt="IO多路复用-Day42"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/01/10/协程应用举例-Day42/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/10/协程应用举例-Day42/" itemprop="url">协程应用举例-Day42</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-10T21:55:02+08:00">
                2019-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  204
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="协程应用举例-Day42"><a href="#协程应用举例-Day42" class="headerlink" title="协程应用举例-Day42"></a>协程应用举例-Day42</h2><h4 id="1-爬虫"><a href="#1-爬虫" class="headerlink" title="1. 爬虫"></a>1. 爬虫</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author : 渝周郎</span></span><br><span class="line"><span class="comment"># Time   : 2019/1/10 21:55</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey;monkey.patch_all()</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_url</span><span class="params">(url)</span>:</span></span><br><span class="line">	response = urlopen(url)</span><br><span class="line">	context = response.read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">	<span class="keyword">return</span> url, len(context)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urls = [<span class="string">'http://www.baidu.com'</span>, </span><br><span class="line">		<span class="string">'http://www.sohu.com'</span>, </span><br><span class="line">		<span class="string">'http://www.cnblogs.com'</span>, </span><br><span class="line">		<span class="string">'http://www.360.cn'</span>, </span><br><span class="line">		<span class="string">'http://139139.cn'</span></span><br><span class="line">		]</span><br><span class="line">g_lst = []</span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">	g = gevent.spawn(get_url, url)</span><br><span class="line">	g_lst.append(g)</span><br><span class="line"><span class="keyword">for</span> gg <span class="keyword">in</span> g_lst:</span><br><span class="line">	gg.join()</span><br><span class="line">	print(gg.value)</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="运行结果如下"><a href="#运行结果如下" class="headerlink" title="运行结果如下:"></a>运行结果如下:</h4><p><img src="/2019/01/10/协程应用举例-Day42/201901102221.gif" alt="协程应用举例-Day42"></p>
</blockquote>
<h4 id="2-通过gevent实现单线程下的socket并发"><a href="#2-通过gevent实现单线程下的socket并发" class="headerlink" title="2. 通过gevent实现单线程下的socket并发"></a>2. 通过gevent实现单线程下的socket并发</h4><h5 id="2-1-server端代码"><a href="#2-1-server端代码" class="headerlink" title="2.1  server端代码"></a>2.1  server端代码</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey;monkey.patch_all()</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>, <span class="number">4567</span>))</span><br><span class="line">sk.listen()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_conn</span><span class="params">(conn)</span>:</span></span><br><span class="line">    conn.send(<span class="string">b'hello'</span>)</span><br><span class="line">    rev = conn.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    print(rev)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    conn, addr = sk.accept()</span><br><span class="line">    print(conn.getsockname())</span><br><span class="line">    gevent.spawn(get_conn,conn)</span><br><span class="line"></span><br><span class="line">sk.close()</span><br></pre></td></tr></table></figure>
<h5 id="2-2-client端代码"><a href="#2-2-client端代码" class="headerlink" title="2.2 client端代码"></a>2.2 client端代码</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.connect((<span class="string">'127.0.0.1'</span>, <span class="number">4567</span>))</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    rev = sk.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    print(rev)</span><br><span class="line">    msg = input(<span class="string">'&gt;&gt;&gt;'</span>).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">    sk.send(msg)</span><br><span class="line"></span><br><span class="line">sk.close()</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/01/10/协程之gevent模块-Day42/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/10/协程之gevent模块-Day42/" itemprop="url">协程之gevent模块-Day42</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-10T21:08:02+08:00">
                2019-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  478
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="协程之gevent模块-Day42"><a href="#协程之gevent模块-Day42" class="headerlink" title="协程之gevent模块-Day42"></a>协程之gevent模块-Day42</h2><h4 id="1-用法介绍"><a href="#1-用法介绍" class="headerlink" title="1. 用法介绍"></a>1. 用法介绍</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">g1=gevent.spawn(func,<span class="number">1</span>,,<span class="number">2</span>,<span class="number">3</span>,x=<span class="number">4</span>,y=<span class="number">5</span>)创建一个协程对象g1，spawn括号内第一个参数是函数名，如eat，后面可以有多个参数，可以是位置实参或关键字实参，都是传给函数eat的</span><br><span class="line"></span><br><span class="line">g2=gevent.spawn(func2)</span><br><span class="line"></span><br><span class="line">g1.join() <span class="comment">#等待g1结束</span></span><br><span class="line"></span><br><span class="line">g2.join() <span class="comment">#等待g2结束</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#或者上述两步合作一步：gevent.joinall([g1,g2])</span></span><br><span class="line"></span><br><span class="line">g1.value<span class="comment">#拿到func1的返回值</span></span><br></pre></td></tr></table></figure>
<h4 id="2-IO主动切换"><a href="#2-IO主动切换" class="headerlink" title="2. IO主动切换"></a>2. IO主动切换</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">'开始吃饭'</span>)</span><br><span class="line">	<span class="comment"># time.sleep(2)  # gevent模块无法感知time.sleep等IO操作，只能使用自身的sleep；除非在程序最顶端引用monkey.patch_all()</span></span><br><span class="line">	gevent.sleep(<span class="number">2</span>)</span><br><span class="line">	print(<span class="string">'结束吃饭'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">'开始玩耍'</span>)</span><br><span class="line">	<span class="comment"># time.sleep(2)</span></span><br><span class="line">	gevent.sleep(<span class="number">2</span>)</span><br><span class="line">	print(<span class="string">'结束玩耍'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = gevent.spawn(eat)</span><br><span class="line">g2 = gevent.spawn(play)</span><br><span class="line"></span><br><span class="line">g1.join()</span><br><span class="line">g2.join()</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="上例gevent-sleep-2-模拟的是gevent可以识别的io阻塞-而time-sleep-2-或其他的阻塞-gevent是不能直接识别的需要用下面一行代码-打补丁-就可以识别了"><a href="#上例gevent-sleep-2-模拟的是gevent可以识别的io阻塞-而time-sleep-2-或其他的阻塞-gevent是不能直接识别的需要用下面一行代码-打补丁-就可以识别了" class="headerlink" title="上例gevent.sleep(2)模拟的是gevent可以识别的io阻塞,而time.sleep(2)或其他的阻塞,gevent是不能直接识别的需要用下面一行代码,打补丁,就可以识别了"></a>上例gevent.sleep(2)模拟的是gevent可以识别的io阻塞,而time.sleep(2)或其他的阻塞,gevent是不能直接识别的需要用下面一行代码,打补丁,就可以识别了</h4><h4 id="from-gevent-import-monkey-monkey-patch-all-必须放到被打补丁者的前面，如time，socket模块之前"><a href="#from-gevent-import-monkey-monkey-patch-all-必须放到被打补丁者的前面，如time，socket模块之前" class="headerlink" title="from gevent import monkey;monkey.patch_all()必须放到被打补丁者的前面，如time，socket模块之前"></a><code>from gevent import monkey;monkey.patch_all()</code>必须放到被打补丁者的前面，如time，socket模块之前</h4><h4 id="或者我们干脆记忆成：要用gevent，需要将from-gevent-import-monkey-monkey-patch-all-放到文件的开头"><a href="#或者我们干脆记忆成：要用gevent，需要将from-gevent-import-monkey-monkey-patch-all-放到文件的开头" class="headerlink" title="或者我们干脆记忆成：要用gevent，需要将from gevent import monkey;monkey.patch_all()放到文件的开头"></a>或者我们干脆记忆成：要用gevent，需要将<code>from gevent import monkey;monkey.patch_all()</code>放到文件的开头</h4><h4 id="见下面的代码"><a href="#见下面的代码" class="headerlink" title="见下面的代码"></a>见下面的代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey;monkey.patch_all()</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">'开始吃饭'</span>)</span><br><span class="line">	time.sleep(<span class="number">2</span>)</span><br><span class="line">	print(<span class="string">'结束吃饭'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">'开始玩耍'</span>)</span><br><span class="line">	time.sleep(<span class="number">2</span>)</span><br><span class="line">	print(<span class="string">'结束玩耍'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = gevent.spawn(eat)</span><br><span class="line">g2 = gevent.spawn(play)</span><br><span class="line"></span><br><span class="line">g1.join()</span><br><span class="line">g2.join()</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="3-gevent的同步与异步"><a href="#3-gevent的同步与异步" class="headerlink" title="3. gevent的同步与异步"></a>3. gevent的同步与异步</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author : 渝周郎</span></span><br><span class="line"><span class="comment"># Time   : 2019/01/10 21:08</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey;monkey.patch_all()</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">()</span>:</span></span><br><span class="line">	time.sleep(<span class="number">1</span>)   <span class="comment"># IO操作</span></span><br><span class="line">	print(<span class="string">'%s :hello.'</span>% time.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sync_tb</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">'***同步运行任务开始***'</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">		task()</span><br><span class="line">	print(<span class="string">'***同步运行任务结束***'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">async_yb</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">'***异步运行任务开始***'</span>)</span><br><span class="line">	g_lst = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">		g = gevent.spawn(task)</span><br><span class="line">		g_lst.append(g)</span><br><span class="line">	gevent.joinall(g_lst)</span><br><span class="line">	print(<span class="string">'***异步运行任务结束***'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sync_tb()</span><br><span class="line">async_yb()</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="运行结果如下"><a href="#运行结果如下" class="headerlink" title="运行结果如下:"></a>运行结果如下:</h4></blockquote>
<p><img src="/2019/01/10/协程之gevent模块-Day42/201901102129.gif" alt="协程之gevent模块-Day42"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">渝周郎</p>
              <p class="site-description motion-element" itemprop="description">记录工作点滴,业余学习点滴</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">渝周郎</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
