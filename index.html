<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="记录工作点滴,业余学习点滴">
<meta property="og:type" content="website">
<meta property="og:title" content="渝周砺行路">
<meta property="og:url" content="http://www.139139.cn/index.html">
<meta property="og:site_name" content="渝周砺行路">
<meta property="og:description" content="记录工作点滴,业余学习点滴">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="渝周砺行路">
<meta name="twitter:description" content="记录工作点滴,业余学习点滴">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.139139.cn/"/>





  <title>渝周砺行路</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b9d76e46c0e10930a98dac8ef4006720";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">渝周砺行路</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">经验点滴</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/03/03/MySQL语法（视图、函数、触发器、存储过程、事务）-Day61/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/03/MySQL语法（视图、函数、触发器、存储过程、事务）-Day61/" itemprop="url">MySQL语法（视图、函数、触发器、存储过程、事务、条件语句、循环语句、动态SQL）-Day61</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-03T21:48:02+08:00">
                2019-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  13
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MySQL语法（视图、函数、触发器、存储过程、事务、条件语句、循环语句、动态SQL）-Day61"><a href="#MySQL语法（视图、函数、触发器、存储过程、事务、条件语句、循环语句、动态SQL）-Day61" class="headerlink" title="MySQL语法（视图、函数、触发器、存储过程、事务、条件语句、循环语句、动态SQL）-Day61"></a>MySQL语法（视图、函数、触发器、存储过程、事务、条件语句、循环语句、动态SQL）-Day61</h2><h3 id="1-视图"><a href="#1-视图" class="headerlink" title="1. 视图"></a>1. 视图</h3><h4 id="1-1-创建视图"><a href="#1-1-创建视图" class="headerlink" title="1.1 创建视图"></a>1.1 创建视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--格式：CREATE VIEW 视图名称 AS  SQL语句</span><br><span class="line">CREATE VIEW V1 AS</span><br><span class="line">SELECT cid,cname,teacher_id,tname FROM course</span><br><span class="line">LEFT JOIN teacher ON course.teacher_id=teacher.tid</span><br></pre></td></tr></table></figure>
<h4 id="1-2-删除视图"><a href="#1-2-删除视图" class="headerlink" title="1.2  删除视图"></a>1.2  删除视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--格式：DROP VIEW 视图名称</span><br><span class="line">DROP VIEW V1</span><br></pre></td></tr></table></figure>
<h4 id="1-3-修改视图"><a href="#1-3-修改视图" class="headerlink" title="1.3 修改视图"></a>1.3 修改视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 格式：ALTER VIEW 视图名称 AS SQL语句</span><br><span class="line">ALTER VIEW V1 AS</span><br><span class="line">SELECT cid,cname,tname FROM course</span><br><span class="line">LEFT JOIN teacher ON course.teacher_id=teacher.tid</span><br></pre></td></tr></table></figure>
<h4 id="1-4-使用视图"><a href="#1-4-使用视图" class="headerlink" title="1.4  使用视图"></a>1.4  使用视图</h4><blockquote>
<p>使用视图时，将其当作表进行操作即可，由于视图是虚拟表，所以无法使用其对真实表进行创建、更新和删除操作，仅能做查询用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM V1</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-触发器"><a href="#2-触发器" class="headerlink" title="2. 触发器"></a>2. 触发器</h3><blockquote>
<p>对某个表进行【增/删/改】操作的前后如果希望触发某个特定的行为时，可以使用触发器，触发器用于定制用户对表的行进行【增/删/改】前后的行为。</p>
</blockquote>
<h4 id="2-1-创建语法"><a href="#2-1-创建语法" class="headerlink" title="2.1 创建语法"></a>2.1 创建语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">-- delimiter // 更改mysql语句默认结束符号（默认为;）</span><br><span class="line">-- NEW 表示update、insert前的临时表</span><br><span class="line">-- OLD 表示delete前的临时表</span><br><span class="line">-- NEW表示即将插入的数据行，OLD表示即将删除的数据行。</span><br><span class="line">-- 插入前</span><br><span class="line">delimiter //  </span><br><span class="line">CREATE TRIGGER TRI_BEFORE_INSERT_a1 BEFORE INSERT ON a FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">insert into b(num) VALUES (NEW.num);</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 插入后</span><br><span class="line">delimiter //</span><br><span class="line">CREATE TRIGGER TRI_AFTER_INSERT_a2 AFTER INSERT ON a FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">INSERT INTO b(num) VALUES(NEW.num+5);</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 删除前</span><br><span class="line">delimiter //</span><br><span class="line">CREATE TRIGGER TRI_BEFORE_DELETE_a3 BEFORE DELETE ON a FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">delete from b where num = OLD.num;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 删除后</span><br><span class="line">delimiter //</span><br><span class="line">CREATE TRIGGER TRI_AFTER_DELETE_a4 AFTER DELETE ON a FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">delete from b where num = OLD.num+5;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 更新前</span><br><span class="line">delimiter //</span><br><span class="line">CREATE TRIGGER TRI_BEFORE_UPDATE_a5 BEFORE UPDATE ON a FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">UPDATE b set num = NEW.num WHERE b.num = OLD.num; -- a表变动b表相同的数字跟着变动</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 更新后</span><br><span class="line">delimiter //</span><br><span class="line">CREATE TRIGGER TRI_AFTER_UPDATE_a6 AFTER UPDATE ON a FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">UPDATE b set num = NEW.num WHERE b.num = OLD.num; -- a表变动b表相同的数字跟着变动</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-删除触发器"><a href="#2-2-删除触发器" class="headerlink" title="2.2 删除触发器"></a>2.2 删除触发器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TRIGGER 触发器名称;</span><br></pre></td></tr></table></figure>
<h3 id="3-存储过程"><a href="#3-存储过程" class="headerlink" title="3.存储过程"></a>3.存储过程</h3><blockquote>
<p>存储过程是一个SQL语句集合，当主动去调用存储过程时，其中内部的SQL语句会按照逻辑执行。</p>
</blockquote>
<h4 id="3-1-创建存储过程"><a href="#3-1-创建存储过程" class="headerlink" title="3.1 创建存储过程"></a>3.1 创建存储过程</h4><h5 id="3-1-1-无参数过程"><a href="#3-1-1-无参数过程" class="headerlink" title="3.1.1  无参数过程"></a>3.1.1  无参数过程</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P1()</span><br><span class="line">BEGIN</span><br><span class="line">SELECT * FROM SCORE;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 执行存储过程</span><br><span class="line">call P1()</span><br></pre></td></tr></table></figure>
<h5 id="3-1-2-有参数过程"><a href="#3-1-2-有参数过程" class="headerlink" title="3.1.2 有参数过程"></a>3.1.2 有参数过程</h5><blockquote>
<p>对于存储过程，可以接收参数，其参数有三类：</p>
<ul>
<li>in        仅用于传入参数作用</li>
<li>out        仅用于返回值用</li>
<li>inout    既可以传入又可以当作返回值</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- 创建存储过程</span><br><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P2(</span><br><span class="line">in i1 int,</span><br><span class="line">in i2 int,</span><br><span class="line">inout i3 int,</span><br><span class="line">out r1 int</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE tmp1 int;</span><br><span class="line">DECLARE tmp2 int default 0;</span><br><span class="line">set tmp1 = 1;</span><br><span class="line">set r1 = i1+i2+tmp1+tmp2;</span><br><span class="line">set i3 = i3+100;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line">-- 执行存储过程</span><br><span class="line">set @t1 = 100;</span><br><span class="line">set @t2 = 0;</span><br><span class="line">call p2(3,4,@t1,@t2);</span><br><span class="line">select @t1,@t2;</span><br></pre></td></tr></table></figure>
<h6 id="3-1-2-1-带结果集的存储过程"><a href="#3-1-2-1-带结果集的存储过程" class="headerlink" title="3.1.2.1 带结果集的存储过程"></a>3.1.2.1 带结果集的存储过程</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P3()</span><br><span class="line">BEGIN</span><br><span class="line">SELECT * FROM SCORE;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h6 id="3-1-2-2-结果集-OUT值"><a href="#3-1-2-2-结果集-OUT值" class="headerlink" title="3.1.2.2 结果集+OUT值"></a>3.1.2.2 结果集+OUT值</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P4(</span><br><span class="line">in n1 int,</span><br><span class="line">inout n3 int,</span><br><span class="line">out n2 int</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE tmp1 int;</span><br><span class="line">DECLARE tmp2 int default 0;</span><br><span class="line">SELECT * FROM SCORE;</span><br><span class="line">SET n2 = n1 + 100;</span><br><span class="line">SET n3 = n3 + n1 +100;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h6 id="3-1-2-3-带事务的存储过程"><a href="#3-1-2-3-带事务的存储过程" class="headerlink" title="3.1.2.3 带事务的存储过程"></a>3.1.2.3 带事务的存储过程</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P5(</span><br><span class="line">OUT return_code tinyint</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE exit handler for sqlexception</span><br><span class="line">	BEGIN</span><br><span class="line">		-- ERROR</span><br><span class="line">		SET return_code = 1;</span><br><span class="line">		rollback;</span><br><span class="line">	END;</span><br><span class="line">DECLARE exit handler for sqlwarning</span><br><span class="line">	BEGIN</span><br><span class="line">	-- WARNING</span><br><span class="line">	SET return_code = 2;</span><br><span class="line">	rollback;</span><br><span class="line">	END;</span><br><span class="line">START TRANSACTION;</span><br><span class="line">DELETE FROM b;</span><br><span class="line">insert into a(num) values(99);</span><br><span class="line">COMMIT;</span><br><span class="line">--SUCCESS</span><br><span class="line">SET return_code = 0;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h6 id="3-1-2-4-带游标的存储过程"><a href="#3-1-2-4-带游标的存储过程" class="headerlink" title="3.1.2.4 带游标的存储过程"></a>3.1.2.4 带游标的存储过程</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P6()</span><br><span class="line">BEGIN</span><br><span class="line">declare ssid int;</span><br><span class="line">declare ssname varchar(50);</span><br><span class="line">declare done int default FALSE;</span><br><span class="line">declare my_cursor CURSOR FOR SELECT sid,sname from student;</span><br><span class="line">declare continue handler for NOT FOUND SET done = TRUE;</span><br><span class="line">open my_cursor;</span><br><span class="line">	eg:LOOP</span><br><span class="line">		fetch my_cursor into ssid,ssname;</span><br><span class="line">		if done then</span><br><span class="line">			leave eg;</span><br><span class="line">		end if;</span><br><span class="line">		insert into teacher(tname) values(ssname);</span><br><span class="line">	END loop eg;</span><br><span class="line">CLOSE my_cursor;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h6 id="3-1-2-5-动态执行SQL"><a href="#3-1-2-5-动态执行SQL" class="headerlink" title="3.1.2.5 动态执行SQL"></a>3.1.2.5 动态执行SQL</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P7(</span><br><span class="line">in nid int</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">set @nnid = nid;</span><br><span class="line">-- PREPARE 把...准备好</span><br><span class="line">PREPARE prod FROM &apos;SELECT * FROM student where sid &gt; ?&apos;;</span><br><span class="line">EXECUTE prod USING @nnid;</span><br><span class="line">DEALLOCATE PREPARE prod;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-删除存储过程"><a href="#3-2-删除存储过程" class="headerlink" title="3.2 删除存储过程"></a>3.2 删除存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop procedure proc_name;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-执行存储过程"><a href="#3-3-执行存储过程" class="headerlink" title="3.3 执行存储过程"></a>3.3 执行存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- 无参数</span><br><span class="line">CALL Proc_name()</span><br><span class="line">-- 有参数，全in</span><br><span class="line">CALL proc_name(参数1，参数2,...)</span><br><span class="line">-- 有参数，有in,out,inout</span><br><span class="line">set @t1 = 0;</span><br><span class="line">set @t2 = 5;</span><br><span class="line">CALL proc_name(1,2,@t1,@t2)</span><br><span class="line">SELECT @t1,@t2</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pymysql执行存储过程</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">conn = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'******'</span>, database=<span class="string">'db1'</span> )</span><br><span class="line">cur = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class="line">cur.callproc(<span class="string">'p7'</span>, args=(<span class="number">1</span>,))</span><br><span class="line">ret = cur.fecthall()</span><br><span class="line">print(ret)</span><br><span class="line">cur.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<h3 id="3-函数"><a href="#3-函数" class="headerlink" title="3.函数"></a>3.函数</h3><h4 id="3-1-内置函数"><a href="#3-1-内置函数" class="headerlink" title="3.1 内置函数"></a>3.1 内置函数</h4><blockquote>
<p>MySQL中提供了许多内置函数，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">CHAR_LENGTH(str)</span><br><span class="line">       返回值为字符串str 的长度，长度的单位为字符。一个多字节字符算作一个单字符。</span><br><span class="line">       对于一个包含五个二字节字符集, LENGTH()返回值为 10, 而CHAR_LENGTH()的返回值为5。</span><br><span class="line"></span><br><span class="line">   CONCAT(str1,str2,...)</span><br><span class="line">       字符串拼接</span><br><span class="line">       如有任何一个参数为NULL ，则返回值为 NULL。</span><br><span class="line">   CONCAT_WS(separator,str1,str2,...)</span><br><span class="line">       字符串拼接（自定义连接符）</span><br><span class="line">       CONCAT_WS()不会忽略任何空字符串。 (然而会忽略所有的 NULL）。</span><br><span class="line"></span><br><span class="line">   CONV(N,from_base,to_base)</span><br><span class="line">       进制转换</span><br><span class="line">       例如：</span><br><span class="line">           SELECT CONV(&apos;a&apos;,16,2); 表示将 a 由16进制转换为2进制字符串表示</span><br><span class="line"></span><br><span class="line">   FORMAT(X,D)</span><br><span class="line">       将数字X 的格式写为&apos;#,###,###.##&apos;,以四舍五入的方式保留小数点后 D 位， 并将结果以字符串的形式返回。若  D 为 0, 则返回结果不带有小数点，或不含小数部分。</span><br><span class="line">       例如：</span><br><span class="line">           SELECT FORMAT(12332.1,4); 结果为： &apos;12,332.1000&apos;</span><br><span class="line">   INSERT(str,pos,len,newstr)</span><br><span class="line">       在str的指定位置插入字符串</span><br><span class="line">           pos：要替换位置其实位置</span><br><span class="line">           len：替换的长度</span><br><span class="line">           newstr：新字符串</span><br><span class="line">       特别的：</span><br><span class="line">           如果pos超过原字符串长度，则返回原字符串</span><br><span class="line">           如果len超过原字符串长度，则由新字符串完全替换</span><br><span class="line">   INSTR(str,substr)</span><br><span class="line">       返回字符串 str 中子字符串的第一个出现位置。</span><br><span class="line"></span><br><span class="line">   LEFT(str,len)</span><br><span class="line">       返回字符串str 从开始的len位置的子序列字符。</span><br><span class="line"></span><br><span class="line">   LOWER(str)</span><br><span class="line">       变小写</span><br><span class="line"></span><br><span class="line">   UPPER(str)</span><br><span class="line">       变大写</span><br><span class="line"></span><br><span class="line">   LTRIM(str)</span><br><span class="line">       返回字符串 str ，其引导空格字符被删除。</span><br><span class="line">   RTRIM(str)</span><br><span class="line">       返回字符串 str ，结尾空格字符被删去。</span><br><span class="line">   SUBSTRING(str,pos,len)</span><br><span class="line">       获取字符串子序列</span><br><span class="line"></span><br><span class="line">   LOCATE(substr,str,pos)</span><br><span class="line">       获取子序列索引位置</span><br><span class="line"></span><br><span class="line">   REPEAT(str,count)</span><br><span class="line">       返回一个由重复的字符串str 组成的字符串，字符串str的数目等于count 。</span><br><span class="line">       若 count &lt;= 0,则返回一个空字符串。</span><br><span class="line">       若str 或 count 为 NULL，则返回 NULL 。</span><br><span class="line">   REPLACE(str,from_str,to_str)</span><br><span class="line">       返回字符串str 以及所有被字符串to_str替代的字符串from_str 。</span><br><span class="line">   REVERSE(str)</span><br><span class="line">       返回字符串 str ，顺序和字符顺序相反。</span><br><span class="line">   RIGHT(str,len)</span><br><span class="line">       从字符串str 开始，返回从后边开始len个字符组成的子序列</span><br><span class="line"></span><br><span class="line">   SPACE(N)</span><br><span class="line">       返回一个由N空格组成的字符串。</span><br><span class="line"></span><br><span class="line">   SUBSTRING(str,pos) , SUBSTRING(str FROM pos) SUBSTRING(str,pos,len) , SUBSTRING(str FROM pos FOR len)</span><br><span class="line">       不带有len 参数的格式从字符串str返回一个子字符串，起始于位置 pos。带有len参数的格式从字符串str返回一个长度同len字符相同的子字符串，起始于位置 pos。 使用 FROM的格式为标准 SQL 语法。也可能对pos使用一个负值。假若这样，则子字符串的位置起始于字符串结尾的pos 字符，而不是字符串的开头位置。在以下格式的函数中可以对pos 使用一个负值。</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT SUBSTRING(&apos;Quadratically&apos;,5);</span><br><span class="line">           -&gt; &apos;ratically&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT SUBSTRING(&apos;foobarbar&apos; FROM 4);</span><br><span class="line">           -&gt; &apos;barbar&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT SUBSTRING(&apos;Quadratically&apos;,5,6);</span><br><span class="line">           -&gt; &apos;ratica&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT SUBSTRING(&apos;Sakila&apos;, -3);</span><br><span class="line">           -&gt; &apos;ila&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT SUBSTRING(&apos;Sakila&apos;, -5, 3);</span><br><span class="line">           -&gt; &apos;aki&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT SUBSTRING(&apos;Sakila&apos; FROM -4 FOR 2);</span><br><span class="line">           -&gt; &apos;ki&apos;</span><br><span class="line"></span><br><span class="line">   TRIM([&#123;BOTH | LEADING | TRAILING&#125; [remstr] FROM] str) TRIM(remstr FROM] str)</span><br><span class="line">       返回字符串 str ， 其中所有remstr 前缀和/或后缀都已被删除。若分类符BOTH、LEADIN或TRAILING中没有一个是给定的,则假设为BOTH 。 remstr 为可选项，在未指定情况下，可删除空格。</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT TRIM(&apos;  bar   &apos;);</span><br><span class="line">               -&gt; &apos;bar&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT TRIM(LEADING &apos;x&apos; FROM &apos;xxxbarxxx&apos;);</span><br><span class="line">               -&gt; &apos;barxxx&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT TRIM(BOTH &apos;x&apos; FROM &apos;xxxbarxxx&apos;);</span><br><span class="line">               -&gt; &apos;bar&apos;</span><br><span class="line"></span><br><span class="line">       mysql&gt; SELECT TRIM(TRAILING &apos;xyz&apos; FROM &apos;barxxyz&apos;);</span><br><span class="line">               -&gt; &apos;barx&apos;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>更多函数 —-&gt;<br><a href="http://www.runoob.com/mysql/mysql-functions.html" target="_blank" rel="noopener">中文点击这里</a><br><a href="https://dev.mysql.com/doc/refman/5.7/en/functions.html" target="_blank" rel="noopener">官方点击这里</a></p>
<h4 id="3-2-自定义函数"><a href="#3-2-自定义函数" class="headerlink" title="3.2 自定义函数"></a>3.2 自定义函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE FUNCTION F1(</span><br><span class="line">i1 int,</span><br><span class="line">i2 int</span><br><span class="line">)</span><br><span class="line">returns int</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE num int;</span><br><span class="line">	set num = i1 + i2;</span><br><span class="line">	return(num);</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-删除函数"><a href="#3-3-删除函数" class="headerlink" title="3.3 删除函数"></a>3.3 删除函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop function func_name;</span><br></pre></td></tr></table></figure>
<h4 id="3-4-执行函数"><a href="#3-4-执行函数" class="headerlink" title="3.4 执行函数"></a>3.4 执行函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 获取返回值</span><br><span class="line">DECLARE @i varchar(32);</span><br><span class="line">SELECT UPPER(&apos;alex&apos;) into @i;</span><br><span class="line">SELECT @i;</span><br><span class="line">-- 在查询中使用</span><br><span class="line">SELECT F1(100，200),name FROM tb2;</span><br></pre></td></tr></table></figure>
<h3 id="4-事务"><a href="#4-事务" class="headerlink" title="4 .事务"></a>4 .事务</h3><h4 id="4-1-支持事务的存储过程"><a href="#4-1-支持事务的存储过程" class="headerlink" title="4.1 支持事务的存储过程"></a>4.1 支持事务的存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">CREATE PROCEDURE P5(</span><br><span class="line">OUT return_code tinyint</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE exit handler for sqlexception</span><br><span class="line">	BEGIN</span><br><span class="line">		-- ERROR</span><br><span class="line">		SET return_code = 1;</span><br><span class="line">		rollback;</span><br><span class="line">	END;</span><br><span class="line">DECLARE exit handler for sqlwarning</span><br><span class="line">	BEGIN</span><br><span class="line">	-- WARNING</span><br><span class="line">	SET return_code = 2;</span><br><span class="line">	rollback;</span><br><span class="line">	END;</span><br><span class="line">START TRANSACTION;</span><br><span class="line">DELETE FROM b;</span><br><span class="line">insert into a(num) values(99);</span><br><span class="line">COMMIT;</span><br><span class="line">--SUCCESS</span><br><span class="line">SET return_code = 0;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line">-- 执行存储过程</span><br><span class="line">DECLARE @n int;</span><br><span class="line">set @n = 5;</span><br><span class="line">call p5(@n);</span><br><span class="line">select @n;</span><br></pre></td></tr></table></figure>
<h3 id="5-索引"><a href="#5-索引" class="headerlink" title="5 .索引"></a>5 .索引</h3><blockquote>
<p>索引，是数据库中专门用于帮助用户快速查询数据的一种数据结构。类似于字典中的目录，查找字典内容时可以根据目录查找到数据的存放位置，然后直接获取即可。<br>MySQL中常见索引有：</p>
<ul>
<li>普通索引</li>
<li>唯一索引</li>
<li>主键索引</li>
<li>组合索引</li>
</ul>
</blockquote>
<h4 id="5-1-普通索引"><a href="#5-1-普通索引" class="headerlink" title="5.1 普通索引"></a>5.1 普通索引</h4><blockquote>
<p>普通索引仅有一个功能：加速查询</p>
</blockquote>
<h5 id="5-1-1-创建表时建立普通索引"><a href="#5-1-1-创建表时建立普通索引" class="headerlink" title="5.1.1 创建表时建立普通索引"></a>5.1.1 创建表时建立普通索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table in1(</span><br><span class="line">    nid int not null auto_increment primary key,</span><br><span class="line">    name varchar(32) not null,</span><br><span class="line">    email varchar(64) not null,</span><br><span class="line">    extra text,</span><br><span class="line">    index ix_name (name)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="5-1-2-创建普通索引"><a href="#5-1-2-创建普通索引" class="headerlink" title="5.1.2 创建普通索引"></a>5.1.2 创建普通索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create index 索引名称 on 表名（列名）</span><br><span class="line">-- 注意：对于创建索引时如果是BLOB 和 TEXT 类型，必须指定length。</span><br><span class="line">create index ix_extra on in1(extra(32));</span><br></pre></td></tr></table></figure>
<h5 id="5-1-3-删除普通索引"><a href="#5-1-3-删除普通索引" class="headerlink" title="5.1.3 删除普通索引"></a>5.1.3 删除普通索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop index 索引名称 on 表名</span><br></pre></td></tr></table></figure>
<h5 id="5-1-4-查看索引"><a href="#5-1-4-查看索引" class="headerlink" title="5.1.4 查看索引"></a>5.1.4 查看索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show index from 表名</span><br></pre></td></tr></table></figure>
<h4 id="5-2-唯一索引"><a href="#5-2-唯一索引" class="headerlink" title="5.2 唯一索引"></a>5.2 唯一索引</h4><blockquote>
<p>唯一索引有两个功能：加速查询 和 唯一约束（可含null）</p>
</blockquote>
<h5 id="5-2-1-创建表时建立唯一索引"><a href="#5-2-1-创建表时建立唯一索引" class="headerlink" title="5.2.1 创建表时建立唯一索引"></a>5.2.1 创建表时建立唯一索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table in1(</span><br><span class="line">    nid int not null auto_increment primary key,</span><br><span class="line">    name varchar(32) not null,</span><br><span class="line">    email varchar(64) not null,</span><br><span class="line">    extra text,</span><br><span class="line">    unique ix_name (name)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="5-2-2-创建唯一索引"><a href="#5-2-2-创建唯一索引" class="headerlink" title="5.2.2 创建唯一索引"></a>5.2.2 创建唯一索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create unique index 索引名称 on 表名（列名）</span><br></pre></td></tr></table></figure>
<h5 id="5-2-3-删除唯一索引"><a href="#5-2-3-删除唯一索引" class="headerlink" title="5.2.3 删除唯一索引"></a>5.2.3 删除唯一索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop unique index 索引名称 on 表名</span><br></pre></td></tr></table></figure>
<h4 id="5-3-主键索引"><a href="#5-3-主键索引" class="headerlink" title="5.3 主键索引"></a>5.3 主键索引</h4><blockquote>
<p>主键有两个功能：加速查询 和 唯一约束（不可含null）</p>
</blockquote>
<h5 id="5-3-1-创建表时建立主键索引"><a href="#5-3-1-创建表时建立主键索引" class="headerlink" title="5.3.1 创建表时建立主键索引"></a>5.3.1 创建表时建立主键索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">create table in1(</span><br><span class="line">    nid int not null auto_increment primary key,</span><br><span class="line">    name varchar(32) not null,</span><br><span class="line">    email varchar(64) not null,</span><br><span class="line">    extra text,</span><br><span class="line">    index ix_name (name)</span><br><span class="line">)</span><br><span class="line">-- 或者</span><br><span class="line">create table in1(</span><br><span class="line">    nid int not null auto_increment,</span><br><span class="line">    name varchar(32) not null,</span><br><span class="line">    email varchar(64) not null,</span><br><span class="line">    extra text,</span><br><span class="line">    primary key(ni1),</span><br><span class="line">    index ix_name (name)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="5-3-2-创建主键"><a href="#5-3-2-创建主键" class="headerlink" title="5.3.2 创建主键"></a>5.3.2 创建主键</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add primary key(列名)</span><br></pre></td></tr></table></figure>
<h5 id="5-3-3-删除唯一索引"><a href="#5-3-3-删除唯一索引" class="headerlink" title="5.3.3 删除唯一索引"></a>5.3.3 删除唯一索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop primary key;</span><br><span class="line">alter table 表名 modify 列名 int,drop primary key;</span><br></pre></td></tr></table></figure>
<h4 id="5-4-组合索引"><a href="#5-4-组合索引" class="headerlink" title="5.4 组合索引"></a>5.4 组合索引</h4><blockquote>
<p>组合索引是将n个列组合成一个索引<br>其应用场景为：频繁的同时使用n列来进行查询，如：where n1 = ‘alex’ and n2 = 666。</p>
</blockquote>
<h5 id="5-4-1-创建表"><a href="#5-4-1-创建表" class="headerlink" title="5.4.1 创建表"></a>5.4.1 创建表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table in3(</span><br><span class="line">    nid int not null auto_increment primary key,</span><br><span class="line">    name varchar(32) not null,</span><br><span class="line">    email varchar(64) not null,</span><br><span class="line">    extra text</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="5-4-2-创建组合索引"><a href="#5-4-2-创建组合索引" class="headerlink" title="5.4.2 创建组合索引"></a>5.4.2 创建组合索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create index 索引名称 on 表名（name,email，...）</span><br><span class="line">-- 如上创建组合索引之后，查询：</span><br><span class="line">-- name and email  -- 使用索引</span><br><span class="line">-- name                 -- 使用索引</span><br><span class="line">-- email                 -- 不使用索引</span><br><span class="line">-- 注意：对于同时搜索n个条件时，组合索引的性能好于多个单一索引合并。</span><br></pre></td></tr></table></figure>
<h3 id="6-条件语句、循环语句、动态SQL"><a href="#6-条件语句、循环语句、动态SQL" class="headerlink" title="6 .条件语句、循环语句、动态SQL"></a>6 .条件语句、循环语句、动态SQL</h3><h4 id="6-1-条件语句"><a href="#6-1-条件语句" class="headerlink" title="6.1 条件语句"></a>6.1 条件语句</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure proc_if()</span><br><span class="line">BEGIN</span><br><span class="line">	declare i int default 0;</span><br><span class="line">	if i=1 then</span><br><span class="line">		select 1;</span><br><span class="line">	elseif i=2 then</span><br><span class="line">		select 2;</span><br><span class="line">	else</span><br><span class="line">		select 7;</span><br><span class="line">	end if;</span><br><span class="line">END //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h4 id="6-2-循环语句"><a href="#6-2-循环语句" class="headerlink" title="6.2 循环语句"></a>6.2 循环语句</h4><h5 id="6-2-1-WHILE循环"><a href="#6-2-1-WHILE循环" class="headerlink" title="6.2.1 WHILE循环"></a>6.2.1 WHILE循环</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure proc_while()</span><br><span class="line">begin</span><br><span class="line">	declare num int;</span><br><span class="line">	set num=0;</span><br><span class="line">	while num &lt; 10 DO</span><br><span class="line">		select num;</span><br><span class="line">		set num=num+1;</span><br><span class="line">	end while;</span><br><span class="line">end //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h5 id="6-2-2-repeat循环"><a href="#6-2-2-repeat循环" class="headerlink" title="6.2.2 repeat循环"></a>6.2.2 repeat循环</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure proc_repeat()</span><br><span class="line">begin</span><br><span class="line">	declare i int;</span><br><span class="line">	set i=0;</span><br><span class="line">	repeat</span><br><span class="line">		select i;</span><br><span class="line">		set i=i+1;</span><br><span class="line">		until i&gt;=5</span><br><span class="line">	end repeat;</span><br><span class="line">end //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<h5 id="6-2-3-loop循环"><a href="#6-2-3-loop循环" class="headerlink" title="6.2.3 loop循环"></a>6.2.3 loop循环</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">begin</span><br><span class="line">	declare i int default 0;</span><br><span class="line">	loop_label:loop</span><br><span class="line">		set i=i+1;</span><br><span class="line">		if i&lt;8 then</span><br><span class="line">			iterate loop_label;</span><br><span class="line">		end if;</span><br><span class="line">		select i;</span><br><span class="line">	end loop loop_label;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h5 id="6-3-动态执行SQL语句"><a href="#6-3-动态执行SQL语句" class="headerlink" title="6.3 动态执行SQL语句"></a>6.3 动态执行SQL语句</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">drop procedure if exists proc_sql //</span><br><span class="line">create procedure proc_sql()</span><br><span class="line">begin</span><br><span class="line">	declare p1 int;</span><br><span class="line">	set p1 = 11;</span><br><span class="line">	set @p1 = p1;</span><br><span class="line">	prepare prod from &apos;select * from c where id &gt; ?&apos;;</span><br><span class="line">	execute prod using @p1;</span><br><span class="line">	deallocate prepare prod;</span><br><span class="line">end //</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/01/19/MySQL语法-Day57/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/19/MySQL语法-Day57/" itemprop="url">MySQL语法-Day57</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-19T16:45:02+08:00">
                2019-01-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  10
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MySQL语法-Day57"><a href="#MySQL语法-Day57" class="headerlink" title="MySQL语法-Day57"></a>MySQL语法-Day57</h2><h4 id="1-用户、权限操作"><a href="#1-用户、权限操作" class="headerlink" title="1. 用户、权限操作"></a>1. 用户、权限操作</h4><h5 id="1-1-用户操作"><a href="#1-1-用户操作" class="headerlink" title="1.1 用户操作"></a>1.1 用户操作</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- 创建用户(root账号登陆服务器)</span><br><span class="line">-- create user &apos;用户名&apos;@&apos;ip地址&apos; identified by &apos;密码&apos;      ip地址为 % 表示 所有地址--- 都可以登陆</span><br><span class="line">	use mysql</span><br><span class="line">	create user &apos;dbuser1&apos;@&apos;%&apos; identified by &apos;123456&apos;;</span><br><span class="line">-- 删除用户</span><br><span class="line">drop user &apos;用户名&apos;@&apos;IP地址&apos;;</span><br><span class="line">-- 修改用户</span><br><span class="line">rename user &apos;用户名&apos;@&apos;IP地址&apos; to &apos;新用户名&apos;@&apos;IP地址&apos;;</span><br><span class="line">-- 修改密码</span><br><span class="line">set password for &apos;用户名&apos;@&apos;IP地址&apos; = Password(&apos;新密码&apos;)</span><br><span class="line">-- ps:用户权限相关数据保存在mysql数据库的user表中，也可以直接对其进行操作（不建议）</span><br></pre></td></tr></table></figure>
<h5 id="1-2-权限操作"><a href="#1-2-权限操作" class="headerlink" title="1.2 权限操作"></a>1.2 权限操作</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- 查看权限</span><br><span class="line">show grants for &apos;用户&apos;@&apos;IP地址&apos;;</span><br><span class="line">-- 设置权限</span><br><span class="line">grant 权限 on 数据库.表 to &apos;用户&apos;@&apos;IP地址&apos;;</span><br><span class="line">-- grant select,insert,update,delete on 数据库.表 to 用户名@ip地址    </span><br><span class="line">	grant select,insert,update on db1.* to &apos;dbuser1&apos;@&apos;%&apos;;</span><br><span class="line">	-- 上句表示在dbl数据库的所有表中分配select,insert,update的权限给用户dbuser1</span><br><span class="line">	grant all privileges on *.* to &apos;zdj&apos;@&apos;%&apos;;  </span><br><span class="line">	-- 上句表示在所有数据库中分配所有权限给用户zdj</span><br><span class="line">-- 取消权限</span><br><span class="line">remove 权限 on 数据库.表 from &apos;用户&apos;@&apos;IP地址&apos;;</span><br></pre></td></tr></table></figure>
<h6 id="1-2-1-权限说明"><a href="#1-2-1-权限说明" class="headerlink" title="1.2.1 权限说明"></a>1.2.1 权限说明</h6><blockquote>
<pre><code>all privileges             除grant外的所有权限
select          仅查权限
select,insert   查和插入权限
usage                   无访问权限
alter                   使用alter table
alter routine           使用alter procedure和drop procedure
create                  使用create table
create routine          使用create procedure
create temporary tables 使用create temporary tables
create user             使用create user、drop user、rename user和revoke  all privileges
create view             使用create view
delete                  使用delete
drop                    使用drop table
execute                 使用call和存储过程
file                    使用select into outfile 和 load data infile
grant option            使用grant 和 revoke
index                   使用index
insert                  使用insert
lock tables             使用lock table
process                 使用show full processlist
select                  使用select
show databases          使用show databases
show view               使用show view
update                  使用update
reload                  使用flush
shutdown                使用mysqladmin shutdown(关闭MySQL)
super                   使用change master、kill、logs、purge、master和set global。还允许`mysqladmin`调试登陆
replication client      服务器位置的访问
replication slave       由复制从属使用
</code></pre></blockquote>
<h6 id="1-2-2-目标数据库说明"><a href="#1-2-2-目标数据库说明" class="headerlink" title="1.2.2 目标数据库说明"></a>1.2.2 目标数据库说明</h6><blockquote>
<pre><code>数据库名.*           数据库中的所有
  数据库名.表          指定数据库中的某张表
  数据库名.存储过程     指定数据库中的存储过程
  `*.* `               所有数据库
  用户名@IP地址         用户只能在改IP下才能访问
  用户名@192.168.1.%   用户只能在改IP段下才能访问(通配符%表示任意)
  用户名@%             用户可以再任意IP下访问(默认IP地址为%)
</code></pre></blockquote>
<h4 id="2-数据库操作"><a href="#2-数据库操作" class="headerlink" title="2. 数据库操作"></a>2. 数据库操作</h4><h5 id="2-1-显示数据库"><a href="#2-1-显示数据库" class="headerlink" title="2.1 显示数据库"></a>2.1 显示数据库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></figure>
<h5 id="2-2-创建数据库"><a href="#2-2-创建数据库" class="headerlink" title="2.2 创建数据库"></a>2.2 创建数据库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- create database 数据库名 default charset utf8;</span><br><span class="line">create database db3 default charset utf8;</span><br><span class="line">	-- 以上语句表示创建一个叫db3的数据库，编码方式为 utf8,支持中文</span><br></pre></td></tr></table></figure>
<h5 id="2-3-使用数据库"><a href="#2-3-使用数据库" class="headerlink" title="2.3 使用数据库"></a>2.3 使用数据库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use db3;</span><br><span class="line">	-- 以上语句表示 选择数据库db3</span><br></pre></td></tr></table></figure>
<h5 id="2-4-删除数据库"><a href="#2-4-删除数据库" class="headerlink" title="2.4 删除数据库"></a>2.4 删除数据库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drop database db3;</span><br><span class="line">	-- 以上语句表示 删除数据库db3</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="3-数据表操作"><a href="#3-数据表操作" class="headerlink" title="3.数据表操作"></a>3.数据表操作</h4><h5 id="3-1-创建表"><a href="#3-1-创建表" class="headerlink" title="3.1  创建表"></a>3.1  创建表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">-- 查看表</span><br><span class="line">show tables;</span><br><span class="line">-- 创建表</span><br><span class="line">-- create table 表名（数据列 类型|null|not null|auto_increment primary key) engine=innodb default charset=utf8;</span><br><span class="line">create table t1(id int not null auto_increment primary key,</span><br><span class="line">name varchar(25),</span><br><span class="line">age int</span><br><span class="line">)engine=innodb default charset=utf8;</span><br><span class="line"></span><br><span class="line">-- 设置是否为空</span><br><span class="line">-- 是否可空，null表示空，非字符串</span><br><span class="line">          --  not null    - 不可空</span><br><span class="line">          --  null        - 可空</span><br><span class="line">-- 设置默认值</span><br><span class="line">-- 默认值，创建列时可以指定默认值，当插入数据时如果未主动设置，则自动添加默认值</span><br><span class="line">            create table tb1(</span><br><span class="line">                nid int not null defalut 2,</span><br><span class="line">                num int not null</span><br><span class="line">            )</span><br><span class="line">-- 设置自增</span><br><span class="line">-- 自增，如果为某列设置自增列，插入数据时无需设置此列，默认将自增（表中只能有一个自增列）</span><br><span class="line">            create table tb1(</span><br><span class="line">                nid int not null auto_increment primary key,</span><br><span class="line">                num int null</span><br><span class="line">            )</span><br><span class="line">           -- 或</span><br><span class="line">            create table tb1(</span><br><span class="line">                nid int not null auto_increment,</span><br><span class="line">                num int null,</span><br><span class="line">                index(nid)</span><br><span class="line">            )</span><br><span class="line">           -- 注意：1、对于自增列，必须是索引（含主键）。</span><br><span class="line">              --   2、对于自增可以设置步长和起始值</span><br><span class="line">                     show session variables like &apos;auto_inc%&apos;;</span><br><span class="line">                     set session auto_increment_increment=2;</span><br><span class="line">                     set session auto_increment_offset=10;</span><br><span class="line"></span><br><span class="line">                     shwo global  variables like &apos;auto_inc%&apos;;</span><br><span class="line">                     set global auto_increment_increment=2;</span><br><span class="line">                     set global auto_increment_offset=10;</span><br><span class="line">-- 设置主键</span><br><span class="line">-- 主键，一种特殊的唯一索引，不允许有空值，如果主键使用单个列，则它的值必须唯一，如果是多列，则其组合必须唯一。</span><br><span class="line">            create table tb1(</span><br><span class="line">                nid int not null auto_increment primary key,</span><br><span class="line">                num int null</span><br><span class="line">            )</span><br><span class="line">         --   或</span><br><span class="line">            create table tb1(</span><br><span class="line">                nid int not null,</span><br><span class="line">                num int not null,</span><br><span class="line">                primary key(nid,num)</span><br><span class="line">            )</span><br><span class="line">-- 设置外键</span><br><span class="line">-- 外键，一个特殊的索引，只能是指定内容</span><br><span class="line">            creat table color(</span><br><span class="line">                nid int not null primary key,</span><br><span class="line">                name char(16) not null</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            create table fruit(</span><br><span class="line">                nid int not null primary key,</span><br><span class="line">                smt char(32) null ,</span><br><span class="line">                color_id int not null,</span><br><span class="line">                constraint fk_cc foreign key (color_id) references color(nid)</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>
<h5 id="3-2-查看表的结构"><a href="#3-2-查看表的结构" class="headerlink" title="3.2 查看表的结构"></a>3.2 查看表的结构</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- describe可以简写成desc</span><br><span class="line">describe t1;</span><br></pre></td></tr></table></figure>
<h5 id="3-3-修改表"><a href="#3-3-修改表" class="headerlink" title="3.3 修改表"></a>3.3 修改表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- 添加列：</span><br><span class="line">alter table 表名 add 列名 类型</span><br><span class="line">-- 删除列：</span><br><span class="line">alter table 表名 drop column 列名</span><br><span class="line">-- 修改列：</span><br><span class="line">alter table 表名 modify column 列名 类型;  -- 类型</span><br><span class="line">alter table 表名 change 原列名 新列名 类型; -- 列名，类型</span><br><span class="line">  </span><br><span class="line">-- 添加主键：</span><br><span class="line">alter table 表名 add primary key(列名);</span><br><span class="line">-- 删除主键：</span><br><span class="line">alter table 表名 drop primary key;</span><br><span class="line">alter table 表名  modify  列名 int, drop primary key;</span><br><span class="line">-- 添加外键：</span><br><span class="line">alter table 从表 add constraint 外键名称（形如：FK_从表_主表） foreign key 从表(外键字段) references 主表(主键字段);</span><br><span class="line">-- 删除外键：</span><br><span class="line">alter table 表名 drop foreign key 外键名称</span><br><span class="line">-- 修改默认值：</span><br><span class="line">ALTER TABLE testalter_tbl ALTER i SET DEFAULT 1000;</span><br><span class="line">-- 删除默认值：</span><br><span class="line">ALTER TABLE testalter_tbl ALTER i DROP DEFAULT;</span><br></pre></td></tr></table></figure>
<h5 id="3-4-清空表"><a href="#3-4-清空表" class="headerlink" title="3.4 清空表"></a>3.4 清空表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 第一种方法,下次插入数据后自增列会从上次继续编号</span><br><span class="line">delete from t1;</span><br><span class="line">-- 第二种方法，下次插入数据后自增列从1开始编号</span><br><span class="line">truncate table t1;</span><br></pre></td></tr></table></figure>
<h5 id="3-5-删除表"><a href="#3-5-删除表" class="headerlink" title="3.5 删除表"></a>3.5 删除表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 删除表</span><br><span class="line">drop table t1;</span><br></pre></td></tr></table></figure>
<h5 id="3-6-表的数据操作"><a href="#3-6-表的数据操作" class="headerlink" title="3.6 表的数据操作"></a>3.6 表的数据操作</h5><h5 id="3-6-1-数据类型"><a href="#3-6-1-数据类型" class="headerlink" title="3.6.1 数据类型"></a>3.6.1 数据类型</h5><p>MySQL的数据类型大致分为：数值、时间和字符串<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">bit[(M)]</span><br><span class="line">          二进制位（101001），m表示二进制位的长度（1-64），默认m＝1</span><br><span class="line">      tinyint[(m)] [unsigned] [zerofill]</span><br><span class="line">          小整数，数据类型用于保存一些范围的整数数值范围：</span><br><span class="line">          有符号：</span><br><span class="line">              -128 ～ 127.</span><br><span class="line">          无符号：～ 255</span><br><span class="line">          特别的： MySQL中无布尔值，使用tinyint(1)构造。</span><br><span class="line">      int[(m)][unsigned][zerofill]</span><br><span class="line">          整数，数据类型用于保存一些范围的整数数值范围：</span><br><span class="line">              有符号：</span><br><span class="line">                  -2147483648 ～ 2147483647</span><br><span class="line">              无符号：～ 4294967295</span><br><span class="line">          特别的：整数类型中的m仅用于显示，对存储范围无限制。例如： int(5),当插入数据2时，select 时数据显示为： 00002</span><br><span class="line">      bigint[(m)][unsigned][zerofill]</span><br><span class="line">          大整数，数据类型用于保存一些范围的整数数值范围：</span><br><span class="line">              有符号：</span><br><span class="line">                  -9223372036854775808 ～ 9223372036854775807</span><br><span class="line">              无符号：～  18446744073709551615</span><br><span class="line">      decimal[(m[,d])] [unsigned] [zerofill]</span><br><span class="line">          准确的小数值，m是数字总个数（负号不算），d是小数点后个数。 m最大值为65，d最大值为30。</span><br><span class="line">          特别的：对于精确数值计算时需要用此类型</span><br><span class="line">                 decaimal能够存储精确值的原因在于其内部按照字符串存储。</span><br><span class="line">      FLOAT[(M,D)] [UNSIGNED] [ZEROFILL]</span><br><span class="line">          单精度浮点数（非准确小数值），m是数字总个数，d是小数点后个数。</span><br><span class="line">              无符号：</span><br><span class="line">                  -3.402823466E+38 to -1.175494351E-38,</span><br><span class="line">                  1.175494351E-38 to 3.402823466E+38</span><br><span class="line">              有符号：</span><br><span class="line">                  1.175494351E-38 to 3.402823466E+38</span><br><span class="line">          **** 数值越大，越不准确 ****</span><br><span class="line">      DOUBLE[(M,D)] [UNSIGNED] [ZEROFILL]</span><br><span class="line">          双精度浮点数（非准确小数值），m是数字总个数，d是小数点后个数。</span><br><span class="line">              无符号：</span><br><span class="line">                  -1.7976931348623157E+308 to -2.2250738585072014E-308</span><br><span class="line">                  2.2250738585072014E-308 to 1.7976931348623157E+308</span><br><span class="line">              有符号：</span><br><span class="line">                  2.2250738585072014E-308 to 1.7976931348623157E+308</span><br><span class="line">          **** 数值越大，越不准确 ****</span><br><span class="line">      char (m)</span><br><span class="line">          char数据类型用于表示固定长度的字符串，可以包含最多达255个字符。其中m代表字符串的长度。</span><br><span class="line">          PS: 即使数据小于m长度，也会占用m长度</span><br><span class="line">      varchar(m)</span><br><span class="line">          varchars数据类型用于变长的字符串，可以包含最多达255个字符。其中m代表该数据类型所允许保存的字符串的最大长度，只要长度小于该最大值的字符串都可以被保存在该数据类型中。</span><br><span class="line">          注：虽然varchar使用起来较为灵活，但是从整个系统的性能角度来说，char数据类型的处理速度更快，有时甚至可以超出varchar处理速度的50%。因此，用户在设计数据库时应当综合考虑各方面的因素，以求达到最佳的平衡</span><br><span class="line">      text</span><br><span class="line">          text数据类型用于保存变长的大字符串，可以组多到65535 (2**16 − 1)个字符。</span><br><span class="line">      mediumtext</span><br><span class="line">          A TEXT column with a maximum length of 16,777,215 (2**24 − 1) characters.</span><br><span class="line">      longtext</span><br><span class="line">          A TEXT column with a maximum length of 4,294,967,295 or 4GB (2**32 − 1) characters.</span><br><span class="line">      enum</span><br><span class="line">          枚举类型，</span><br><span class="line">          An ENUM column can have a maximum of 65,535 distinct elements. (The practical limit is less than 3000.)</span><br><span class="line">          示例：</span><br><span class="line">              CREATE TABLE shirts (</span><br><span class="line">                  name VARCHAR(40),</span><br><span class="line">                  size ENUM(&apos;x-small&apos;, &apos;small&apos;, &apos;medium&apos;, &apos;large&apos;, &apos;x-large&apos;)</span><br><span class="line">              );</span><br><span class="line">              INSERT INTO shirts (name, size) VALUES (&apos;dress shirt&apos;,&apos;large&apos;), (&apos;t-shirt&apos;,&apos;medium&apos;),(&apos;polo shirt&apos;,&apos;small&apos;);</span><br><span class="line">      set</span><br><span class="line">          集合类型</span><br><span class="line">          A SET column can have a maximum of 64 distinct members.</span><br><span class="line">          示例：</span><br><span class="line">              CREATE TABLE myset (col SET(&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;));</span><br><span class="line">              INSERT INTO myset (col) VALUES (&apos;a,d&apos;), (&apos;d,a&apos;), (&apos;a,d,a&apos;), (&apos;a,d,d&apos;), (&apos;d,a,d&apos;);</span><br><span class="line">      DATE</span><br><span class="line">          YYYY-MM-DD（1000-01-01/9999-12-31）</span><br><span class="line">      TIME</span><br><span class="line">          HH:MM:SS（&apos;-838:59:59&apos;/&apos;838:59:59&apos;）</span><br><span class="line">      YEAR</span><br><span class="line">          YYYY（1901/2155）</span><br><span class="line">      DATETIME</span><br><span class="line">          YYYY-MM-DD HH:MM:SS（1000-01-01 00:00:00/9999-12-31 23:59:59    Y）</span><br><span class="line">      TIMESTAMP</span><br><span class="line">          YYYYMMDD HHMMSS（1970-01-01 00:00:00/2037 年某时）</span><br></pre></td></tr></table></figure></p>
<h5 id="3-6-2-插入数据"><a href="#3-6-2-插入数据" class="headerlink" title="3.6.2 插入数据"></a>3.6.2 插入数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insert into t1(name,age) values(&apos;wx&apos;,28);</span><br><span class="line">insert into t1(name,age) values(&apos;df&apos;,48);</span><br><span class="line">insert into t1(name,age) values(&apos;er&apos;,22);</span><br><span class="line">insert into t1(name,age) values(&apos;刘德华&apos;,58);</span><br></pre></td></tr></table></figure>
<h5 id="3-6-3-查询数据"><a href="#3-6-3-查询数据" class="headerlink" title="3.6.3 查询数据"></a>3.6.3 查询数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t1;</span><br></pre></td></tr></table></figure>
<h5 id="3-6-4-修改数据"><a href="#3-6-4-修改数据" class="headerlink" title="3.6.4 修改数据"></a>3.6.4 修改数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update t1 set name=&apos;庞龙&apos; where id =1;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/01/14/IO多路复用-Day42/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/14/IO多路复用-Day42/" itemprop="url">IO多路复用-Day42</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-14T21:38:02+08:00">
                2019-01-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  145
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="IO多路复用-Day42"><a href="#IO多路复用-Day42" class="headerlink" title="IO多路复用-Day42"></a>IO多路复用-Day42</h2><h4 id="1-socket端代码"><a href="#1-socket端代码" class="headerlink" title="1. socket端代码"></a>1. socket端代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author : 渝周郎</span></span><br><span class="line"><span class="comment"># Time   : 2019/1/14 20:21</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>, <span class="number">4567</span>))</span><br><span class="line">sk.listen()</span><br><span class="line"></span><br><span class="line">sk_list = [sk]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">	r_list, w_list, x_list = select.select(sk_list, [], [])</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> r_list:</span><br><span class="line">		<span class="keyword">if</span> i <span class="keyword">is</span> sk:     <span class="comment"># 判断i是否为socket对象</span></span><br><span class="line">			conn, addr = i.accept()</span><br><span class="line">			sk_list.append(conn)</span><br><span class="line">		<span class="keyword">else</span>:   <span class="comment"># 当i为conn时</span></span><br><span class="line">			ret = i.recv(<span class="number">1024</span>)</span><br><span class="line">			<span class="keyword">if</span> ret == <span class="string">b''</span>:</span><br><span class="line">				i.close()</span><br><span class="line">				sk_list.remove(i)</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			print(ret)</span><br><span class="line">			i.send(<span class="string">b'hello'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2-client端代码"><a href="#2-client端代码" class="headerlink" title="2. client端代码"></a>2. client端代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author : 渝周郎</span></span><br><span class="line"><span class="comment"># Time   : 2019/1/14 20:21</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.connect((<span class="string">'127.0.0.1'</span>, <span class="number">4567</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">	sk.send(<span class="string">b'goodbye'</span>)</span><br><span class="line">	ret = sk.recv(<span class="number">1024</span>)</span><br><span class="line">	print(ret)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">	Thread(target=func).start()</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="运行结果如下"><a href="#运行结果如下" class="headerlink" title="运行结果如下:"></a>运行结果如下:</h4></blockquote>
<p><img src="/2019/01/14/IO多路复用-Day42/201901142144.gif" alt="IO多路复用-Day42"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/01/10/协程应用举例-Day42/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/10/协程应用举例-Day42/" itemprop="url">协程应用举例-Day42</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-10T21:55:02+08:00">
                2019-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  204
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="协程应用举例-Day42"><a href="#协程应用举例-Day42" class="headerlink" title="协程应用举例-Day42"></a>协程应用举例-Day42</h2><h4 id="1-爬虫"><a href="#1-爬虫" class="headerlink" title="1. 爬虫"></a>1. 爬虫</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author : 渝周郎</span></span><br><span class="line"><span class="comment"># Time   : 2019/1/10 21:55</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey;monkey.patch_all()</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_url</span><span class="params">(url)</span>:</span></span><br><span class="line">	response = urlopen(url)</span><br><span class="line">	context = response.read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">	<span class="keyword">return</span> url, len(context)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urls = [<span class="string">'http://www.baidu.com'</span>, </span><br><span class="line">		<span class="string">'http://www.sohu.com'</span>, </span><br><span class="line">		<span class="string">'http://www.cnblogs.com'</span>, </span><br><span class="line">		<span class="string">'http://www.360.cn'</span>, </span><br><span class="line">		<span class="string">'http://139139.cn'</span></span><br><span class="line">		]</span><br><span class="line">g_lst = []</span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">	g = gevent.spawn(get_url, url)</span><br><span class="line">	g_lst.append(g)</span><br><span class="line"><span class="keyword">for</span> gg <span class="keyword">in</span> g_lst:</span><br><span class="line">	gg.join()</span><br><span class="line">	print(gg.value)</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="运行结果如下"><a href="#运行结果如下" class="headerlink" title="运行结果如下:"></a>运行结果如下:</h4><p><img src="/2019/01/10/协程应用举例-Day42/201901102221.gif" alt="协程应用举例-Day42"></p>
</blockquote>
<h4 id="2-通过gevent实现单线程下的socket并发"><a href="#2-通过gevent实现单线程下的socket并发" class="headerlink" title="2. 通过gevent实现单线程下的socket并发"></a>2. 通过gevent实现单线程下的socket并发</h4><h5 id="2-1-server端代码"><a href="#2-1-server端代码" class="headerlink" title="2.1  server端代码"></a>2.1  server端代码</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey;monkey.patch_all()</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>, <span class="number">4567</span>))</span><br><span class="line">sk.listen()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_conn</span><span class="params">(conn)</span>:</span></span><br><span class="line">    conn.send(<span class="string">b'hello'</span>)</span><br><span class="line">    rev = conn.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    print(rev)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    conn, addr = sk.accept()</span><br><span class="line">    print(conn.getsockname())</span><br><span class="line">    gevent.spawn(get_conn,conn)</span><br><span class="line"></span><br><span class="line">sk.close()</span><br></pre></td></tr></table></figure>
<h5 id="2-2-client端代码"><a href="#2-2-client端代码" class="headerlink" title="2.2 client端代码"></a>2.2 client端代码</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.connect((<span class="string">'127.0.0.1'</span>, <span class="number">4567</span>))</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    rev = sk.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    print(rev)</span><br><span class="line">    msg = input(<span class="string">'&gt;&gt;&gt;'</span>).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">    sk.send(msg)</span><br><span class="line"></span><br><span class="line">sk.close()</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2019/01/10/协程之gevent模块-Day42/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/10/协程之gevent模块-Day42/" itemprop="url">协程之gevent模块-Day42</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-10T21:08:02+08:00">
                2019-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  478
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="协程之gevent模块-Day42"><a href="#协程之gevent模块-Day42" class="headerlink" title="协程之gevent模块-Day42"></a>协程之gevent模块-Day42</h2><h4 id="1-用法介绍"><a href="#1-用法介绍" class="headerlink" title="1. 用法介绍"></a>1. 用法介绍</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">g1=gevent.spawn(func,<span class="number">1</span>,,<span class="number">2</span>,<span class="number">3</span>,x=<span class="number">4</span>,y=<span class="number">5</span>)创建一个协程对象g1，spawn括号内第一个参数是函数名，如eat，后面可以有多个参数，可以是位置实参或关键字实参，都是传给函数eat的</span><br><span class="line"></span><br><span class="line">g2=gevent.spawn(func2)</span><br><span class="line"></span><br><span class="line">g1.join() <span class="comment">#等待g1结束</span></span><br><span class="line"></span><br><span class="line">g2.join() <span class="comment">#等待g2结束</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#或者上述两步合作一步：gevent.joinall([g1,g2])</span></span><br><span class="line"></span><br><span class="line">g1.value<span class="comment">#拿到func1的返回值</span></span><br></pre></td></tr></table></figure>
<h4 id="2-IO主动切换"><a href="#2-IO主动切换" class="headerlink" title="2. IO主动切换"></a>2. IO主动切换</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">'开始吃饭'</span>)</span><br><span class="line">	<span class="comment"># time.sleep(2)  # gevent模块无法感知time.sleep等IO操作，只能使用自身的sleep；除非在程序最顶端引用monkey.patch_all()</span></span><br><span class="line">	gevent.sleep(<span class="number">2</span>)</span><br><span class="line">	print(<span class="string">'结束吃饭'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">'开始玩耍'</span>)</span><br><span class="line">	<span class="comment"># time.sleep(2)</span></span><br><span class="line">	gevent.sleep(<span class="number">2</span>)</span><br><span class="line">	print(<span class="string">'结束玩耍'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = gevent.spawn(eat)</span><br><span class="line">g2 = gevent.spawn(play)</span><br><span class="line"></span><br><span class="line">g1.join()</span><br><span class="line">g2.join()</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="上例gevent-sleep-2-模拟的是gevent可以识别的io阻塞-而time-sleep-2-或其他的阻塞-gevent是不能直接识别的需要用下面一行代码-打补丁-就可以识别了"><a href="#上例gevent-sleep-2-模拟的是gevent可以识别的io阻塞-而time-sleep-2-或其他的阻塞-gevent是不能直接识别的需要用下面一行代码-打补丁-就可以识别了" class="headerlink" title="上例gevent.sleep(2)模拟的是gevent可以识别的io阻塞,而time.sleep(2)或其他的阻塞,gevent是不能直接识别的需要用下面一行代码,打补丁,就可以识别了"></a>上例gevent.sleep(2)模拟的是gevent可以识别的io阻塞,而time.sleep(2)或其他的阻塞,gevent是不能直接识别的需要用下面一行代码,打补丁,就可以识别了</h4><h4 id="from-gevent-import-monkey-monkey-patch-all-必须放到被打补丁者的前面，如time，socket模块之前"><a href="#from-gevent-import-monkey-monkey-patch-all-必须放到被打补丁者的前面，如time，socket模块之前" class="headerlink" title="from gevent import monkey;monkey.patch_all()必须放到被打补丁者的前面，如time，socket模块之前"></a><code>from gevent import monkey;monkey.patch_all()</code>必须放到被打补丁者的前面，如time，socket模块之前</h4><h4 id="或者我们干脆记忆成：要用gevent，需要将from-gevent-import-monkey-monkey-patch-all-放到文件的开头"><a href="#或者我们干脆记忆成：要用gevent，需要将from-gevent-import-monkey-monkey-patch-all-放到文件的开头" class="headerlink" title="或者我们干脆记忆成：要用gevent，需要将from gevent import monkey;monkey.patch_all()放到文件的开头"></a>或者我们干脆记忆成：要用gevent，需要将<code>from gevent import monkey;monkey.patch_all()</code>放到文件的开头</h4><h4 id="见下面的代码"><a href="#见下面的代码" class="headerlink" title="见下面的代码"></a>见下面的代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey;monkey.patch_all()</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">'开始吃饭'</span>)</span><br><span class="line">	time.sleep(<span class="number">2</span>)</span><br><span class="line">	print(<span class="string">'结束吃饭'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">'开始玩耍'</span>)</span><br><span class="line">	time.sleep(<span class="number">2</span>)</span><br><span class="line">	print(<span class="string">'结束玩耍'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g1 = gevent.spawn(eat)</span><br><span class="line">g2 = gevent.spawn(play)</span><br><span class="line"></span><br><span class="line">g1.join()</span><br><span class="line">g2.join()</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="3-gevent的同步与异步"><a href="#3-gevent的同步与异步" class="headerlink" title="3. gevent的同步与异步"></a>3. gevent的同步与异步</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author : 渝周郎</span></span><br><span class="line"><span class="comment"># Time   : 2019/01/10 21:08</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey;monkey.patch_all()</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">()</span>:</span></span><br><span class="line">	time.sleep(<span class="number">1</span>)   <span class="comment"># IO操作</span></span><br><span class="line">	print(<span class="string">'%s :hello.'</span>% time.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sync_tb</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">'***同步运行任务开始***'</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">		task()</span><br><span class="line">	print(<span class="string">'***同步运行任务结束***'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">async_yb</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">'***异步运行任务开始***'</span>)</span><br><span class="line">	g_lst = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">		g = gevent.spawn(task)</span><br><span class="line">		g_lst.append(g)</span><br><span class="line">	gevent.joinall(g_lst)</span><br><span class="line">	print(<span class="string">'***异步运行任务结束***'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sync_tb()</span><br><span class="line">async_yb()</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="运行结果如下"><a href="#运行结果如下" class="headerlink" title="运行结果如下:"></a>运行结果如下:</h4></blockquote>
<p><img src="/2019/01/10/协程之gevent模块-Day42/201901102129.gif" alt="协程之gevent模块-Day42"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2018/12/28/线程之线程池-Day41/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/28/线程之线程池-Day41/" itemprop="url">线程之线程池-Day41</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-28T21:28:02+08:00">
                2018-12-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  368
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="线程之线程池-Day41"><a href="#线程之线程池-Day41" class="headerlink" title="线程之线程池-Day41"></a>线程之线程池-Day41</h2><blockquote>
<ol>
<li>介绍<br>concurrent.futures模块提供了高度封装的异步调用接口<br>ThreadPoolExecutor：线程池，提供异步调用<br>ProcessPoolExecutor: 进程池，提供异步调用<br>Both implement the same interface, which is defined by the abstract Executor class.</li>
<li>基本方法<br>#submit(fn, <em>args, **kwargs)<br>异步提交任务<br>#map(func, </em>iterables, timeout=None, chunksize=1)<br>取代for循环submit的操作<br>#shutdown(wait=True)<br>相当于进程池的pool.close()+pool.join()操作<br>wait=True，等待池内所有任务执行完毕回收完资源后才继续<br>wait=False，立即返回，并不会等待池内的任务执行完毕<br>但不管wait参数为何值，整个程序都会等到所有任务执行完毕<br>submit和map必须在shutdown之前<br>#result(timeout=None)<br>取得结果<br>#add_done_callback(fn)<br>回调函数</li>
</ol>
</blockquote>
<h4 id="代码如下："><a href="#代码如下：" class="headerlink" title="代码如下："></a>代码如下：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author : 渝周郎</span></span><br><span class="line"><span class="comment"># Time   : 2018/12/28 21:09</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># concurrent.futures模块提供了高度封装的异步调用接口</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor：线程池，提供异步调用</span></span><br><span class="line"><span class="comment"># ProcessPoolExecutor: 进程池，提供异步调用</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line">t_pool = ThreadPoolExecutor(max_workers=<span class="number">5</span>)  <span class="comment"># 同时运行5个线程,最大线程数不能超过CPU个数*5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(n)</span>:</span></span><br><span class="line">	time.sleep(<span class="number">2</span>)</span><br><span class="line">	print(n)</span><br><span class="line">	<span class="keyword">return</span> n*n</span><br><span class="line"><span class="comment"># submit(fn, *args, **kwargs) 异步提交任务</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t_lst = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>): <span class="comment"># 可以用 t_pool.map(func, range(20)) 取代for循环submit的操作</span></span><br><span class="line">	t = t_pool.submit(func, i)</span><br><span class="line">	t_lst.append(t)</span><br><span class="line"></span><br><span class="line">t_pool.shutdown()   <span class="comment"># shutdown(wait=True)  相当于进程池的pool.close()+pool.join()操作</span></span><br><span class="line">print(<span class="string">'主线程'</span>)</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> t_lst:</span><br><span class="line">	print(<span class="string">'-'</span>*<span class="number">10</span>, t.result())   <span class="comment"># result()获取函数结果</span></span><br></pre></td></tr></table></figure>
<h4 id="运行结果如下"><a href="#运行结果如下" class="headerlink" title="运行结果如下:"></a>运行结果如下:</h4><p><img src="/2018/12/28/线程之线程池-Day41/201812282129.gif" alt="线程之线程池-Day41"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2018/12/28/线程之队列-Day41/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/28/线程之队列-Day41/" itemprop="url">线程之队列-Day41</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-28T20:45:02+08:00">
                2018-12-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  245
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="线程之队列-Day41"><a href="#线程之队列-Day41" class="headerlink" title="线程之队列-Day41"></a>线程之队列-Day41</h2><h4 id="代码如下："><a href="#代码如下：" class="headerlink" title="代码如下："></a>代码如下：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author : 渝周郎</span></span><br><span class="line"><span class="comment"># Time   : 2018/12/28 20:24</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line">print(<span class="string">'*'</span>*<span class="number">10</span>, <span class="string">'以下是Queue()的代码,先进先出'</span>, <span class="string">"*"</span>*<span class="number">10</span>)</span><br><span class="line">q1 = queue.Queue()  <span class="comment"># 先进先出队列</span></span><br><span class="line">q1.put(<span class="number">1</span>)</span><br><span class="line">q1.put(<span class="number">6</span>)</span><br><span class="line">q1.put(<span class="number">3</span>)</span><br><span class="line">print(q1.get()) <span class="comment"># 第一个被取出来的是 1</span></span><br><span class="line">print(q1.get()) <span class="comment"># 第二个被取出来的是 6</span></span><br><span class="line">print(<span class="string">'*'</span>*<span class="number">10</span>, <span class="string">'以下是LifoQueue()的代码，先结后出'</span>, <span class="string">"*"</span>*<span class="number">10</span>)</span><br><span class="line">q2 = queue.LifoQueue()  <span class="comment"># 其实是栈，先进后出队列</span></span><br><span class="line">q2.put(<span class="number">10</span>)</span><br><span class="line">q2.put(<span class="number">15</span>)</span><br><span class="line">q2.put(<span class="number">20</span>)</span><br><span class="line">print(q2.get()) <span class="comment"># 第一个被取出来的是 20</span></span><br><span class="line">print(q2.get()) <span class="comment"># 第二个被取出来的是 15</span></span><br><span class="line">print(<span class="string">'*'</span>*<span class="number">10</span>, <span class="string">'以下是PriorityQueue()的代码,优先级队列'</span>, <span class="string">"*"</span>*<span class="number">10</span>)</span><br><span class="line">q3 = queue.PriorityQueue()  <span class="comment"># 优先级队列,当第一个参数相同时，按第二个参数ACSⅡ码进行排序</span></span><br><span class="line">q3.put(<span class="number">100</span>, <span class="string">'d'</span>)</span><br><span class="line">q3.put(<span class="number">150</span>, <span class="string">'a'</span>)</span><br><span class="line">q3.put(<span class="number">200</span>, <span class="string">'c'</span>)</span><br><span class="line">q3.put(<span class="number">150</span>, <span class="string">'b'</span>)</span><br><span class="line">print(q3.get()) <span class="comment"># 第一个被取出来的是 (100, 'd')</span></span><br><span class="line">print(q3.get()) <span class="comment"># 第二个被取出来的是 (150, 'a')</span></span><br><span class="line">print(q3.get()) <span class="comment"># 第三个被取出来的是 (150, 'b')</span></span><br></pre></td></tr></table></figure>
<h4 id="运行结果如下"><a href="#运行结果如下" class="headerlink" title="运行结果如下:"></a>运行结果如下:</h4><p><img src="/2018/12/28/线程之队列-Day41/201812282043.gif" alt="线程之队列-Day41"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2018/12/24/线程之定时器-Day41/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/24/线程之定时器-Day41/" itemprop="url">线程之定时器-Day41</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-24T22:35:02+08:00">
                2018-12-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  53
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="线程之定时器-Day41"><a href="#线程之定时器-Day41" class="headerlink" title="线程之定时器-Day41"></a>线程之定时器-Day41</h2><h4 id="代码如下："><a href="#代码如下：" class="headerlink" title="代码如下："></a>代码如下：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author : 渝周郎</span></span><br><span class="line"><span class="comment"># Time   : 2018/12/24 22:11</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Timer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">	print(<span class="string">'%s:同步时间成功！'</span>% time.ctime())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">	t = Timer(<span class="number">5</span>, func).start()</span><br><span class="line">	time.sleep(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<h4 id="运行结果如下"><a href="#运行结果如下" class="headerlink" title="运行结果如下:"></a>运行结果如下:</h4><p><img src="/2018/12/24/线程之定时器-Day41/201812242228.gif" alt="线程之定时器-Day41"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2018/12/24/线程之条件-Day41/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/24/线程之条件-Day41/" itemprop="url">线程之条件-Day41</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-24T21:52:02+08:00">
                2018-12-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  144
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="线程之条件-Day41"><a href="#线程之条件-Day41" class="headerlink" title="线程之条件-Day41"></a>线程之条件-Day41</h2><blockquote>
<p>主要是四个函数函数的运用：<br>acquire()、release()：使用wait()和notify()的前后必须得用这两个函数<br>wait()、notify(int类型)</p>
</blockquote>
<h4 id="代码如下："><a href="#代码如下：" class="headerlink" title="代码如下："></a>代码如下：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Author : 渝周郎</span></span><br><span class="line"><span class="comment"># Time   : 2018/12/24 21:25</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Condition, Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(con, i)</span>:</span></span><br><span class="line">	con.acquire()</span><br><span class="line">	con.wait()      <span class="comment"># 默认False状态会影响wait一直处于等待状态</span></span><br><span class="line">	print(<span class="string">'这是第%s个循环'</span> % i)</span><br><span class="line">	con.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">con = Condition()   <span class="comment"># Condition默认状态为False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">	Thread(target=func, args=(con, i)).start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">	msg = int(input(<span class="string">'&gt;&gt;&gt;'</span>))</span><br><span class="line">	con.acquire()</span><br><span class="line">	con.notify(msg)     <span class="comment"># notify相当于造几把钥匙</span></span><br><span class="line">	con.release()</span><br></pre></td></tr></table></figure>
<h4 id="运行结果如下"><a href="#运行结果如下" class="headerlink" title="运行结果如下:"></a>运行结果如下:</h4><p><img src="/2018/12/24/线程之条件-Day41/201812242147.gif" alt="线程之条件-Day41"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.139139.cn/2018/12/22/线程之事件-Day41/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="渝周郎">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渝周砺行路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/22/线程之事件-Day41/" itemprop="url">线程之事件-Day41</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-22T20:20:02+08:00">
                2018-12-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  187
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="线程之事件-Day41"><a href="#线程之事件-Day41" class="headerlink" title="线程之事件-Day41"></a>线程之事件-Day41</h2><h4 id="代码如下："><a href="#代码如下：" class="headerlink" title="代码如下："></a>代码如下：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, Event</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过一个检测数据库连接状态的列子说明Event是如何使用的</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_db</span><span class="params">(e)</span>:</span>    <span class="comment"># 不定时返回Event的状态为True</span></span><br><span class="line">    time.sleep(random.randint(<span class="number">0</span>,<span class="number">3</span>))</span><br><span class="line">    e.set()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">connect_db</span><span class="params">(e)</span>:</span>  <span class="comment"># 连接数据库函数</span></span><br><span class="line">    count = <span class="number">0</span>   <span class="comment"># 数据库失败连接次数</span></span><br><span class="line">    <span class="keyword">while</span> count &lt; <span class="number">3</span>:    <span class="comment"># 失败重复连接3次</span></span><br><span class="line">        e.wait(<span class="number">1</span>)    <span class="comment"># 设置等待连接时间为0.5秒</span></span><br><span class="line">        <span class="keyword">if</span> e.is_set():</span><br><span class="line">            print(<span class="string">'数据库连接成功!'</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            count +=<span class="number">1</span></span><br><span class="line">            print(<span class="string">'第%s次数据库连接失败！'</span>% count)</span><br><span class="line">    <span class="keyword">else</span>:   <span class="comment"># 超过3次连接失败，主动抛出异常错误！</span></span><br><span class="line">        <span class="keyword">raise</span> TimeoutError(<span class="string">'数据库连接超时!'</span>)</span><br><span class="line"></span><br><span class="line">event =Event()</span><br><span class="line">t1 = Thread(target=check_db, args=(event, ))</span><br><span class="line">t2 = Thread(target=connect_db, args=(event, ))</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br></pre></td></tr></table></figure>
<h4 id="运行结果如下"><a href="#运行结果如下" class="headerlink" title="运行结果如下:"></a>运行结果如下:</h4><p><img src="/2018/12/22/线程之事件-Day41/201812222018.gif" alt="线程之事件-Day41"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">渝周郎</p>
              <p class="site-description motion-element" itemprop="description">记录工作点滴,业余学习点滴</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">渝周郎</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
